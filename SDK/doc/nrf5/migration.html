<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: Migration guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('migration.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Migration guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#migration_ble">Bluetooth low energy (BLE)</a><ul><li class="level2"><a href="#migr_ble_api_changes">API changes</a></li>
</ul>
</li>
<li class="level1"><a href="#migration_libs">Libraries</a><ul><li class="level2"><a href="#migr_lib_oberon">Usage of mbed TLS in nrf_oberon</a></li>
</ul>
</li>
<li class="level1"><a href="#migration_drv">Drivers</a><ul><li class="level2"><a href="#migr_lib_nrfx">SAADC driver backported from nrfx 2.2.0</a></li>
</ul>
</li>
<li class="level1"><a href="#migration_crypto">Crypto</a><ul><li class="level2"><a href="#migr_crypto_cc310">Enabling and disabling of CryptoCell and its interrupts</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>If you built an application based on nRF5 SDK v16.0.0, complete the actions listed in the following sections to migrate your application to nRF5 SDK v17.0.2.</p>
<p>Note that this migration guide does not list all changes, but it covers the most important changes that require you to update your code. See the <a class="el" href="index.html">release notes</a> for further information on changes that were made in this release.</p>
<h1><a class="anchor" id="migration_ble"></a>
Bluetooth low energy (BLE)</h1>
<h2><a class="anchor" id="migr_ble_api_changes"></a>
API changes</h2>
<ol type="1">
<li>The <code>req_report</code> member has been removed from the <code><a class="el" href="structscan__evt__t.html" title="Structure for Scanning Module event data.">scan_evt_t</a></code> structure.</li>
<li>The <code>NRF_BLE_SCAN_EVT_SCAN_REQ_REPORT</code> value has been removed from the <code>nrf_ble_scan_evt_t</code> enumeration.</li>
</ol>
<h1><a class="anchor" id="migration_libs"></a>
Libraries</h1>
<h2><a class="anchor" id="migr_lib_oberon"></a>
Usage of mbed TLS in nrf_oberon</h2>
<p>The nrf_oberon library version 3.0.5 provides mbed TLS APIs and library for some of its features.</p>
<p>Usage of mbed TLS is not demonstrated in nRF5 SDK. For an example implementation, see <a href="https://developer.nordicsemi.com/nRF_Connect_SDK/doc/latest/nrfxlib/nrf_security/README.html" target="_blank">Nordic Security Module</a> .</p>
<p>To interface with the mbed TLS features using nRF5 SDK, do the following:</p>
<ol type="1">
<li>Create a new mbed TLS configuration with the following defines set: <div class="fragment"><div class="line"><span class="preprocessor">#define MBEDTLS_AES_SETKEY_ENC_ALT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBEDTLS_AES_SETKEY_DEC_ALT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBEDTLS_AES_ENCRYPT_ALT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBEDTLS_AES_DECRYPT_ALT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBEDTLS_ECDH_GEN_PUBLIC_ALT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBEDTLS_ECDH_COMPUTE_SHARED_ALT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBEDTLS_ECDSA_GENKEY_ALT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBEDTLS_ECDSA_SIGN_ALT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBEDTLS_ECDSA_VERIFY_ALT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBEDTLS_ECJPAKE_ALT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBEDTLS_SHA1_ALT</span></div>
<div class="line"><span class="preprocessor">#define MBEDTLS_SHA256_ALT</span></div>
</div><!-- fragment --> For information on how to configure mbed TLS, see <a href="https://tls.mbed.org/kb/compiling-and-building/how-do-i-configure-mbedtls" target="_blank">How do I configure Mbed TLS</a>. <br/>
 <dl class="section note"><dt>Note</dt><dd>Elliptic Curve Cryptography is limited to curve secp256r1 for ECDSA and EC J-PAKE, and curve25519 for ECDH. Enabling any other curves might crash the system. <br/>
</dd></dl>
</li>
<li>Download mbedcrypto version 3.0.0 or later to compile and link against.</li>
<li>You can also use this method with the latest long-term support of mbed TLS (v2.16.x). To do this, two functions must be made available from subsequent versions:</li>
</ol>
<ul>
<li><code>mbedtls_mpi_write_binary_le</code> </li>
<li><code>mbedtls_mpi_read_binary_le</code> </li>
</ul>
<h1><a class="anchor" id="migration_drv"></a>
Drivers</h1>
<h2><a class="anchor" id="migr_lib_nrfx"></a>
SAADC driver backported from nrfx 2.2.0</h2>
<p>The nrfx 1.8.4 comes with two SAADC drivers. The first one is a legacy driver while the second one is backported from nrfx 2.2.0. The new driver fixes several known issues but comes with new API.</p>
<p>The new SAADC driver is added to the existing files. There is no need to add new files to the compilation process. However, to switch to new API, the code must be rewritten and symbol <code>NRFX_SAADC_API_V2</code> must be defined. Examples on how to use the new API can be found here: <a href="https://github.com/NordicSemiconductor/nrfx/wiki/nrfx-1.8.1-to-2.0.0#saadc-1" target="_blank">SAADC driver migration</a>.</p>
<h1><a class="anchor" id="migration_crypto"></a>
Crypto</h1>
<h2><a class="anchor" id="migr_crypto_cc310"></a>
Enabling and disabling of CryptoCell and its interrupts</h2>
<p>Enabling and disabling of CryptoCell hardware and interrupts is now done internally in the nrf_cc310 library. The following API that allowed to do this manually is now removed:</p>
<ul>
<li><code>cc310_backend_enable()</code>;</li>
<li><code>cc310_backend_disable()</code>;</li>
</ul>
<p>Any direct references to enable or disable the CryptoCell hardware or CryptoCell IRQ are also removed:</p>
<ul>
<li><div class="fragment"><div class="line"><span class="comment">// Enable the CryptoCell hardware</span></div>
<div class="line">NRF_CRYPTOCELL-&gt;ENABLE = 1;</div>
</div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><span class="comment">// Enable the CryptoCell IRQ</span></div>
<div class="line">NVIC_EnableIRQ(CRYPTOCELL_IRQn);</div>
</div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><span class="comment">// Disable the CryptoCell hardware</span></div>
<div class="line">NRF_CRYPTOCELL-&gt;ENABLE = 0;</div>
</div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><span class="comment">// Disable the CryptoCell IRQ</span></div>
<div class="line">NVIC_DisableIRQ(CRYPTOCELL_IRQn);</div>
</div><!-- fragment --></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>This change does not affect the nrf_cc310_bl library.</dd></dl>
<p>Action: If you have maintained the enabling and disabling of Cryptocell hardware and interrupts on your own, remove these calls from your code. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
