<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: DFU utilities</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__sdk__nrf__dfu__utils.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">DFU utilities<div class="ingroups"><a class="el" href="group__nrf__dfu.html">DFU modules</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gae7f7a5de0700cddb2733816c9efbbd91"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sdk__nrf__dfu__utils.html#gae7f7a5de0700cddb2733816c9efbbd91">ALIGN_TO_PAGE</a>(val)&#160;&#160;&#160;<a class="el" href="group__app__util.html#gae69e40f87e18245e805374084bde81c4">ALIGN_NUM</a>((CODE_PAGE_SIZE), (val))</td></tr>
<tr class="separator:gae7f7a5de0700cddb2733816c9efbbd91"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gadd4a03d3e60ceb40c35bc0c0fd08d1ae"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sdk__nrf__dfu__utils.html#gadd4a03d3e60ceb40c35bc0c0fd08d1ae">nrf_dfu_bank0_start_addr</a> (void)</td></tr>
<tr class="memdesc:gadd4a03d3e60ceb40c35bc0c0fd08d1ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for getting the start address of bank 0.  <a href="#gadd4a03d3e60ceb40c35bc0c0fd08d1ae">More...</a><br/></td></tr>
<tr class="separator:gadd4a03d3e60ceb40c35bc0c0fd08d1ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga912cf7fc527366683188fac53a47363c"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sdk__nrf__dfu__utils.html#ga912cf7fc527366683188fac53a47363c">nrf_dfu_bank1_start_addr</a> (void)</td></tr>
<tr class="memdesc:ga912cf7fc527366683188fac53a47363c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for getting the start address of bank 1.  <a href="#ga912cf7fc527366683188fac53a47363c">More...</a><br/></td></tr>
<tr class="separator:ga912cf7fc527366683188fac53a47363c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga63380a34bfd911915cc4ac9f5a4c8f60"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sdk__nrf__dfu__utils.html#ga63380a34bfd911915cc4ac9f5a4c8f60">nrf_dfu_app_start_address</a> (void)</td></tr>
<tr class="memdesc:ga63380a34bfd911915cc4ac9f5a4c8f60"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for getting the start address of the app.  <a href="#ga63380a34bfd911915cc4ac9f5a4c8f60">More...</a><br/></td></tr>
<tr class="separator:ga63380a34bfd911915cc4ac9f5a4c8f60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9b9cec9e2060c39845dab77ecf493cd1"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sdk__nrf__dfu__utils.html#ga9b9cec9e2060c39845dab77ecf493cd1">nrf_dfu_softdevice_start_address</a> (void)</td></tr>
<tr class="memdesc:ga9b9cec9e2060c39845dab77ecf493cd1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for getting the start address of the SoftDevice.  <a href="#ga9b9cec9e2060c39845dab77ecf493cd1">More...</a><br/></td></tr>
<tr class="separator:ga9b9cec9e2060c39845dab77ecf493cd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaacad5345971e0832b424121b70668792"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sdk__nrf__dfu__utils.html#gaacad5345971e0832b424121b70668792">nrf_dfu_cache_prepare</a> (uint32_t required_size, bool single_bank, bool keep_app, bool keep_softdevice)</td></tr>
<tr class="memdesc:gaacad5345971e0832b424121b70668792"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for finding and preparing a place in flash in which to store a DFU update.  <a href="#gaacad5345971e0832b424121b70668792">More...</a><br/></td></tr>
<tr class="separator:gaacad5345971e0832b424121b70668792"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafdb47c3dc356b822047bd6cf90e816ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sdk__nrf__dfu__utils.html#gafdb47c3dc356b822047bd6cf90e816ac">nrf_dfu_softdevice_invalidate</a> (void)</td></tr>
<tr class="memdesc:gafdb47c3dc356b822047bd6cf90e816ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for making sure a SoftDevice is not recognized as such anymore.  <a href="#gafdb47c3dc356b822047bd6cf90e816ac">More...</a><br/></td></tr>
<tr class="separator:gafdb47c3dc356b822047bd6cf90e816ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9024cdae7ce2af848b1a773cfcd5aee2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sdk__nrf__dfu__utils.html#ga9024cdae7ce2af848b1a773cfcd5aee2">nrf_dfu_bank_invalidate</a> (<a class="el" href="structnrf__dfu__bank__t.html">nrf_dfu_bank_t</a> *const p_bank)</td></tr>
<tr class="memdesc:ga9024cdae7ce2af848b1a773cfcd5aee2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function for making sure a bank is not copied or booted.  <a href="#ga9024cdae7ce2af848b1a773cfcd5aee2">More...</a><br/></td></tr>
<tr class="separator:ga9024cdae7ce2af848b1a773cfcd5aee2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="gae7f7a5de0700cddb2733816c9efbbd91"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ALIGN_TO_PAGE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">val</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="group__app__util.html#gae69e40f87e18245e805374084bde81c4">ALIGN_NUM</a>((CODE_PAGE_SIZE), (val))</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Round up val to the next page boundary </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga63380a34bfd911915cc4ac9f5a4c8f60"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t nrf_dfu_app_start_address </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for getting the start address of the app. </p>
<dl class="section return"><dt>Returns</dt><dd>The start address of the bootable app. </dd></dl>

</div>
</div>
<a class="anchor" id="gadd4a03d3e60ceb40c35bc0c0fd08d1ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t nrf_dfu_bank0_start_addr </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for getting the start address of bank 0. </p>
<dl class="section note"><dt>Note</dt><dd>Bank 0 starts after the SoftDevice if a SoftDevice is present.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The start address of bank 0. </dd></dl>

</div>
</div>
<a class="anchor" id="ga912cf7fc527366683188fac53a47363c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t nrf_dfu_bank1_start_addr </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for getting the start address of bank 1. </p>
<dl class="section return"><dt>Returns</dt><dd>The start address of bank 1. </dd></dl>

</div>
</div>
<a class="anchor" id="ga9024cdae7ce2af848b1a773cfcd5aee2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nrf_dfu_bank_invalidate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnrf__dfu__bank__t.html">nrf_dfu_bank_t</a> *const&#160;</td>
          <td class="paramname"><em>p_bank</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for making sure a bank is not copied or booted. </p>
<p>This also sets the size of the bank to 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_bank</td><td>Pointer to the bank to be invalidated. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gaacad5345971e0832b424121b70668792"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t nrf_dfu_cache_prepare </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>required_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>single_bank</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>keep_app</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>keep_softdevice</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for finding and preparing a place in flash in which to store a DFU update. </p>
<p>This function checks the size requirements and selects a location for placing the cache of the DFU images. The function tries to find enough space after the existing firmwares. If there is not enough space, the present application is deleted. If there is still not enough space, the SoftDevice is deleted. If <code>single_bank</code> is true, the default behavior is to immediately delete the app and SoftDevice as necessary to place the new firmware at its intended location. If the intended location cannot be made available, or if the update is a bootloader update, the update will be a dual bank update, and nothing will be deleted by this function except when needed for size. If <code>keep_app</code> is true, the app is never deleted by this function. Likewise if <code>keep_softdevice</code> is true, the SoftDevice is never deleted by this function. If the new firmware cannot fit within the constraints, nothing is deleted and the function fails.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">required_size</td><td>Requirements for the size of the new image. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">single_bank</td><td>Whether to put the firmware directly where it's meant to go. <code>keep_app</code> and <code>keep_softdevice</code> take precedence over this. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">keep_app</td><td>True to ensure the app is not deleted by this function. This effectively enforces dual bank update. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">keep_softdevice</td><td>True to ensure the SoftDevice is not deleted by this function.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NRF_SUCCESS</td><td>If a cache location was found for the DFU process. </td></tr>
    <tr><td class="paramname">NRF_ERROR_NO_MEM</td><td>If there is not enough space available to receive the update. Nothing has been deleted. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gafdb47c3dc356b822047bd6cf90e816ac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nrf_dfu_softdevice_invalidate </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for making sure a SoftDevice is not recognized as such anymore. </p>
<p>It works by overwriting the magic number of the SoftDevice with 0s. The magic number is used throughout the bootloader to detect whether a SoftDevice is present.</p>
<dl class="section warning"><dt>Warning</dt><dd>This function should only be called when both banks are already invalid. because the (implicit) position of the banks will shift when the SoftDevice is invalidated. </dd></dl>

</div>
</div>
<a class="anchor" id="ga9b9cec9e2060c39845dab77ecf493cd1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t nrf_dfu_softdevice_start_address </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function for getting the start address of the SoftDevice. </p>
<dl class="section return"><dt>Returns</dt><dd>The start address of the SoftDevivce. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
