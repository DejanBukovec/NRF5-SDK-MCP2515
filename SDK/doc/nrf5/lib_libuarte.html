<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: Libuarte - advanced UARTE driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_libuarte.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Libuarte - advanced UARTE driver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#lib_libuarte_drv">nrf_libuarte_drv</a><ul><li class="level2"><a href="#lib_libuarte_drv_resources">Hardware resources usage</a></li>
<li class="level2"><a href="#lib_libuarte_drv_usage">nrf_libuarte_drv usage</a><ul><li class="level3"><a href="#lib_libuarte_drv_usage_rx">Receiver</a></li>
<li class="level3"><a href="#lib_libuarte_drv_usage_tx">Transmitter</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#lib_libuarte_async">nrf_libuarte_async</a><ul><li class="level2"><a href="#lib_libuarte_async_timeout">Timeout implementation</a><ul><li class="level3"><a href="#lib_libuarte_async_timeout_peripherals">TIMER/RTC peripheral</a></li>
<li class="level3"><a href="#lib_libuarte_async_timeout_instance">app_timer instance</a></li>
</ul>
</li>
<li class="level2"><a href="#lib_libuarte_async_resources">Hardware resources usage</a></li>
<li class="level2"><a href="#lib_libuarte_async_usage">nrf_libuarte_async usage</a><ul><li class="level3"><a href="#lib_libuarte_async_rx">Receiver</a></li>
<li class="level3"><a href="#lib_libuarte_async_tx">Transmitter</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Libuarte is a UARTE library that consists of the following layers:</p>
<ul>
<li>nrf_libuarte_drv &ndash; a low level UARTE driver, with extended functionality like a continuous counting of received bytes, double buffering, optional events for starting and stopping receiver, and an optional task that can be triggered when the receiver is started and stopped.</li>
<li>nrf_libuarte_async &ndash; a library suitable for receiving and transmitting asynchronous packets. It manages the receive buffers and implements the receiver inactivity timeout. The library is using nrf_libuarte. It is meant to be used in a typical UART use case, in which the counterparty is asynchronously sending packets of variable length. In such case, user gets an event on packet boundary (that is, on timeout) and whenever the DMA buffer is full.</li>
</ul>
<p>See <a class="el" href="libuarte_example.html">Libuarte Example</a> for Libuarte usage.</p>
<h1><a class="anchor" id="lib_libuarte_drv"></a>
nrf_libuarte_drv</h1>
<p>nrf_libuarte_drv is using EasyDMA double buffering feature and PPI connections to ensure a reliable reception. The continuous reception is established by the STARTRX task, connected to the ENDRX event. Once the STARTRX task is started, the RXSTARTED event is generated.</p>
<p>On the RXSTARTED event:</p>
<ul>
<li>EasyDMA is configured for the transfer and can be configured for the next transfer.</li>
<li>Configuration registers are latched.</li>
</ul>
<p>Additionally, on the RXSTARTED event, nrf_libuarte_drv is calling the user handler with the request for the next buffer. The handler responds with the new buffer. As long as the buffer is provided before the end of the transfer that has just started, no data will be lost.</p>
<p>With this approach, the system latency depends on the size of the buffers used. If buffers are large enough, the system can ensure the complete reception without flow control with a multimillisecond latency. This minimal latency can cover for the SoftDevice or any other higher priority interrupts and flash operations (including flash page erase).</p>
<p>Moreover, a dedicated TIMER peripheral in the counter mode is used to track the number of bytes received.</p>
<p>nrf_libuarte_drv can be configured with hardware events that will start and stop the receiver. This option can be used, for example, to build a low power UART protocol with request and response pins that will enable the receiver only during a transfer. All hardware tasks and events are connected with PPI, which allows autonomous operation that does not depend on the interrupt handling time.</p>
<h2><a class="anchor" id="lib_libuarte_drv_resources"></a>
Hardware resources usage</h2>
<p>nrf_libuarte_drv is using the following hardware resources:</p>
<ul>
<li>UARTE instance</li>
<li>TIMER instance</li>
<li>PPI channels:<ul>
<li>If optional tasks and events are not used, a minimum of 2 PPI channels (3 on devices with a maximum of 255 EasyDMA transfers).</li>
<li>If optional tasks and events are used, a maximum of 9 PPI channels and 2 PPI groups.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="lib_libuarte_drv_usage"></a>
nrf_libuarte_drv usage</h2>
<p>nrf_libuarte_drv is initialized with <a class="el" href="group__nrf__libuarte__drv.html#ga2dcae976b01a3fc7d8644ee509e48135">nrf_libuarte_drv_init</a>.</p>
<p>The configuration includes:</p>
<ul>
<li>UART configuration (pins, baurdate, hardware flow control and parity)</li>
<li>interrupt priority</li>
<li>hardware events (start RX, end RX)</li>
<li>tasks (RX started, RX done)</li>
<li>TIMER peripheral used for counting bytes</li>
<li>user event handler</li>
</ul>
<h3><a class="anchor" id="lib_libuarte_drv_usage_rx"></a>
Receiver</h3>
<p>The receiver is activated using a call to <a class="el" href="group__nrf__libuarte__drv.html#ga27ba26d182cc5318c2199124ece52667">nrf_libuarte_drv_rx_start</a> with the receive buffer and the information if the receiver should be started immediately or via PPI.</p>
<p>Whenever nrf_libuarte_drv sets a EasyDMA receive buffer, a buffer request event (<a class="el" href="group__nrf__libuarte__drv.html#gga61f0a544410573972acecc4ad7149267a4348c48657e8a4f6b9340eacfd7183c4">NRF_LIBUARTE_DRV_EVT_RX_BUF_REQ</a>) is generated. In such case, make sure the application responds with <a class="el" href="group__nrf__libuarte__drv.html#gacfebff304c12f5db722d8deb33a0486a">nrf_libuarte_drv_rx_buf_rsp</a> and provides the new buffer. The new receive buffer must be provided before the end of the transfer that has just started, otherwise UARTE will start overwriting the active buffer, since the reception restarts autonomously.</p>
<p>On every completion of the EasyDMA transfer, the <a class="el" href="group__nrf__libuarte__drv.html#gga61f0a544410573972acecc4ad7149267a3f42a03a6e595a71dd9e848b641bf669">NRF_LIBUARTE_DRV_EVT_RX_DATA</a> event is generated.</p>
<h3><a class="anchor" id="lib_libuarte_drv_usage_tx"></a>
Transmitter</h3>
<p>nrf_libuarte_drv allows transmitting packets with length of 65535 bytes maximum.</p>
<p>If the device does not support 16-bit-long EasyDMA transfers, the EasyDMA double buffering feature and the PPI connection between the ENDTX event and the STARTTX task are used to ensure continouos transfer. On transfer completion, the <a class="el" href="group__nrf__libuarte__drv.html#gga61f0a544410573972acecc4ad7149267a0d3d2b2e91c4fcbfa05cd89ee6cc918a">NRF_LIBUARTE_DRV_EVT_TX_DONE</a> event is generated. </p>
<hr/>
<h1><a class="anchor" id="lib_libuarte_async"></a>
nrf_libuarte_async</h1>
<p>nrf_libuarte_async library is built on top of the lib_libuarte_drv driver. It implements a receiver inactivity timeout, which results in an event with the amount of data received.</p>
<p>The library has dedicated buffers for reception and handles the buffer request event from the driver (NRF_LIBUARTE_DRV_EVT_RX_BUF_REQ).</p>
<h2><a class="anchor" id="lib_libuarte_async_timeout"></a>
Timeout implementation</h2>
<p>You can implement the receiver inactivity timeout using one of the following options, depending on the available resources:</p>
<ul>
<li>a dedicated TIMER peripheral</li>
<li>a dedicated RTC peripheral</li>
<li>an app_timer instance</li>
</ul>
<h3><a class="anchor" id="lib_libuarte_async_timeout_peripherals"></a>
TIMER/RTC peripheral</h3>
<p>The TIMER or RTC peripheral is used along with the PPI connection between the byte boundary event (RXDRDY) and the task CLEAR in the TIMER/RTC peripheral.</p>
<p>TIMER/RTC is configured in such a way as to trigger an interrupt on the compare event. An interrupt is triggered when a task CLEAR is not triggered on time.</p>
<p>The timeout in configurable and the resolution equals the tick length of the peripheral used.</p>
<h3><a class="anchor" id="lib_libuarte_async_timeout_instance"></a>
app_timer instance</h3>
<p>Alternatively to <a class="el" href="lib_libuarte.html#lib_libuarte_async_timeout_peripherals">TIMER/RTC peripheral</a>, an app_timer instance can be used for the timeout implementation. This approach requires generating an app_timer event periodically at the specified time interval.</p>
<p>At the timeout, the app_timer event handler checks if the number of received bytes has changed. Based on this check, the handler reports the packet boundary.</p>
<p>The timeout resolution is lower compared with <a class="el" href="lib_libuarte.html#lib_libuarte_async_timeout_peripherals">TIMER/RTC peripheral</a> and equals the shortest app_timer timeout that can be set.</p>
<h2><a class="anchor" id="lib_libuarte_async_resources"></a>
Hardware resources usage</h2>
<p>nrf_libuarte_async is using the following hardware resources:</p>
<ul>
<li>nrf_libuarte_drv driver in the most basic configuration:<ul>
<li>UARTE instance</li>
<li>TIMER instance</li>
<li>2 or 3 PPI channels</li>
</ul>
</li>
<li>If TIMER or RTC peripheral is used for the receiver inactivity timeout, the following additional resources are used:<ul>
<li>RTC or TIMER instance</li>
<li>2 PPI channels</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="lib_libuarte_async_usage"></a>
nrf_libuarte_async usage</h2>
<p>nrf_libuarte_async is initialized with <a class="el" href="group__nrf__libuarte__async.html#ga3bfc31b58b0b05ccb219b0ce0e8de3bb">nrf_libuarte_async_init</a>.</p>
<p>The configuration includes:</p>
<ul>
<li>same elements as for the nrf_libuarte_drv configuration (see <a class="el" href="lib_libuarte.html#lib_libuarte_drv_usage">nrf_libuarte_drv usage</a>)</li>
<li>receiver inactivity timeout</li>
<li>timeout infrastructure (TIMER, RTC, or app_timer)</li>
<li>amount of memory dedicated for the receiver</li>
</ul>
<h3><a class="anchor" id="lib_libuarte_async_rx"></a>
Receiver</h3>
<p><a class="el" href="group__nrf__libuarte__async.html#gafc9a62859f197ef210f8327cacf947ed">nrf_libuarte_async_enable</a> enables the receiver.</p>
<p>On packet or buffer boundary, an event handler is called with <a class="el" href="group__nrf__libuarte__async.html#gga2bcf57e4d184518ee514387b3b1806e7ad588e572f3c06b343211e16f75b333b0">NRF_LIBUARTE_ASYNC_EVT_RX_DATA</a>. The event structure contains a pointer to the data and the amount of data received. When you process the data, it must be returned to the library with a call to <a class="el" href="group__nrf__libuarte__async.html#gaca89dd833a2d39f9896836d76ea42e45">nrf_libuarte_async_rx_free</a>.</p>
<h3><a class="anchor" id="lib_libuarte_async_tx"></a>
Transmitter</h3>
<p><a class="el" href="group__nrf__libuarte__async.html#ga99d0317df86a0131398d0297e2e82e32">nrf_libuarte_async_tx</a> is used to start the transfer.</p>
<p>The event handler with the <a class="el" href="group__nrf__libuarte__async.html#gga2bcf57e4d184518ee514387b3b1806e7a36d71d569f410ceb9e521e0193b59812">NRF_LIBUARTE_ASYNC_EVT_TX_DONE</a> event is called on the transfer completion. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
