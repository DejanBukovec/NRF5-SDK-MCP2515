<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: NFC Connection Handover Message Parser</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('nfc_connection_handover_msg_parser_dox.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">NFC Connection Handover Message Parser </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This SDK provides a Connection Handover message parser to support the BLE Central role in BLE NFC pairing. It allows to process the given NFC tag data and get important pairing data, such as device name, device address, and OOB keys used for authentication. Parsing data may be obtained for example by using the Adafruit PN532 NFC shield - see <a class="el" href="lib_adafruit.html">Adafruit NFC Shield library</a>.</p>
<p>This parsing module collects data that allows to perform various BLE pairing modes:</p>
<ol type="1">
<li>Legacy Just Works pairing,</li>
<li>Legacy Out Of Band pairing,</li>
<li>LE Secure Connections Just Works pairing,</li>
<li>LE Secure Connections Out Of Band pairing.</li>
</ol>
<h1><a class="anchor" id="Usage"></a>
Usage</h1>
<p>An example of module usage is provided by <a class="el" href="ble_sdk_app_hrs_nfc_c.html">Experimental: BLE Heart Rate Collector Example with NFC Pairing</a> example. It can be tested with a complementary <a class="el" href="ble_sdk_app_hrs_nfc_pairing.html">Experimental: Heart Rate Application with BLE Pairing Using NFC Pairing Library</a> example. To properly use the Connection Handover message parser, perform the following steps:</p>
<ol type="1">
<li>Obtain NFC tag data using an NFC reader.</li>
<li>Split the NFC tag data into NDEF messages.</li>
<li>Parse each NDEF message with the parser, assuming that they are Connection Handover messages: <div class="fragment"><div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * @brief Function for analyzing Connection Handover NDEF message.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> ch_ndef_msg_handle(<a class="code" href="structnfc__ndef__msg__desc__t.html" title="NDEF message descriptor.">nfc_ndef_msg_desc_t</a> * p_ch_msg_desc)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="structnfc__ble__oob__pairing__data__t.html" title="BLE Advertising data that is relevant for OOB pairing.">nfc_ble_oob_pairing_data_t</a>  le_oob_record_pairing_data;</div>
<div class="line">    uint8_t                     device_name[DEVICE_NAME_BUFF_SIZE];</div>
<div class="line">    <a class="code" href="structble__advdata__tk__value__t.html" title="Security Manager TK value.">ble_advdata_tk_value_t</a>      device_tk;</div>
<div class="line">    <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/structble__gap__lesc__oob__data__t.html">ble_gap_lesc_oob_data_t</a>     device_lesc_data;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; p_ch_msg_desc-&gt;<a class="code" href="structnfc__ndef__msg__desc__t.html#a83fd617e608c3a50675fa8d0236eea6f" title="Number of records in the NDEF message.">record_count</a>; i++)</div>
<div class="line">    {</div>
<div class="line">        le_oob_record_pairing_data.<a class="code" href="structnfc__ble__oob__pairing__data__t.html#a8504075b3fdee8ebdbfc8e366ec3fa40">device_name</a>.<a class="code" href="structble__gap__dev__name__t.html#a052792d3e77ef2f285847af8e2ae86e2">p_name</a>   = device_name;</div>
<div class="line">        le_oob_record_pairing_data.<a class="code" href="structnfc__ble__oob__pairing__data__t.html#a8504075b3fdee8ebdbfc8e366ec3fa40">device_name</a>.<a class="code" href="structble__gap__dev__name__t.html#a70394e50d87525df36a825c2ec91fa59">len</a>      = <span class="keyword">sizeof</span>(device_name);</div>
<div class="line">        le_oob_record_pairing_data.<a class="code" href="structnfc__ble__oob__pairing__data__t.html#a5381aee7da2c9d763591258a85537b76">p_device_addr</a>        = &amp;device_lesc_data.<a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/structble__gap__lesc__oob__data__t.html#ae91df3be263f84be9adde5c2f7b79153">addr</a>;</div>
<div class="line">        le_oob_record_pairing_data.<a class="code" href="structnfc__ble__oob__pairing__data__t.html#a799d59b513327879f8cdb4d1561c684c">p_tk_value</a>           = &amp;device_tk;</div>
<div class="line">        le_oob_record_pairing_data.<a class="code" href="structnfc__ble__oob__pairing__data__t.html#aa2c4cf2baace840de0a41da3ca27c761">p_lesc_confirm_value</a> = (uint8_t *)device_lesc_data.<a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/structble__gap__lesc__oob__data__t.html#a89f052536d749e8fc0a057af9918834f">c</a>;</div>
<div class="line">        le_oob_record_pairing_data.<a class="code" href="structnfc__ble__oob__pairing__data__t.html#a99b3f570028261f3dd99cfe38dbbd8a7">p_lesc_random_value</a>  = (uint8_t *)device_lesc_data.<a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/structble__gap__lesc__oob__data__t.html#a47c6bb35451ff9ef84a1c870362233b7">r</a>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Parse an NDEF message, assuming it is a Connection Handover message.</span></div>
<div class="line">        <a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> err_code = <a class="code" href="group__nfc__le__oob__rec__parser.html#ga541b50af065ac5cf6d057c2b4ba819e3" title="Function for parsing general record description as LE OOB record.">nfc_le_oob_rec_parse</a>(p_ch_msg_desc-&gt;<a class="code" href="structnfc__ndef__msg__desc__t.html#a443fe1c02034f8d7abc9c65e3e2ecb68" title="Pointer to an array of pointers to NDEF record descriptors.">pp_record</a>[i],</div>
<div class="line">                                                   &amp;le_oob_record_pairing_data);</div>
<div class="line">        <span class="keywordflow">if</span> (err_code == <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="group__nfc__ble__oob__advdata__parser.html#gab92e54374af9b5063e6ddd70223084a3" title="Function for displaying values of basic BLE OOB Advertising data types.">nfc_oob_data_printout</a>(&amp;le_oob_record_pairing_data);</div>
</div><!-- fragment --></li>
<li>Use pairing data to establish a connection with a BLE Peripheral device. </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
