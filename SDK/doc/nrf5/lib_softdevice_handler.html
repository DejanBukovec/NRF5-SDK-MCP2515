<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: SoftDevice Handler library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_softdevice_handler.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SoftDevice Handler library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="whichSDs"><span>This information applies to the following SoftDevices: <b>S132, S140</b></span></div><p>This library is used for enabling and disabling the SoftDevice and for propagating SoftDevice events to the application.</p>
<p>This library has the following functionalities.</p>
<ul>
<li>Enabling the SoftDevice and its event interrupt.</li>
<li>Disabling the SoftDevice.</li>
<li>Receiving stack events from the SoftDevice and forwarding them to the parts of application that have registered themselves as observers.</li>
<li>Sending SoftDevice state events to applications and drivers.</li>
<li>Sending SoftDevice state requests which can be accepted or rejected by an observer.</li>
<li>This module works with SoftDevices that have BLE, ANT, or BLE and ANT functionalities.</li>
</ul>
<p>The API exposed by this module can be found in <code>&lt;InstallFolder&gt;\components\softdevice\common</code> in the files <code>nrf_sdh.h</code>, <code>nrf_sdh_soc.h</code>, <code>nrf_sdh_ant.h</code>, and <code>nrf_sdh_ble.h</code>.</p>
<p>For API documentation of this module, see <a class="el" href="group__nrf__sdh.html">SoftDevice Handler</a>.</p>
<h1><a class="anchor" id="lib_sdh_components"></a>
Library components</h1>
<p>The SoftDevice Handler library consists of four main modules.</p>
<ul>
<li>nrf_sdh</li>
<li>nrf_sdh_soc</li>
<li>nrf_sdh_ant</li>
<li>nrf_sdh_ble</li>
</ul>
<h2><a class="anchor" id="lib_sdh_components_nrf_sdh"></a>
nrf_sdh component</h2>
<p>This is the core of the SoftDevice Handler library. It handles requests for enabling or disabling the SoftDevice, and notifies about SoftDevice state changes (such as: about to be enabled, enabled, about to be disabled, disabled). This component also fetches stack events and dispatches them to the correct nrf_sdh_* library, where stands for soc, ant, or ble. To view and modify the configuration options of this module, refer to <a class="el" href="group__nrf__sdh__config.html">SoftDevice handler configuration</a>.</p>
<h2><a class="anchor" id="lib_sdh_components_nrf_sdh_soc"></a>
nrf_sdh_soc component</h2>
<p>This part of the library receives SoC events from the SoftDevice Handler library. Applications and other libraries can register with nrf_sdh_soc to receive these events by using the macro <a class="el" href="group__nrf__sdh__soc.html#ga61b74435c52e1527c8802d0e4b2436bb">NRF_SDH_SOC_OBSERVER</a>. To view and modify the configuration options of this module, refer to <a class="el" href="group__nrf__sdh__soc__config.html">SoftDevice SoC event handler configuration</a>.</p>
<h2><a class="anchor" id="lib_sdh_components_nrf_sdh_ant"></a>
nrf_sdh_ant component</h2>
<p>This part of the library receives ANT events from the SoftDevice Handler library. Applications and other libraries can register with nrf_sdh_ant to receive these events by using the macro <a class="el" href="group__nrf__sdh__ant.html#ga6314a6636e907d09325b27dbbef5b111">NRF_SDH_ANT_OBSERVER</a>. To view and modify the configuration options of this module, refer to <a class="el" href="group__nrf__sdh__ant__config.html">SoftDevice ANT event handler configuration</a>.</p>
<h2><a class="anchor" id="lib_sdh_components_nrf_sdh_ble"></a>
nrf_sdh_ble component</h2>
<p>This part of the library receives BLE events from the SoftDevice Handler library. Applications and other libraries can register with nrf_sdh_ble to receive these events by using the macro <a class="el" href="group__nrf__sdh__ble.html#gad162c1f4d4c248e4d4567dfa70e0e10e">NRF_SDH_BLE_OBSERVER</a>. To view and modify the configuration options of this module, refer to <a class="el" href="group__nrf__sdh__ble__config.html">SoftDevice BLE event handler configuration</a>.</p>
<h1><a class="anchor" id="lib_sdh_components_functions"></a>
Functions of the library components</h1>
<p>The three nrf_sdh_* components have a similar role of sending a particular kind of stack events to their registered observers.</p>
<ul>
<li><code>nrf_sdh_soc</code>: SoC events</li>
<li><code>nrf_sdh_ant</code>: ANT events</li>
<li><code>nrf_sdh_ble</code>: BLE events See <a class="el" href="lib_softdevice_handler.html#lib_sdh_ble_example">Example of registering a BLE observer</a> for a code example of how to register an observer.</li>
</ul>
<p>These three modules register with the core <code>nrf_sdh</code> module using macros defined in the SoftDevice Handler library, in a similar way as their observers register to them. The <code>nrf_sdh</code> core component then sends the specific stack events (SoC, ANT, or BLE) to the respective modules.</p>
<p>Apart from propagating stack events to the submodules, <code>nrf_sdh</code> sends two other types of messages.</p>
<ul>
<li>SoftDevice state events: <br/>
 Four types of events are sent.<ul>
<li>SoftDevice enabled,</li>
<li>SoftDevice about to be enabled (Enable prepare),</li>
<li>SoftDevice disabled,</li>
<li>SoftDevice about to be disabled (Disable prepare). Applications or drivers can listen to these events and perform any necessary operations based on these notifications.</li>
</ul>
</li>
<li><p class="startli">SoftDevice state requests. <br/>
 Two types of requests are sent.</p>
<ul>
<li>Enable request,</li>
<li>Disable request. State requests differ from state events in that they are not a notification about the SoftDevice state change, but a request to change this state. A part of the application that receives this request can either accept or reject it, in which case the state change is aborted. An example use case of this functionality is preventing one part of the application from disabling the SoftDevice, when another part of the application has a pending operation that is being executed (such as a flash write operation). See <a class="el" href="lib_softdevice_handler.html#lib_sdh_example_delay">Delaying a SoftDevice's state change</a>.</li>
</ul>
<p class="startli">In certain situations, an observer might also want to delay or prevent enabling of the SoftDevice. For example, when a library is accessing the NVMC registers to write to flash, enabling the SoftDevice will result in an assert the next time when the library attempts to access these registers, because they are protected when the SoftDevice is enabled.</p>
</li>
</ul>
<h1><a class="anchor" id="lib_sdh_register"></a>
Registering with the nrf_sdh_* components</h1>
<p>Each part of an application that wants to receive events from the different components of the SoftDevice Handler library must register itself by using the macros specified in the <a class="el" href="lib_softdevice_handler.html#lib_sdh_components">Library components</a> section. The registering happens at compile time, even though the events themselves are sent out to the observers at runtime. A registered part of an application becomes an <em>observer</em>.</p>
<h2><a class="anchor" id="lib_sdh_register_observer"></a>
Observers and their priorities</h2>
<p>An observer is essentially a piece of code that listens for events. It consists of a handler function and its associated parameter - a context. Every handler function has a certain priority.</p>
<p>The priority of a handler is a number that specifies the order in which it receives events with respect to other handlers (of the same type of events - BLE, ANT, or SoC). Priority zero is the highest. It is possible to have several observers registered with the same priority, but then the order in which they receive events depends on the order in which the linker encounters the handlers during the linking process. Therefore, to be certain that a particular observer is the first one to receive an event, you must assign higher priority to it.</p>
<p>Example: Module A registers itself an observer of BLE events with (a handler) priority 1. Then, module B registers itself as an observer of BLE events with a handler of priority 0. When an event is pulled from the stack by the SoftDevice Handler library, it is dispatched to <code>nrf_sdh_ble</code>, and from there, it is first sent to all observers that have a handler with priority zero, and then to all observers with a handler with priority 1. In consequence, module B receives the event before module A.</p>
<p>These priorities may be crucial when the modules depend on each other. In the example above, module A might depend on module B to be up to date when module A is processing an event from the stack. For that to happen, module B must receive the event first.</p>
<p>Priorities can be configured by passing a parameter to the macro.</p>
<h2><a class="anchor" id="lib_sdh_priority"></a>
Assigning priorities</h2>
<p>It is not recommended to modify the priority of any library that is included in this SDK. This may lead to unexpected problems.</p>
<p>However, when you create a new custom library and want to register it as an observer, you will have to assign a priority to it. In such case, a best practice is to assign to it a priority level that is lower than that for all other libraries. In this way, the rest of the application will have received the event and updated its state by the time the event reaches your library.</p>
<p>The default priority levels are already used by the existing libraries, so you must allocate an additional priority level and assign it to your library. To increase the number of priority levels, open the <code>sdk_config</code> file and look for the NRF_SDH_*_PRIO_LEVELS configuration parameter (* represents the type of events - SoC, BLE, or ANT). The value of this parameter is the number of available priority levels and the lowest priority is that number minus one. Change the value to a higher number and then assign the newly created priority level to your custom library.</p>
<p>It might also happen that you will need your piece of code to run before that of other libraries. In such case, check what priority is used in that library, by opening its header or .c file. Do not modify the priority of this library, but try to adjust the priority of yours. If this solution does not fit your requirements, you can increase the total number of priority levels.</p>
<h1><a class="anchor" id="lib_sdh_stack_init"></a>
Example of enabling the SoftDevice and BLE stack</h1>
<p>The following code snippet demonstrates how to enable the SoftDevice and the BLE stack.</p>
<div class="fragment"><div class="line"><a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> err_code;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Attempt to enable the SoftDevice</span></div>
<div class="line">err_code = <a class="code" href="group__nrf__sdh.html#ga574d17fdf1c59dec6355e3f525c484ec" title="Function for requesting to enable the SoftDevice.">nrf_sdh_enable_request</a>();</div>
<div class="line"><a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (!<a class="code" href="group__nrf__sdh.html#gafeb65d7fc5d540caef6549d430a36ca3" title="Function for retrieving the SoftDevice state.">nrf_sdh_is_enabled</a>())</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// The status change has been deferred. Handle as appropriate.</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Fetch the start address of the application RAM.</span></div>
<div class="line">uint32_t ram_start = 0;</div>
<div class="line">err_code = <a class="code" href="group__nrf__sdh__ble.html#gabd0c941014d63bc4ac9814a871bd7a4c" title="Function for retrieving the address of the start of application&#39;s RAM.">nrf_sdh_ble_app_ram_start_get</a>(&amp;ram_start);</div>
<div class="line"><a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Enable BLE stack.</span></div>
<div class="line">err_code = <a class="code" href="group__nrf__sdh__ble.html#ga12ef367fb1a6d329e3129a054209ee2d" title="Function for configuring and enabling the BLE stack.">nrf_sdh_ble_enable</a>(&amp;ram_start);</div>
<div class="line"><a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
</div><!-- fragment --><h1><a class="anchor" id="lib_sdh_ble_example"></a>
Example of registering a BLE observer</h1>
<p>The following code snippet demonstrates how to register a piece of code as an observer of BLE events.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;nrf_sdh_ble.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> ble_evt_handler(<a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/structble__evt__t.html">ble_evt_t</a> <span class="keyword">const</span> * p_evt, <span class="keywordtype">void</span> * p_context)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// process events here</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__nrf__sdh__ble.html#gad162c1f4d4c248e4d4567dfa70e0e10e" title="Macro for registering nrf_sdh_soc_evt_observer_t. Modules that want to be notified about SoC events m...">NRF_SDH_BLE_OBSERVER</a>(m_ble_observer, OBSERVER_PRIO, ble_evt_handler, NULL);</div>
</div><!-- fragment --><ul>
<li>m_ble_observer: This is the name of the observer. It must be unique across the .c file.</li>
<li>OBSERVER_PRIO: This is the priority of the observer’s handler.</li>
<li>ble_evt_handler: This is the actual function that will receive the events.</li>
<li>NULL: This parameter is optional and will be passed as a parameter to the function (together with the event itself, which is always passed). <br/>
</li>
</ul>
<h1><a class="anchor" id="lib_sdh_state_example"></a>
Example of registering a SoftDevice state observer</h1>
<p>The following code snippet demonstrates how to register a piece of code as an observer of SoftDevice state change events.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;nrf_sdh.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> state_evt_handler(<a class="code" href="group__nrf__sdh.html#ga6a92f798d247ada5b1290e8a03bbc169" title="SoftDevice Handler state events.">nrf_sdh_state_evt_t</a> state, <span class="keywordtype">void</span> * p_context);</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (state)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__nrf__sdh.html#gga6a92f798d247ada5b1290e8a03bbc169afb1e7d21cbf1eb4ce0b3219a50a097af" title="SoftDevice is going to be enabled.">NRF_SDH_EVT_STATE_ENABLE_PREPARE</a>:</div>
<div class="line">            <span class="comment">// SoftDevice is about to be enabled.</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__nrf__sdh.html#gga6a92f798d247ada5b1290e8a03bbc169adb2735f3bfedba16b3369d5c98691fae" title="SoftDevice is enabled.">NRF_SDH_EVT_STATE_ENABLED</a>:</div>
<div class="line">            <span class="comment">// SoftDevice is now enabled.</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__nrf__sdh.html#gga6a92f798d247ada5b1290e8a03bbc169ad7a79d4a4803fa29aabbd0fdea27fb2f" title="SoftDevice is going to be disabled.">NRF_SDH_EVT_STATE_DISABLE_PREPARE</a>:</div>
<div class="line">            <span class="comment">// SoftDevice is about to be disabled.</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__nrf__sdh.html#gga6a92f798d247ada5b1290e8a03bbc169ad8f96ddf9328e2533b1373b1d4ebea6c" title="SoftDevice is disabled.">NRF_SDH_EVT_STATE_DISABLED</a>:</div>
<div class="line">            <span class="comment">// SoftDevice is now disabled.</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__nrf__sdh.html#gadc027ab5161e54fde0abf75be812875e" title="Macro for registering a SoftDevice state observer.">NRF_SDH_STATE_OBSERVER</a>(m_state_observer, OBSERVER_PRIO) =</div>
<div class="line">{</div>
<div class="line">    .handler   = state_evt_handler,</div>
<div class="line">    .p_context = NULL</div>
<div class="line">};</div>
</div><!-- fragment --><ul>
<li>m_state_observer: This is the name of the observer. It must be unique across the .c file.</li>
<li>OBSERVER_PRIO: This is the priority of the observer’s handler.</li>
<li>state_evt_handler: This is the actual function that will receive the events.</li>
<li>NULL: This parameter is optional and will be passed as a parameter to the function (together with the event itself, which is always passed). <br/>
</li>
</ul>
<h1><a class="anchor" id="lib_sdh_example_delay"></a>
Delaying a SoftDevice's state change</h1>
<p>Using the SoftDevice state requests, a part of an application can prevent the SoftDevice from being disabled or enabled. For example, if the flash library has scheduled some flash operations, disabling the SoftDevice will make them fail. In such case, the flash library can use a dedicated macro to register itself with <code>nrf_sdh</code> as a <em>request observer</em>. When another part of the application issues the <a class="el" href="group__nrf__sdh.html#ga38fb7087993c1e6eae22c0e00725640e" title="Function for requesting to disable the SoftDevice.">nrf_sdh_disable_request()</a> call, the flash library event handler for the SoftDevice Handler library will respond to this request.</p>
<p>The handler can then return <code>FALSE</code> and abort the state change.</p>
<p>If it does so, it must afterwards call <code>nrf_sdh_continue()</code> when the SoftDevice can be disabled safely, for example after the flash operation has been completed. This call restarts the state change procedure, which involves resending state requests to all observers. If they all return <code>TRUE</code>, then the SoftDevice begins to change its state and the state events are sent.</p>
<h1><a class="anchor" id="lib_sdh_request_example"></a>
Example of registering a SoftDevice state request observer</h1>
<p>The following code snippet demonstrates how to register a state request observer.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;nrf_sdh.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// This functions must return either &#39;true&#39; or &#39;false&#39;.</span></div>
<div class="line"><span class="comment">// If you return false, be sure to call nrf_sdh_continue()</span></div>
<div class="line"><span class="comment">// when ready for the SoftDevice to change state.</span></div>
<div class="line"><span class="keywordtype">bool</span> request_evt_handler(<a class="code" href="group__nrf__sdh.html#ga66306fd3a53b06e8fb387da857eb917a" title="SoftDevice Handler state requests.">nrf_sdh_req_evt_t</a> request, <span class="keywordtype">void</span> * p_context);</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (request)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__nrf__sdh.html#gga66306fd3a53b06e8fb387da857eb917aa853befe5cc883d9c598b59b46c8c94e2" title="Request to enable the SoftDevice.">NRF_SDH_EVT_ENABLE_REQUEST</a>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__nrf__sdh.html#gga66306fd3a53b06e8fb387da857eb917aa9d45bf497a09e96e3b1e238207250a01" title="Request to disable the SoftDevice.">NRF_SDH_EVT_DISABLE_REQUEST</a>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__nrf__sdh.html#gacd03eaf046a0d35efb802ff49cfc872d" title="Macro for registering a SoftDevice state change request observer.">NRF_SDH_REQUEST_OBSERVER</a>(m_req_observer, OBSERVER_PRIO) =</div>
<div class="line">{</div>
<div class="line">    .handler   = request_evt_handler,</div>
<div class="line">    .p_context = NULL</div>
<div class="line">};</div>
</div><!-- fragment --><p> <br/>
</p>
<h1><a class="anchor" id="lib_sdh_example_delay_msc"></a>
Message sequence chart for SoftDevice state requests</h1>
<p>In the MSC below, a library requests to disable the SoftDevice. A request observer defers the state change to complete pending operations, and then it restarts the procedure. Finally, the SoftDevice changes its state and the library (a state observer) is notified of this.</p>
<div align="center">
<img src="msc_inline_mscgraph_1.png" alt="msc_inline_mscgraph_1" border="0" usemap="#msc_inline_mscgraph_1.map"/>
<map name="msc_inline_mscgraph_1.map" id="msc_inline_mscgraph_1.map"></map>
</div>
<p><br/>
</p>
<h1><a class="anchor" id="compiler_defines"></a>
Preprocessor defines</h1>
<p>This module uses conditional compilation. It expects certain preprocessor macros to be defined as follows.</p>
<ul>
<li><em>SOFTDEVICE_PRESENT</em> must be defined when the SoftDevice is present. It might not need to be defined for specific use cases, such as serialization.</li>
<li><em>ANT_LICENSE_KEY</em> must be defined if an ANT license must be provided to the SoftDevice. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
