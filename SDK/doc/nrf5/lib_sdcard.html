<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: SD card library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_sdcard.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SD card library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The SD card library provides the functionality to communicate with a Secure Digital memory card (SDC) using the SPI bus.</p>
<p>Key features include:</p>
<ul>
<li>Fully asynchronous operation.</li>
<li>Multiple block read/write support.</li>
<li>Support of SD (Standard Capacity), SDHC/SDXC and MMC (version 3).</li>
</ul>
<h1><a class="anchor" id="sdcard_config"></a>
Configuration</h1>
<p>The SD card library uses one SPI instance which can be selected in the SDK configuration file <code>sdk_config.h</code> by changing the value of APP_SDCARD_SPI_INSTANCE. You can adjust the SPI interface speed by setting the value of APP_SDCARD_FREQ_INIT (frequency during initialization) and APP_SDCARD_FREQ_DATA (frequency during data transfer). The frequency during an initialization process should not exceed 250kHz. Pin definitions are provided during runtime.</p>
<h1><a class="anchor" id="sdcard_init"></a>
Initialization and operation</h1>
<p>All of the SD card operations (except uninitialization) are performed asynchronously. The library uses <a href="http://dunkels.com/adam/pt/" target="_blank">Protothreads</a> for implementation of the coroutines. If the operation request function returns NRF_SUCCESS, then the operation result will be passed to the event handler function after completion. Event handler will not be called if the operation was not started successfully. Note that operation request functions return generic error codes (<a class="el" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b">ret_code_t</a>) and the operation result passed to the handler is of type <a class="el" href="group__app__sdcard.html#gae3acda5bac6413259e0467aff986f6b1">sdc_result_t</a>.</p>
<p>To initialize the card, call <a class="el" href="group__app__sdcard.html#ga403f5d4bd23f5f2210711f250cbe4c58">app_sdc_init</a> providing a pointer to the configuration structure of type <a class="el" href="structapp__sdc__config__t.html">app_sdc_config_t</a> and an event handler. If NRF_SUCCESS is returned, wait for the event handler to get the initialization result. Otherwise, initialization has failed. The read/write operations are executed in the same manner.</p>
<h1><a class="anchor" id="sdcard_usage"></a>
Usage</h1>
<p>The example code below shows the basic usage of the SD card library.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> sdc_handler(<a class="code" href="structsdc__evt__t.html" title="SDC event structure.">sdc_evt_t</a> <span class="keyword">const</span> * p_event)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span>(p_event-&gt;<a class="code" href="structsdc__evt__t.html#a0d3c62621b8cbf49cd71d50fa9f4ce48" title="Event type.">type</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__app__sdcard.html#ggaceb968952a750e0c290c3d83f6989049a15fc67b3cb04859e9fbff4bde069589d" title="Initialization procedure.">SDC_EVT_INIT</a>:</div>
<div class="line">            <span class="keywordflow">if</span> (p_event-&gt;<a class="code" href="structsdc__evt__t.html#af310df9a06bb8dd698316ee8266dd4c8" title="Operation result.">result</a> != <a class="code" href="group__app__sdcard.html#ggae3acda5bac6413259e0467aff986f6b1a3e09ca35dddf50f15adc1919be99fbb9" title="Operation successful.">SDC_SUCCESS</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">/* Initialization failed. */</span></div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">/* Initialization successful. */</span></div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__app__sdcard.html#ggaceb968952a750e0c290c3d83f6989049ace7bbe7e79ffeeadce7f25727603309e" title="Data read procedure.">SDC_EVT_READ</a>:</div>
<div class="line">            <span class="keywordflow">if</span> (p_event-&gt;<a class="code" href="structsdc__evt__t.html#af310df9a06bb8dd698316ee8266dd4c8" title="Operation result.">result</a> != <a class="code" href="group__app__sdcard.html#ggae3acda5bac6413259e0467aff986f6b1a3e09ca35dddf50f15adc1919be99fbb9" title="Operation successful.">SDC_SUCCESS</a>)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">/* Read error. */</span></div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                <span class="comment">/* Read successful. */</span></div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* ... */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* ... */</span></div>
<div class="line"></div>
<div class="line">uint8_t buffer[<a class="code" href="group__app__sdcard.html#ga884cc9df35b8d715290aa17330ad644f" title="Size of a single SD card block in bytes.">SDC_SECTOR_SIZE</a>];</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structapp__sdc__config__t.html" title="SDC configuration structure.">app_sdc_config_t</a> sdc_cfg = {</div>
<div class="line">    .<a class="code" href="structapp__sdc__config__t.html#ab9383f21fe490b6c0745d05a482d5c85" title="Serial data in (MOSI / DI) pin number.">mosi_pin</a> = SDC_MOSI_PIN,</div>
<div class="line">    .miso_pin = SDC_MISO_PIN,</div>
<div class="line">    .sck_pin  = SDC_SCK_PIN,</div>
<div class="line">    .cs_pin   = SDC_CS_PIN</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> err_code = <a class="code" href="group__app__sdcard.html#ga403f5d4bd23f5f2210711f250cbe4c58" title="Function for initializing the card.">app_sdc_init</a>(&amp;sdc_cfg, sdc_handler);</div>
<div class="line"><span class="keywordflow">if</span> (err_code != <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Initialization failed. */</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">while</span>(<a class="code" href="group__app__sdcard.html#gae3bba0c4bf45881da9764788bf99ae6d" title="Function for retrieving the card busy state.">app_sdc_busy_check</a>())</div>
<div class="line">{</div>
<div class="line">    wait();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Read the first block from the card. */</span></div>
<div class="line">err_code = <a class="code" href="group__app__sdcard.html#ga8ff04640858df4124b864546ede85aac" title="Function for reading the data blocks from the card.">app_sdc_block_read</a>(buffer, 0, 1);</div>
<div class="line"><span class="keywordflow">if</span> (err_code != <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Read request error. */</span></div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
