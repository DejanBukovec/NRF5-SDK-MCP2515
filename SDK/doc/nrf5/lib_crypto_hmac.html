<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: HMAC - Hash-based message authentication code</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_crypto_hmac.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">HMAC - Hash-based message authentication code </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Hash-based message authentication code (HMAC) is a mechanism for message authentication using a cryptographic hash function and a secret key. The algorithm takes a key and data of any length as input, and produces HMAC code with length defined by the underlying hash function. The HMAC standard is described in <a href="https://tools.ietf.org/html/rfc2104" target="_blank">RFC 2104</a>.</p>
<p>The nrf_crypto HMAC module supports SHA-256 and SHA-512.</p>
<h1><a class="anchor" id="lib_crypto_hmac_frontend"></a>
HMAC frontend</h1>
<p>The HMAC frontend (<a class="el" href="group__nrf__crypto__hmac.html">Hash-based message authentication code (HMAC) related functions</a>) provide a common API that is independent of the backends. The application has control of the memory usage, as the work memory is part of the context structure that is provided to the HMAC API. This is a thin wrapper layer that provides input validation and normalization of the backend APIs.</p>
<h2><a class="anchor" id="lib_crypto_hmac_backend"></a>
Available backends</h2>
<p>The following backends can be used for HMAC:</p>
<ul>
<li>CryptoCell CC310</li>
<li>Oberon crypto library</li>
<li>mbed TLS</li>
</ul>
<p>For information on configuring the backends, see <a class="el" href="lib_crypto_config.html">Configuring nrf_crypto frontend and backends</a>. It is possible to use a different backend for each hash. The following configuration defines are used to enable backend support for specific modes in the <code>sdk_config</code> file.</p>
<table class="doxtable">
<tr>
<th>Hash </th><th>Backend </th><th>Implementation </th><th>Enable define </th></tr>
<tr>
<td rowspan="3">SHA-256 </td><td>CC310 </td><td><b>Hardware</b> </td><td><a class="el" href="group__nrf__crypto__config.html#gab77467abcce090573adb03e2e77b0fa4">NRF_CRYPTO_BACKEND_CC310_HMAC_SHA256_ENABLED</a> </td></tr>
<tr>
<td>Oberon </td><td>Software </td><td><a class="el" href="group__nrf__crypto__config.html#gac8df098af87b54cb100337252646600d">NRF_CRYPTO_BACKEND_OBERON_HMAC_SHA256_ENABLED</a> </td></tr>
<tr>
<td>mbed TLS </td><td>Software </td><td><a class="el" href="group__nrf__crypto__config.html#ga12f6c55e57e42ff9cce5d9ec754bb6dd">NRF_CRYPTO_BACKEND_MBEDTLS_HMAC_SHA256_ENABLED</a> </td></tr>
<tr>
<td rowspan="3">SHA-512 </td><td>CC310 </td><td>Software </td><td><a class="el" href="group__nrf__crypto__config.html#gacd283fc4d036762be68053fade5c1b09">NRF_CRYPTO_BACKEND_CC310_HMAC_SHA512_ENABLED</a> </td></tr>
<tr>
<td>Oberon </td><td>Software </td><td><a class="el" href="group__nrf__crypto__config.html#ga3ba5630fb0786dbc492d3177b16e7af2">NRF_CRYPTO_BACKEND_OBERON_HMAC_SHA512_ENABLED</a> </td></tr>
<tr>
<td>mbed TLS </td><td>Software </td><td><a class="el" href="group__nrf__crypto__config.html#ga15b42cef491d413b7a7dc3fab62c9800">NRF_CRYPTO_BACKEND_MBEDTLS_HMAC_SHA512_ENABLED</a> </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>The CC310 implementation of SHA-512 is software based, and slower than the other supported backends. It is therefore not recommended to use CC310 for SHA-512.</dd></dl>
<h1><a class="anchor" id="lib_crypto_hmac_usage"></a>
HMAC usage</h1>
<p>The most flexible way of using the HMAC module is using the <a class="el" href="group__nrf__crypto__initialization.html#gaf527041b3a9f57a73a516901e2968721">nrf_crypto_init</a>, <a class="el" href="group__nrf__crypto__hmac.html#ga873e8577f2850218f50f712aa028afb2">nrf_crypto_hmac_update</a>, and <a class="el" href="group__nrf__crypto__hmac.html#gacf6e8a89d5f84f202fcc1da0b2668733">nrf_crypto_hmac_finalize</a> functions. This allows processing data as it becomes available by repeatedly calling <a class="el" href="group__nrf__crypto__hmac.html#ga873e8577f2850218f50f712aa028afb2">nrf_crypto_hmac_update</a>.</p>
<ol type="1">
<li>Enable nrf_crypto backed for HMAC in <a class="el" href="sdk_config.html">SDK configuration header file</a>.</li>
<li>Initialize nrf_crypto using <a class="el" href="group__nrf__crypto__initialization.html#gaf527041b3a9f57a73a516901e2968721">nrf_crypto_init</a>.</li>
<li>Create a context of type <a class="el" href="group__nrf__crypto__hmac.html#ga1f756de8f9e48807e84e58831159e9f4">nrf_crypto_hmac_context_t</a>. This must be valid for the duration of the calculation.</li>
<li>Initialize the context by providing a pointer to the key and a pointer to the constant info structure that defines the hash type. The info structure is either <a class="el" href="group__nrf__crypto__hmac.html#ga1a6d5a964d0910b62260e07942708ebd">g_nrf_crypto_hmac_sha256_info</a> for SHA-256 or <a class="el" href="group__nrf__crypto__hmac.html#ga7ef9474d6352459e5559a09d79460d99">g_nrf_crypto_hmac_sha512_info</a> for SHA-512.</li>
<li>Feed message data to the HMAC algorithm by calling <a class="el" href="group__nrf__crypto__hmac.html#ga873e8577f2850218f50f712aa028afb2">nrf_crypto_hmac_update</a>. This can be called repeatedly.</li>
<li>Finalize the HMAC calculation using <a class="el" href="group__nrf__crypto__hmac.html#gacf6e8a89d5f84f202fcc1da0b2668733">nrf_crypto_hmac_finalize</a>. This will populate the digest buffer with the calculated HMAC. The digest length in bytes is nrf_hash_type_t:NRF_CRYPTO_HASH_SIZE_SHA256 for SHA-256 or nrf_hash_type_t:NRF_CRYPTO_HASH_SIZE_SHA512 for SHA-512.</li>
</ol>
<p>The following example code demonstrates how to calculate HMAC SHA-256.</p>
<div class="fragment"><div class="line"><a class="code" href="unionnrf__crypto__backend__hmac__context__t.html">nrf_crypto_hmac_context_t</a>   context;</div>
<div class="line"></div>
<div class="line">uint8_t  data[]      = {0x6d, 0x65, 0x73, 0x73, 0x61, 0x67, 0x65};</div>
<div class="line">uint8_t  key[]       = {0x6b, 0x65, 0x79};</div>
<div class="line">uint8_t  digest[NRF_CRYPTO_HASH_SIZE_SHA256];</div>
<div class="line"><span class="keywordtype">size_t</span>   digest_len  = <span class="keyword">sizeof</span>(digest);</div>
<div class="line">uint32_t err_code;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Initialize crypto library before using any crypto functionality.</span></div>
<div class="line">err_code = <a class="code" href="group__nrf__crypto__initialization.html#gaf527041b3a9f57a73a516901e2968721" title="Function for initializing nrf_crypto and all registered backends.">nrf_crypto_init</a>();</div>
<div class="line"><a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Initialize context, prividing the key and pointer to info structure.</span></div>
<div class="line">err_code = <a class="code" href="group__nrf__crypto__hmac.html#ga70d6d56816342724a3fa3a788dda9a97" title="Initialize context object for HMAC.">nrf_crypto_hmac_init</a>(&amp;context,</div>
<div class="line">                                &amp;<a class="code" href="group__nrf__crypto__hmac.html#ga1a6d5a964d0910b62260e07942708ebd" title="Information structures used to select the specific algorithm (SHA-256)">g_nrf_crypto_hmac_sha256_info</a>,</div>
<div class="line">                                key,</div>
<div class="line">                                <span class="keyword">sizeof</span>(key));</div>
<div class="line"><a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Push message data.</span></div>
<div class="line">err_code = <a class="code" href="group__nrf__crypto__hmac.html#ga873e8577f2850218f50f712aa028afb2" title="Feed data to HMAC algorithm.">nrf_crypto_hmac_update</a>(&amp;context, data, <span class="keyword">sizeof</span>(data));</div>
<div class="line"><a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Finish calculation.</span></div>
<div class="line">err_code = <a class="code" href="group__nrf__crypto__hmac.html#gacf6e8a89d5f84f202fcc1da0b2668733" title="Calculate HMAC.">nrf_crypto_hmac_finalize</a>(&amp;context, digest, &amp;digest_len);</div>
<div class="line"><a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
</div><!-- fragment --><p>There is an integrated version of the HMAC frontend, <a class="el" href="group__nrf__crypto__hmac.html#ga836c207a02afc678e87dfbaef88f0a35">nrf_crypto_hmac_calculate</a>, which can be used when all data is available up front. The context is optional in this case, and is allocated internally using the <a class="el" href="group__nrf__crypto__mem.html">Dynamic memory management module</a> if the first parameter is set to NULL. The following example code demonstrates how to do the same calculation using the integrated function with internally allocated context memory.</p>
<div class="fragment"><div class="line">err_code = <a class="code" href="group__nrf__crypto__hmac.html#ga836c207a02afc678e87dfbaef88f0a35" title="Integrated HMAC wrapper function.">nrf_crypto_hmac_calculate</a>(</div>
<div class="line">    NULL,                           <span class="comment">// Context pointer..</span></div>
<div class="line">    &amp;<a class="code" href="group__nrf__crypto__hmac.html#ga1a6d5a964d0910b62260e07942708ebd" title="Information structures used to select the specific algorithm (SHA-256)">g_nrf_crypto_hmac_sha256_info</a>, <span class="comment">// Pointer to global info structure.</span></div>
<div class="line">    m_digest,                       <span class="comment">// Pointer to digest (result) buffer.</span></div>
<div class="line">    &amp;digest_len,                    <span class="comment">// Updated during call.</span></div>
<div class="line">    m_key,                          <span class="comment">// Pointer to key buffer.</span></div>
<div class="line">    <span class="keyword">sizeof</span>(m_key),                  <span class="comment">// Length of key.</span></div>
<div class="line">    m_data,                         <span class="comment">// Pointer to input data buffer.</span></div>
<div class="line">    <span class="keyword">sizeof</span>(m_data));                <span class="comment">// Length of input data.</span></div>
</div><!-- fragment --><h2><a class="anchor" id="lib_crypto_hmac_example"></a>
HMAC example project</h2>
<p>Refer to <a class="el" href="nrf_crypto_hmac_example.html">HMAC Example</a> for a usage example of this library.</p>
<p>For an example showing the verification procedure of HMAC, see <a class="el" href="nrf_crypto_test_example.html">Test Example</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
