<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: Secure DFU Bootloader over Serial Link (UART/USB)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sdk_app_serial_dfu_bootloader.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Secure DFU Bootloader over Serial Link (UART/USB) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Serial Secure DFU Bootloader example uses the <a class="el" href="lib_bootloader_modules.html">Bootloader and DFU modules</a> to implement a bootloader with secure Device Firmware Update (DFU) functionality. The SDK provides transport code for UART and for USB CDC ACM (nRF52840 only).</p>
<p>The example bootloader accepts images that contain a new bootloader, SoftDevice, application, or any combination of these. To protect the target device against malicious attackers trying to impersonate the rightful sender of the firmware update, the init packet of the firmware package must be signed.</p>
<h1><a class="anchor" id="sdk_app_serial_dfu_bootloader_setup"></a>
Setup</h1>
<p>Depending on the target board and SoftDevice, you can find the source code and the project file of the example in one of the following folders:</p>
<ul>
<li><code>&lt;InstallFolder&gt;\examples\dfu\secure_bootloader\pca10040_uart</code></li>
<li><code>&lt;InstallFolder&gt;\examples\dfu\secure_bootloader\pca10040e_uart</code></li>
<li><code>&lt;InstallFolder&gt;\examples\dfu\secure_bootloader\pca10056_uart</code></li>
<li><code>&lt;InstallFolder&gt;\examples\dfu\secure_bootloader\pca10056_usb</code></li>
<li><code>&lt;InstallFolder&gt;\examples\dfu\secure_bootloader\pca10056e_uart</code></li>
</ul>
<p><b>Button assignments</b>:</p>
<ul>
<li>Button 4: Holding this button during startup makes the device enter DFU mode.</li>
</ul>
<h1><a class="anchor" id="sdk_app_usb_dfu_bootloader_setup"></a>
USB Setup</h1>
<p>The USB Secure DFU Bootloader example uses the CDC ACM USB class, commonly known as Virtual COM port. After connecting the USB cable, the development kit enumerates as a COMx port on Windows hosts or as a <code>/dev/ttyACMx</code> device on Linux/Unix hosts. The port can be opened and closed just like a traditional serial port.</p>
<p>On Mac, Linux, and Windows 8 and later, the correct driver should be installed automatically.</p>
<h1><a class="anchor" id="serial_sdk_app_dfu_bootloader_test"></a>
Testing</h1>
<p>You can either create your own firmware package for testing or use one of the provided packages that are located in subfolders of <code>&lt;InstallFolder&gt;\examples\dfu\secure_dfu_test_images</code>. The provided packages have been generated using a private key that corresponds to the default public key in the project. This public key must not be used in production.</p>
<p>The following is the naming convention for the hex and zip files that you can use in this example:</p>
<ul>
<li>Application update:<ul>
<li><code>uart\nrf528xx\hrs_application_s1xx.hex</code> </li>
<li><code>uart\nrf528xx\hrs_application_s1xx.zip</code> </li>
<li><code>uart\nrf528xx\blinky_mbr.hex</code> </li>
<li><code>uart\nrf528xx\blinky_mbr.zip</code> </li>
</ul>
</li>
<li>SoftDevice:<ul>
<li><code>uart\nrf528xx\softdevice_s1xx.hex</code> </li>
<li><code>uart\nrf528xx\softdevice_s1xx.zip</code> </li>
</ul>
</li>
<li>MBR:<ul>
<li><code>uart\nrf528xx\mbr.hex</code> </li>
</ul>
</li>
<li>Bootloader:<ul>
<li><code>uart\nrf528xx\bootloader_secure_uart_debug_without_bonds_mbr.hex</code> </li>
<li><code>uart\nrf528xx\bootloader_secure_uart_debug_without_bonds_mbr.zip</code> </li>
</ul>
</li>
</ul>
<p>Test the Serial Secure DFU Bootloader application by performing the following steps:</p>
<ol type="1">
<li>If you want to create your own firmware package for testing:<ol type="a">
<li>Create a private key for the example. See <a class="el" href="lib_bootloader_dfu_keys.html">Working with keys</a> for instructions, and <a class="el" href="lib_bootloader_dfu_validation.html#lib_bootloader_signatures">Signature verification</a> for more information about signatures.<dl class="section note"><dt>Note</dt><dd>The private key should be kept with very limited distribution, because it can be used to create valid firmware images to update your device. It must never be lost, because without the key, there is no way to create new DFU images.</dd></dl>
</li>
<li>Create a public key in code format and store it in a file named <code>dfu_public_key.c</code>. See <a class="el" href="lib_bootloader_dfu_keys.html">Working with keys</a> for instructions.</li>
<li>Copy the <code>dfu_public_key.c</code> file to the project folder, replacing the existing file.</li>
<li>Prepare a firmware package (in zip format) that you want to use. See <a class="el" href="lib_bootloader_dfu_validation.html#lib_dfu_image">Creating a firmware package with nrfutil</a> for instructions.</li>
<li>Generate a HEX file that contains the <a class="el" href="lib_bootloader.html#lib_bootloader_settings_page">Bootloader Settings page</a>. See the <a href="https://infocenter.nordicsemi.com/topic/ug_nrfutil/UG/nrfutil/nrfutil_intro.html">nrfutil documentation</a> for instructions.</li>
</ol>
</li>
<li><a class="el" href="lib_crypto_backend_micro_ecc.html#lib_crypto_backend_micro_ecc_install">Install micro-ecc</a>. This library is required for the <a class="el" href="lib_crypto.html">Cryptography library - nrf_crypto</a>, which is used in the Serial Secure DFU Bootloader example.</li>
<li>Compile the bootloader.</li>
<li>If you generated a bootloader settings HEX file, flash it using the following command. <div class="fragment"><div class="line">nrfjprog --program --sectorerase settings.hex</div>
</div><!-- fragment --></li>
<li>Program the HEX file. See <a class="el" href="lib_bootloader.html#lib_bootloader_programming">Programming the bootloader</a>.</li>
<li>Make sure that the device enters DFU mode. DFU mode is indicated by LED 3 being lit. If a valid application is installed on the device, hold Button 4 during startup to prevent the bootloader from starting the application and force it to enter DFU mode instead.</li>
<li>If you are running the USB bootloader, and using Windows 7 (or XP), install the driver. To install the driver on Windows 7, follow these steps:<ul>
<li>
Open Device Manager</li>
<li>
Right-click the development kit (look for the name "nRF52 ..." depending on the example)</li>
<li>
Click "Update Driver Software..."</li>
<li>
Click "Browse my computer for driver software"</li>
<li>
Click "Browse..." and choose the folder sdk/nrf5/examples/usb_drivers</li>
<li>
Click "Ok"</li>
<li>
Click "Next"</li>
<li>
Click "Install"</li>
<li>
Click "Close"</li>
</ul>
</li>
<li>Check which COM port the device is connected to.</li>
<li>Enter the following command to start the DFU process over the serial link, where <em>package.zip</em> is the name of the firmware package that you want to upload and <em>COM_PORT</em> is the COM port to which the device is connected:<br/>
 <code>nrfutil dfu serial -pkg <em>package.zip</em> -p <em>COM_PORT</em></code> for UART transport<br/>
 <code>nrfutil dfu usb_serial -pkg <em>package.zip</em> -p <em>COM_PORT</em></code> for USB transport</li>
<li>Observe that the device resets and runs the new application, bootloader, or SoftDevice. </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
