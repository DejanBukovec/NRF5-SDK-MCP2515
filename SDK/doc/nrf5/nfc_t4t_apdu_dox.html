<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: APDU reader/writer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('nfc_t4t_apdu_dox.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">APDU reader/writer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Special communication units, called application protocol data units (APDUs), are used when exchanging data with a Type 4 Tag platform. Command APDUs (C-APDUs) are the commands sent from the NFC reader, while the response APDUs (R-APDUs) are the responses to a specific command received by NFC reader from the tag.</p>
<p>The APDU reader/writer module provides functions to encode a C-APDU according to its descriptor and to decode a raw R-APDU data into the appropriate descriptor. For the API documentation of this module, refer to <a class="el" href="group__nfc__t4t__apdu.html">APDU reader/writer</a>.</p>
<h1><a class="anchor" id="nfc_t4t_apdu_types"></a>
APDU types</h1>
<p>There are three types of APDU that are relevant for the Type 4 Tag platform:</p>
<table class="doxtable">
<tr>
<th>APDU type </th><th>Description</th></tr>
<tr>
<td>Select </td><td>Selection of applications or files. </td></tr>
<tr>
<td>ReadBinary </td><td>Reading data from a file. </td></tr>
<tr>
<td>UpdateBinary </td><td>Writing data to a file. </td></tr>
</table>
<h1><a class="anchor" id="nfc_t4t_apdu_format"></a>
C-APDU and R-APDU format</h1>
<p>A C-APDU consists of the following fields:</p>
<table class="doxtable">
<tr>
<th>Field </th><th>Length </th><th>Required </th><th>Description</th></tr>
<tr>
<td>CLA </td><td>1 byte </td><td>yes </td><td>Specifies the security level of the message. </td></tr>
<tr>
<td>INS </td><td>1 byte </td><td>yes </td><td>Specifies the command type to process. See <a class="el" href="nfc_t4t_apdu_dox.html#nfc_t4t_apdu_types">APDU types</a>. </td></tr>
<tr>
<td>P1 </td><td>1 byte </td><td>yes </td><td>Specifies the first parameter for the chosen command type. </td></tr>
<tr>
<td>P2 </td><td>1 byte </td><td>yes </td><td>Specifies the second parameter for the chosen command type. </td></tr>
<tr>
<td>Lc </td><td>1 or 3 bytes </td><td>no </td><td>Specifies the data length. </td></tr>
<tr>
<td>Data </td><td>Lc bytes </td><td>no </td><td>Required if LC field is present. Contains payload of C-APDU. </td></tr>
<tr>
<td>Le </td><td>1 or 2 bytes </td><td>no </td><td>Specifies the expected response body length of R-APDU. </td></tr>
</table>
<p>An R-APDU consists of the following fields:</p>
<table class="doxtable">
<tr>
<th>Field </th><th>Length </th><th>Required </th><th>Description</th></tr>
<tr>
<td>Response Body </td><td>variable </td><td>no </td><td>Carries the data of the R-APDU. </td></tr>
<tr>
<td>SW1 </td><td>1 byte </td><td>yes </td><td>Specifies the first status word. </td></tr>
<tr>
<td>SW2 </td><td>1 byte </td><td>yes </td><td>Specifies the second status word. </td></tr>
</table>
<h1><a class="anchor" id="nfc_t4t_apdu_generation"></a>
Generating C-APDU and decoding R-APDU</h1>
<p>The following code example shows how to build a C-APDU which can be used in CC/NDEF select procedure (see <a class="el" href="nfc_t4t_hl_detection_procedures_dox.html">Type 4 Tag NDEF detection procedure</a>):</p>
<div class="fragment"><div class="line"><a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a>          err_code;</div>
<div class="line"><a class="code" href="structnfc__t4t__comm__apdu__t.html" title="Command Application Protocol Data Unit (C-APDU) descriptor.">nfc_t4t_comm_apdu_t</a> capdu;</div>
<div class="line">uint8_t             apdu_buff[<a class="code" href="group__nfc__t4t__hl__detection__procedures__config.html#gacbcb903496a10665edc0f9436499ab98" title="Size (in bytes) of the buffer for APDU storage.">APDU_BUFF_SIZE</a>];</div>
<div class="line">uint8_t             file_id_buff[] = ...; <span class="comment">// 2-byte long File Identifier, for example: {0xE1, 0x04}</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__nfc__t4t__apdu.html#ga5b535ecb7c3df2b20a8592b4a1472f54" title="Function for clearing C-APDU descriptor and restoring its default values.">nfc_t4t_comm_apdu_clear</a>(&amp;capdu);</div>
<div class="line">capdu.<a class="code" href="structnfc__t4t__comm__apdu__t.html#ab74e9b99d7ee208ccef149d7eb9d5f03" title="The chosen code of instruction.">instruction</a> = <a class="code" href="group__nfc__t4t__apdu.html#gga5a1fded91694d450277317c11e019ed7a00c5df28d39126c0f6b293eed5412a2c" title="Code used for selecting EF or NDEF application.">NFC_T4T_CAPDU_SELECT_INS</a>;</div>
<div class="line">capdu.<a class="code" href="structnfc__t4t__comm__apdu__t.html#ada4fd649cdf833f212a2ba22d78a3c99" title="Parameters associated with the instruction code.">parameter</a>   = <a class="code" href="group__nfc__t4t__apdu.html#gaf22ef3404b2f7a74db9c58928d1874cf" title="Select by file identifier, first or only occurence.">SELECT_BY_FILE_ID</a>;</div>
<div class="line">capdu.<a class="code" href="structnfc__t4t__comm__apdu__t.html#a683afe10a10a1742da6f29996ae942e9" title="Optional data fields (Lc + data bytes).">data</a>.<a class="code" href="structnfc__t4t__apdu__data__t.html#ae0d30261e9b0dd8e6b9013dccced8b06" title="Pointer to data field.">p_buff</a> = file_id_buff;</div>
<div class="line">capdu.<a class="code" href="structnfc__t4t__comm__apdu__t.html#a683afe10a10a1742da6f29996ae942e9" title="Optional data fields (Lc + data bytes).">data</a>.<a class="code" href="structnfc__t4t__apdu__data__t.html#a0883a9926efecd0dbd1be823674aeea4" title="Data field length.">len</a>    = <span class="keyword">sizeof</span>(file_id_buff);</div>
<div class="line"></div>
<div class="line">uint16_t   apdu_buff_len = <a class="code" href="group__nfc__t4t__hl__detection__procedures__config.html#gacbcb903496a10665edc0f9436499ab98" title="Size (in bytes) of the buffer for APDU storage.">APDU_BUFF_SIZE</a>;</div>
<div class="line"><a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> err_code      = <a class="code" href="group__nfc__t4t__apdu.html#ga85f6c4c25d2733628b25bb88ba0c2679" title="Function for encoding C-APDU.">nfc_t4t_comm_apdu_encode</a>(&amp;capdu,</div>
<div class="line">                                                    apdu_buff,</div>
<div class="line">                                                    &amp;apdu_buff_len);</div>
<div class="line"><span class="keywordflow">if</span> (err_code != <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//Error during C-APDU generation.</span></div>
<div class="line">    <span class="keywordflow">return</span> err_code;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Note that the Le field is not present in this case.</p>
<p>The following code example shows how to create a C-APDU descriptor which can be used in CC/NDEF read procedure (see <a class="el" href="nfc_t4t_hl_detection_procedures_dox.html">Type 4 Tag NDEF detection procedure</a>):</p>
<div class="fragment"><div class="line">uint16_t file_offset        = ...; <span class="comment">// File offset where to start reading data.</span></div>
<div class="line">uint16_t file_bytes_to_read = ...; <span class="comment">// The number of bytes to be read from file.</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__nfc__t4t__apdu.html#ga5b535ecb7c3df2b20a8592b4a1472f54" title="Function for clearing C-APDU descriptor and restoring its default values.">nfc_t4t_comm_apdu_clear</a>(&amp;capdu);</div>
<div class="line">capdu.<a class="code" href="structnfc__t4t__comm__apdu__t.html#ab74e9b99d7ee208ccef149d7eb9d5f03" title="The chosen code of instruction.">instruction</a> = <a class="code" href="group__nfc__t4t__apdu.html#gga5a1fded91694d450277317c11e019ed7a5d947c7b80fed279a256a196df187594" title="Code used for selecting EF or NDEF application.">NFC_T4T_CAPDU_READ_INS</a>;</div>
<div class="line">capdu.<a class="code" href="structnfc__t4t__comm__apdu__t.html#ada4fd649cdf833f212a2ba22d78a3c99" title="Parameters associated with the instruction code.">parameter</a>   = file_offset;</div>
<div class="line">capdu.<a class="code" href="structnfc__t4t__comm__apdu__t.html#a0f60252d7ade27a90f839869c5fb6da9" title="Optional response length field (Le).">resp_len</a>    = file_bytes_to_read;</div>
</div><!-- fragment --><p>Note that Lc and Data fields are not present in this case. You must also ensure that the number of bytes to write (the value carried by the Le field) is not greater than the MLe (Maximum R-APDU data) field, which is located in the CC file.</p>
<p>The following code example shows how to create a C-APDU descriptor which can be used in the NDEF update procedure (see <a class="el" href="nfc_t4t_hl_detection_procedures_dox.html">Type 4 Tag NDEF detection procedure</a>):</p>
<div class="fragment"><div class="line">uint8_t  ndef_file_buff      = ...; <span class="comment">// NDEF file buffer.</span></div>
<div class="line">uint16_t file_offset         = ...; <span class="comment">// File offset where to start writing data.</span></div>
<div class="line">uint16_t file_bytes_to_write = ...; <span class="comment">// The number of bytes to be written to the file.</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__nfc__t4t__apdu.html#ga5b535ecb7c3df2b20a8592b4a1472f54" title="Function for clearing C-APDU descriptor and restoring its default values.">nfc_t4t_comm_apdu_clear</a>(&amp;capdu);</div>
<div class="line">capdu.<a class="code" href="structnfc__t4t__comm__apdu__t.html#ab74e9b99d7ee208ccef149d7eb9d5f03" title="The chosen code of instruction.">instruction</a> = <a class="code" href="group__nfc__t4t__apdu.html#gga5a1fded91694d450277317c11e019ed7ac8d6c34848bf119ea0a566c74f2da000" title="Code used for selecting EF or NDEF application.">NFC_T4T_CAPDU_UPDATE_INS</a>;</div>
<div class="line">capdu.<a class="code" href="structnfc__t4t__comm__apdu__t.html#ada4fd649cdf833f212a2ba22d78a3c99" title="Parameters associated with the instruction code.">parameter</a>   = file_offset;</div>
<div class="line">capdu.<a class="code" href="structnfc__t4t__comm__apdu__t.html#a683afe10a10a1742da6f29996ae942e9" title="Optional data fields (Lc + data bytes).">data</a>.<a class="code" href="structnfc__t4t__apdu__data__t.html#ae0d30261e9b0dd8e6b9013dccced8b06" title="Pointer to data field.">p_buff</a> = ndef_file_buff + file_offset;</div>
<div class="line">capdu.<a class="code" href="structnfc__t4t__comm__apdu__t.html#a683afe10a10a1742da6f29996ae942e9" title="Optional data fields (Lc + data bytes).">data</a>.<a class="code" href="structnfc__t4t__apdu__data__t.html#a0883a9926efecd0dbd1be823674aeea4" title="Data field length.">len</a>    = file_bytes_to_write;</div>
</div><!-- fragment --><p>Note that the Le field is not present in this case. You also need to ensure that the number of bytes to read (value carried by the Lc field) is not greater than the MLc (Maximum C-APDU data) field, which is located in the CC file.</p>
<p>The last code example shows how to decode a raw R-APDU data to its descriptor:</p>
<div class="fragment"><div class="line"><a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a>          err_code;</div>
<div class="line"><a class="code" href="structnfc__t4t__resp__apdu__t.html" title="Response Application Protocol Data Unit (R-APDU) descriptor.">nfc_t4t_resp_apdu_t</a> rapdu;</div>
<div class="line">uint8_t             rapdu_buff[] = ...; <span class="comment">// Buffer with raw R-APDU data.</span></div>
<div class="line"></div>
<div class="line">err_code = <a class="code" href="group__nfc__t4t__apdu.html#ga76dbbd9cfd82813db0263c7d75d21632" title="Function for decoding R-APDU.">nfc_t4t_resp_apdu_decode</a>(&amp;rapdu, rapdu_buff, <span class="keyword">sizeof</span>(rapdu_buff));</div>
<div class="line"><span class="keywordflow">if</span> (err_code != <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//Error during R-APDU decoding.</span></div>
<div class="line">    <span class="keywordflow">return</span> err_code;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//Print R-APDU descriptor.</span></div>
<div class="line"><a class="code" href="group__nfc__t4t__apdu.html#gaf5891f8c0a72c5d8ae4ee8609db142ba" title="Function for printing a R-APDU descriptor.">nfc_t4t_resp_apdu_printout</a>(p_rapdu);</div>
</div><!-- fragment --><p>Note that if the Response Body field is not present in the R-APDU, the data field in the R-APDU descriptor is equal to <b>NULL</b>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
