<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: Custom message generation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('nfc_ndef_message_module_dox.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Custom message generation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Use the <a class="el" href="group__nfc__ndef__msg.html">Custom NDEF messages</a> and <a class="el" href="group__nfc__ndef__record.html">Custom NDEF records</a> modules to create standardized messages and records that are not covered by other modules, or to create your own custom messages.</p>
<p>To generate a custom NDEF message, start by creating the records that make up the message. Next, generate an empty message of the required length and add the records to the message. Finally, encode and create the message.</p>
<p>You can choose the tag's platform with <a class="el" href="group__nfc__ndef__msg__config.html#ga7dec9661f74f64d0a767aa52f7bb1ef8">NFC_NDEF_MSG_TAG_TYPE</a> in <code>sdk_config.h</code>. In case of Type 2 Tag platform, an NDEF message is encoded according to the <a class="el" href="nfc_ndef_format_dox.html">NDEF message and record format</a>. In case of Type 4 Tag an additional field is added in front of an NDEF message. See <a class="el" href="nfc_type4tag_dox.html#nfc_t4t_ndef_file_format_dox">NDEF file format</a> for more details.</p>
<p>You can also encapsulate a message as payload for a record. For example, a Handover Request message contains several Alternative Carrier records. These records themselves are full messages that contain information about alternative carriers that can be used for further communication.</p>
<h1><a class="anchor" id="nfc_ndef_record_gen"></a>
Creating a record descriptor</h1>
<p>You can provide the payload of the record in binary format or in a different format that is then converted into binary format. The content of the record is defined in a record descriptor.</p>
<p>Use the <a class="el" href="group__nfc__ndef__record.html#ga0c6add9cd97a6471232ceeda0259a5ee">NFC_NDEF_RECORD_BIN_DATA_DEF</a> macro for binary data or the <a class="el" href="group__nfc__ndef__record.html#ga263be2f04f526fe782699de4eef1a8d6">NFC_NDEF_GENERIC_RECORD_DESC_DEF</a> macro for other data to create the record descriptor. You must provide header information for the record (for example, ID and type) and the payload data to the macro. For generic data that is not in binary format, you must also provide a payload constructor. This constructor converts the payload data to the needed format. For binary data, the module provides this constructor.</p>
<p>The following code example shows how to generate a record descriptor: </p>
<div class="fragment"><div class="line"><a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> error_code;</div>
<div class="line">uint32_t length;</div>
<div class="line">    <span class="comment"></span></div>
<div class="line"><span class="comment">/// Declare record descriptor by macro - create and initialize an instance of </span></div>
<div class="line"><span class="comment">///   nfc_ndef_record_desc_t.</span></div>
<div class="line"><span class="comment"></span><a class="code" href="group__nfc__ndef__record.html#ga263be2f04f526fe782699de4eef1a8d6" title="Macro for creating and initializing an NFC NDEF record descriptor for a generic record.">NFC_NDEF_GENERIC_RECORD_DESC_DEF</a>( record,</div>
<div class="line">                                  3,</div>
<div class="line">                                  id_string,</div>
<div class="line">                                  <span class="keyword">sizeof</span>(id_string),</div>
<div class="line">                                  type_string,</div>
<div class="line">                                  <span class="keyword">sizeof</span>(type_string),</div>
<div class="line">                                  payload_constructor, <span class="comment">// implementation provided by user</span></div>
<div class="line">                                  &amp;payload_constructor_data <span class="comment">// structure depends on user implementation</span></div>
<div class="line">                                );</div>
<div class="line"></div>
<div class="line"><span class="comment">// If required, get the record size to length variable.</span></div>
<div class="line">error_code = <a class="code" href="group__nfc__ndef__record.html#ga4614b8c81e9a09da3997f6043164b760" title="Function for encoding an NDEF record.">nfc_ndef_record_encode</a>( &amp;<a class="code" href="group__nfc__ndef__record.html#ga263be2f04f526fe782699de4eef1a8d6" title="Macro for creating and initializing an NFC NDEF record descriptor for a generic record.">NFC_NDEF_GENERIC_RECORD_DESC_DEF</a>(record),</div>
<div class="line">                                     <a class="code" href="group__nfc__ndef__record.html#ggaac285d185d9c34cea1a04069f48be22ead56f488e8dd34241202825a074db8664" title="Middle record.">NDEF_MIDDLE_RECORD</a>,</div>
<div class="line">                                     NULL,</div>
<div class="line">                                     &amp;length);</div>
</div><!-- fragment --><h1><a class="anchor" id="nfc_ndef_msg_gen"></a>
Creating a message</h1>
<p>A message consists of one or more records. Accordingly, a message descriptor (that holds the content of the message) contains an array of pointers to record descriptors.</p>
<p>Use the <a class="el" href="group__nfc__ndef__msg.html#gac3f18c4d9e06c7fc632334c9008bd876">NFC_NDEF_MSG_DEF</a> macro to create the message descriptor and the array of pointers. When creating the message descriptor, you specify how many records the message will contain, but you do not specify the actual records yet.</p>
<p>To add the records, use the <a class="el" href="group__nfc__ndef__msg.html#ga5f874809bd4d7b6c2068fc0451f6bbd6">nfc_ndef_msg_record_add</a> function.</p>
<p>After adding all records, call <a class="el" href="group__nfc__ndef__msg.html#gab4f85c163e23c18d988924603dbe8a8e">nfc_ndef_msg_encode</a> to actually create the message from the message descriptor. <a class="el" href="group__nfc__ndef__msg.html#gab4f85c163e23c18d988924603dbe8a8e">nfc_ndef_msg_encode</a> internally calls <a class="el" href="group__nfc__ndef__record.html#ga4614b8c81e9a09da3997f6043164b760">nfc_ndef_record_encode</a> to encode each record. The NDEF records are always encoded in long format. If no ID field is specified, a record without ID field is generated.</p>
<p>The following code example shows how to create two messages:</p>
<div class="fragment"><div class="line"><a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> error_code;</div>
<div class="line">uint8_t buffer_for_message[512];</div>
<div class="line">uint8_t buffer_for_message_2[128];</div>
<div class="line">uint32_t length;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Declare message descriptor by macro - create and initialize an instance of </span></div>
<div class="line"><span class="comment">//   nfc_ndef_msg_desc_t and an array of pointers to nfc_ndef_record_desc_t.</span></div>
<div class="line"><span class="comment">// The declared message can contain up to 2 records.</span></div>
<div class="line"><a class="code" href="group__nfc__ndef__msg.html#gac3f18c4d9e06c7fc632334c9008bd876" title="Macro for creating and initializing an NFC NDEF message descriptor.">NFC_NDEF_MSG_DEF</a>(my_message, 2);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add record_1 and record_2 to the message.</span></div>
<div class="line"><span class="comment">// record_1 and record_2 are record descriptors as created in the previous</span></div>
<div class="line"><span class="comment">//   code example.</span></div>
<div class="line">error_code = <a class="code" href="group__nfc__ndef__msg.html#ga5f874809bd4d7b6c2068fc0451f6bbd6" title="Function for adding a record to an NDEF message.">nfc_ndef_msg_record_add</a>( &amp;<a class="code" href="group__nfc__ndef__msg.html#ga5bdd3f823419cd0e4ecae129d0d118a8" title="Macro for accessing the NFC NDEF message descriptor instance that you created with NFC_NDEF_MSG_DEF...">NFC_NDEF_MSG</a>(my_message), record_1);</div>
<div class="line">error_code = <a class="code" href="group__nfc__ndef__msg.html#ga5f874809bd4d7b6c2068fc0451f6bbd6" title="Function for adding a record to an NDEF message.">nfc_ndef_msg_record_add</a>( &amp;<a class="code" href="group__nfc__ndef__msg.html#ga5bdd3f823419cd0e4ecae129d0d118a8" title="Macro for accessing the NFC NDEF message descriptor instance that you created with NFC_NDEF_MSG_DEF...">NFC_NDEF_MSG</a>(my_message), record_2);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Get the message size to the length variable.</span></div>
<div class="line">error_code_t = <a class="code" href="group__nfc__ndef__msg.html#gab4f85c163e23c18d988924603dbe8a8e" title="Function for encoding an NDEF message.">nfc_ndef_msg_encode</a>( &amp;<a class="code" href="group__nfc__ndef__msg.html#ga5bdd3f823419cd0e4ecae129d0d118a8" title="Macro for accessing the NFC NDEF message descriptor instance that you created with NFC_NDEF_MSG_DEF...">NFC_NDEF_MSG</a>(my_message),</div>
<div class="line">                                    NULL,</div>
<div class="line">                                    &amp;length);</div>
<div class="line">                                </div>
<div class="line"><span class="comment">// Encode the message to buffer_for_message.</span></div>
<div class="line">ASSERT(length &lt;= 512); <span class="comment">// make sure the message fits into the buffer</span></div>
<div class="line">error_code_t = <a class="code" href="group__nfc__ndef__msg.html#gab4f85c163e23c18d988924603dbe8a8e" title="Function for encoding an NDEF message.">nfc_ndef_msg_encode</a>( &amp;<a class="code" href="group__nfc__ndef__msg.html#ga5bdd3f823419cd0e4ecae129d0d118a8" title="Macro for accessing the NFC NDEF message descriptor instance that you created with NFC_NDEF_MSG_DEF...">NFC_NDEF_MSG</a>(my_message),</div>
<div class="line">                                    buffer_for_message,</div>
<div class="line">                                    &amp;length);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Clear the message description.                                </span></div>
<div class="line"><a class="code" href="group__nfc__ndef__msg.html#gae785b01fe0193ce0e3d76dc86373905f" title="Function for clearing an NDEF message.">nfc_ndef_msg_clear</a>( &amp;<a class="code" href="group__nfc__ndef__msg.html#ga5bdd3f823419cd0e4ecae129d0d118a8" title="Macro for accessing the NFC NDEF message descriptor instance that you created with NFC_NDEF_MSG_DEF...">NFC_NDEF_MSG</a>(my_message));</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add record_3 to the message.</span></div>
<div class="line"><span class="comment">// record_3 is a record descriptors as created in the previous code example.</span></div>
<div class="line">error_code = <a class="code" href="group__nfc__ndef__msg.html#ga5f874809bd4d7b6c2068fc0451f6bbd6" title="Function for adding a record to an NDEF message.">nfc_ndef_msg_record_add</a>( &amp;<a class="code" href="group__nfc__ndef__msg.html#ga5bdd3f823419cd0e4ecae129d0d118a8" title="Macro for accessing the NFC NDEF message descriptor instance that you created with NFC_NDEF_MSG_DEF...">NFC_NDEF_MSG</a>(my_message), record_3);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Encode another message to buffer_for_message_2.</span></div>
<div class="line">length = 128; <span class="comment">// amount of memory available for message</span></div>
<div class="line">error_code_t = <a class="code" href="group__nfc__ndef__msg.html#gab4f85c163e23c18d988924603dbe8a8e" title="Function for encoding an NDEF message.">nfc_ndef_msg_encode</a>( &amp;<a class="code" href="group__nfc__ndef__msg.html#ga5bdd3f823419cd0e4ecae129d0d118a8" title="Macro for accessing the NFC NDEF message descriptor instance that you created with NFC_NDEF_MSG_DEF...">NFC_NDEF_MSG</a>(my_message),</div>
<div class="line">                                    buffer_for_message_2,</div>
<div class="line">                                    &amp;length);</div>
</div><!-- fragment --><h1><a class="anchor" id="nfc_ndef_msg_rec"></a>
Encapsulating a message</h1>
<p>To encapsulate a message in a record so that it can be added to another message, use the <a class="el" href="group__nfc__ndef__msg.html#ga14ab9feec405e5ca5bc3ffb060c05155">NFC_NDEF_NESTED_NDEF_MSG_RECORD_DEF</a> macro to create the record descriptor. This record descriptor uses <a class="el" href="group__nfc__ndef__msg.html#gab4f85c163e23c18d988924603dbe8a8e">nfc_ndef_msg_encode</a> as payload constructor. You can then add this record descriptor to a message like any other record descriptor.</p>
<p>The following code example shows how to encapsulate a message as payload for a record:</p>
<div class="fragment"><div class="line"><span class="comment">// nested_message_desc is a message descriptor</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// declare a record descriptor with an NDEF message nested in payload</span></div>
<div class="line"><span class="comment">// create and initialize instance of nfc_ndef_record_desc_t</span></div>
<div class="line"><a class="code" href="group__nfc__ndef__msg.html#ga14ab9feec405e5ca5bc3ffb060c05155" title="Macro for creating and initializing an NFC NDEF record descriptor with an encapsulated NDEF message...">NFC_NDEF_NESTED_NDEF_MSG_RECORD_DEF</a>( compound_record,</div>
<div class="line">                                     3,</div>
<div class="line">                                     <span class="keyword">sizeof</span>(id_string),</div>
<div class="line">                                     id_string,</div>
<div class="line">                                     type_string,</div>
<div class="line">                                     <span class="keyword">sizeof</span>(type_string),</div>
<div class="line">                                     &amp;nested_message_desc );</div>
<div class="line">                                     </div>
<div class="line"><span class="comment">// add compound record to a message like any other record   </span></div>
<div class="line">error_code = <a class="code" href="group__nfc__ndef__msg.html#ga5f874809bd4d7b6c2068fc0451f6bbd6" title="Function for adding a record to an NDEF message.">nfc_ndef_msg_record_add</a>( &amp;<a class="code" href="group__nfc__ndef__msg.html#ga5bdd3f823419cd0e4ecae129d0d118a8" title="Macro for accessing the NFC NDEF message descriptor instance that you created with NFC_NDEF_MSG_DEF...">NFC_NDEF_MSG</a>(my_message), &amp;<a class="code" href="group__nfc__ndef__msg.html#ga6d7df740a2dd8943f1055dabe39781b8" title="Macro for accessing the NFC NDEF record descriptor instance that you created with NFC_NDEF_NESTED_NDE...">NFC_NDEF_NESTED_NDEF_MSG_RECORD</a>(compound_record));</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
