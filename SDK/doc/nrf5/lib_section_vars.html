<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: Experimental: Section variables</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_section_vars.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Experimental: Section variables </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Section variables are variables that are placed in a named section by different independent pieces of code (for example, files or modules), so that they can be shared. The section variables module facilitates the handling of section variables by abstracting the required compiler-specific code.</p>
<p>The sharing of variables happens at compile time (or more precisely, at link time). One module (the <em>registrar</em>) creates a named section that can hold variables. Other modules (the <em>registrants</em>) can then register variables to place them into the section at link time. Each variable can be accessed by the registrar and the registrant that created it.</p>
<p>Main reasons for using section variables are:</p>
<ul>
<li>Decoupled code: Section variables are declared in the registrant code, without having to change the code of the registrar.</li>
<li>Transparency: The registrant can access its section variables in the same way as any other variables.</li>
<li>Access control: Variables can be declared as static by the registrants and still be shared with the registrar.</li>
<li>Ease of use: The registrar can access all registered variables through macros that are provided by the section variables module.</li>
<li>No duplication of variables: The variable that is accessed by the registrar is the variable that the registrant created, not a copy.</li>
<li>Space efficiency: The required storage space is dynamically adjusted at link time, but frozen at run time.</li>
</ul>
<p>A typical use case for section variables is the initialization of a module that allows multiple users to register with it and that manages a shared resource (for example, <a class="el" href="lib_fstorage.html">Flash Storage (fstorage)</a>). Each of the users provides a configuration structure that is kept by the module. Without the use of section variables, these configuration structures can be dynamically registered at run time or handled through a shared header file. With run-time registration, the module can never know the final number of registrants. With a shared header file, you must modify the code of the registrar (which might be a library that you do not want to change). With section variables, the number of registrants is known immediately when the code runs, and you need to modify only the registrant code.</p>
<p>Section variables are used in <a class="el" href="lib_fstorage.html">Flash Storage (fstorage)</a> and <a class="el" href="lib_fds.html">Flash Data Storage (FDS)</a> to configure flash page usage, for example.</p>
<p>The following code examples show how to use section variables in an application. In a typical use case, there is one registrar module that creates the named section and uses the data in it and one or more registrant modules that register their data in the named section.</p>
<h1><a class="anchor" id="lib_section_vars_usage_create"></a>
Creating a named section</h1>
<p>Creating a named section requires two steps:</p>
<ol type="1">
<li>In the code of the registrar module, create and name the section (<em>section_name</em> in this example), indicating the data type of the variables to be stored in it (<em>data_type_t</em> in this example): <div class="fragment"><div class="line"><a class="code" href="group__nrf__log__backend__interface.html#ga70f92d89d4f1e729f64a02c6c6ff235e" title="Memory section where backends are located.">NRF_SECTION_DEF</a>(section_name, data_type_t);</div>
</div><!-- fragment --> Note that all variables in a named section must be of the same type.</li>
<li>If you are using GCC, tell the linker that there is a named section. To do so, add the following definition to the root level of the linker script that is used in the compilation (replace <em>section_name</em> with the name of your section): <div class="fragment"><div class="line">SECTIONS</div>
<div class="line">{</div>
<div class="line">  .section_name :</div>
<div class="line">  {</div>
<div class="line">    PROVIDE(__start_section_name = .);</div>
<div class="line">    KEEP(*(.section_name))</div>
<div class="line">    PROVIDE(__stop_section_name = .);</div>
<div class="line">  } &gt; RAM</div>
<div class="line">} INSERT AFTER .data;</div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="lib_section_vars_usage_regdata"></a>
Registering section set variables</h1>
<p>In the code of the registrant module, use the <a class="el" href="group__section__vars.html#gacc2a038db0790a770a318bbed65c43c3">NRF_SECTION_ITEM_REGISTER</a> macro to register a section variable. The following code example shows how to register the variable <em>var_name</em> of type <em>data_type_t</em> in the section named <em>section_name</em> and assign it the value <em>var_value</em>: </p>
<div class="fragment"><div class="line"><a class="code" href="group__section__vars.html#gacc2a038db0790a770a318bbed65c43c3" title="Macro for declaring a variable and registering it in a section.">NRF_SECTION_ITEM_REGISTER</a>(section_name, data_type_t var_name) = {var_value};</div>
</div><!-- fragment --><p>If the registrant does not require to update the value of the section variable, define the variable as const. If this is the case for all section variables in a named section, the section is placed in flash: </p>
<div class="fragment"><div class="line"><a class="code" href="group__section__vars.html#gacc2a038db0790a770a318bbed65c43c3" title="Macro for declaring a variable and registering it in a section.">NRF_SECTION_ITEM_REGISTER</a>(section_name, <span class="keyword">const</span> data_type_t var_name ) = {var_value};</div>
</div><!-- fragment --><p>To simplify registrations, you can define macros that fill in the name of the named section. See the following example from <a class="el" href="lib_fstorage.html">Flash Storage (fstorage)</a><span></span>: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define FS_REGISTER_CFG(cfg_var) NRF_SECTION_ITEM_REGISTER(fs_data, cfg_var)</span></div>
</div><!-- fragment --><h1><a class="anchor" id="lib_section_vars_usage_module_usage"></a>
Using section variables</h1>
<p>The <a class="el" href="group__section__vars.html">Section variables</a> module provides several macros that the registrar can use to retrieve section variables and information about the named section and the variables it contains.</p>
<p>The following code example shows how to iterate through all registered section variables to initialize the registrar module for all registrants:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> init_func(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> vars_cnt = <a class="code" href="group__section__vars.html#gaa717ca9ff9f8d78c9857ef88efc91faa" title="Macro for getting the number of variables in a section.">NRF_SECTION_ITEM_COUNT</a>(section_name, data_type_t);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; vars_cnt; i++)</div>
<div class="line">    {</div>
<div class="line">        data_type_t * p_var_name = <a class="code" href="group__section__vars.html#ga1169bdbbfb338a99e3dc363202f783d1" title="Macro for retrieving a variable from a section.">NRF_SECTION_ITEM_GET</a>(section_name, data_type_t, i);</div>
<div class="line">        <span class="comment">// Add initialization code here</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Using this module, it is not possible to control the order of the variables in a named section across compiler versions and across compilations. This feature is provided by <a class="el" href="lib_section_iter.html">Experimental: Section variables iterator</a>.</dd></dl>
<p><a class="el" href="lib_section_iter.html">Experimental: Section variables iterator</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
