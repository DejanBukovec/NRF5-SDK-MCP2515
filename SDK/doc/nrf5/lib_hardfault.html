<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: HardFault handling library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_hardfault.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">HardFault handling library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The HardFault handling library provides basic HardFault processing. The library can be used as is for default HardFault handling, or it can be extended to provide custom HardFault processing.</p>
<p>Some SDK examples contain a HardFault_Handler function similar to the following code snippet:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> HardFault_Handler(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">while</span> (1)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Should not happen</span></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>This kind of code can be useful in development, but it should never be used in production. The problem with this code is the assumption that this HardFault should never happen; it might happen because of a code error, electromagnetic interference (EMI) near the device, or glitches on power lines. In this case, the microcontroller will hang in an endless loop until the next reset, unless a <a class="el" href="hardware_driver_wdt.html">watchdog</a> is used in the code.</p>
<p>To avoid such error-prone code, this library implements a minimalistic HardFault handling that can be used in released code. When compiled with the DEBUG_NRF flag set, the library places a software breakpoint inside the HardFault_Handler code and adds functionality that helps to determine the problem that causes the HardFault exception.</p>
<h1><a class="anchor" id="lib_hardfault_usage"></a>
Using the library</h1>
<p>After including the HardFault handling library in the project, a new HardFault call stack is implemented according to the following picture:</p>
<div class="image">
<img src="hardfault_callstack.svg" alt="hardfault_callstack.svg"/>
<div class="caption">
HardFault call stack implemented in the library</div></div>
<p> In most applications, it is sufficient to use the default <a class="el" href="group__hardfault__default.html#gaf47f7bb4a3f3c48205621302fd965a11">HardFault_process</a> function that is implemented in the library. This function restarts the whole application using the NVIC_SystemReset function.</p>
<p>If the application requires more security, you can implement your own HardFault_process function and, for example, try to recover from HardFault exceptions or log these events.</p>
<p>If the DEBUG_NRF flag is defined for the preprocessor, a software breakpoint is set in HardFault_c_handler just before calling <a class="el" href="group__hardfault__default.html#gaf47f7bb4a3f3c48205621302fd965a11">HardFault_process</a>.</p>
<h1><a class="anchor" id="lib_hardfault_sp"></a>
Stack pointer</h1>
<p>The HardFault_Handler function processes the stack pointer at the time the HardFault exception occurs and passes it to the other functions.</p>
<p>Processing differs depending on the stack that was used at the time the HardFault exception was generated.</p>
<h2><a class="anchor" id="lib_hardfault_sp_process"></a>
Process stack</h2>
<p>If the HardFault exception occurs when the process stack is used, the address of the last data that was pushed is passed directly to the HardFault_c_Handler function.</p>
<p>The address is then cast to a stack pointer (<a class="el" href="group__hardfault__default.html#gaafe115a98dd049cb3f7857f181337322">HardFault_stack_t</a>). This type is a structure that represents the expected stack frame, which should help to debug the reason of the exception.</p>
<p>If no DEBUG_NRF flag is defined, this stack pointer is directly passed to the <a class="el" href="group__hardfault__default.html#gaf47f7bb4a3f3c48205621302fd965a11">HardFault_process</a> function. If the DEBUG_NRF flag is defined, the stack pointer is written to a global, volatile variable named HardFault_p_stack. In this way, the HardFault frame can be checked in the debugger independently of the selected compilation optimization.</p>
<h2><a class="anchor" id="lib_hardfault_sp_main"></a>
Main stack</h2>
<p>If the HardFault exception occurs when the main stack is selected, processing is more complicated.</p>
<p>The main stack is used during the HardFault exception processing, and in some specific cases, a HardFault exception might be generated because of a stack overrun. If such a stack overrun occurs when HardFault_c_handler is executed, another HardFault exception might be generated.</p>
<p>To avoid such situations, the stack pointer value is validated if the main stack was selected when the HardFault exception was generated. During validation, the library checks if the pointer points inside the defined stack area. If the pointer value is invalid, the stack pointer for the exception processing is set back to the default value.</p>
<p>If such a situation occurs, the value passed to the <a class="el" href="group__hardfault__default.html#gaf47f7bb4a3f3c48205621302fd965a11">HardFault_process</a> function as stack pointer argument is NULL. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
