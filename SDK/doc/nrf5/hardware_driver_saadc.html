<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: SAADC</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('hardware_driver_saadc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SAADC </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The SAADC driver includes two layers: the hardware access layer (HAL) and the driver layer (DRV).</p>
<p>The hardware access layer provides basic APIs for accessing the registers of the SAADC peripheral. See the API documentation for the <a class="el" href="group__nrf__saadc__hal.html">SAADC HAL</a> for details.</p>
<p>The driver layer provides APIs on a higher level than the HAL. See the API documentation for the <a class="el" href="group__nrf__drv__saadc.html">SAADC driver - legacy layer</a> for details.</p>
<p>Key features include:</p>
<ul>
<li>Blocking function to convert one sample on a single channel.</li>
<li>Non-blocking function for triggering conversion on all enabled channels to a provided buffer.</li>
<li>Double buffering: you can set up two buffers, and conversion to the new buffer starts immediately after the first one is filled.</li>
</ul>
<h1><a class="anchor" id="saadc_configuration"></a>
Driver configuration</h1>
<p>The SAADC default configuration is located in <code>sdk_config.h</code>. The SAADC must be explicitly enabled in <code>sdk_config.h</code> before the driver can be used. If <a class="el" href="group__nrf__drv__saadc.html#gace15be014bfbc23fd1b3b8ac252f875b">nrf_drv_saadc_init</a> is called with a NULL pointer to the configuration structure, the default configuration from <code>sdk_config.h</code> is used. You must provide an event handler function during initialization.</p>
<p>Driver configuration includes:</p>
<ul>
<li>Resolution</li>
<li>Enabling or disabling oversampling</li>
<li>Interrupt priority level</li>
<li>Enabling or disabling the low power mode</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>If oversampling is enabled, only one channel can be enabled. <a class="el" href="group__nrf__drv__saadc.html#gad032f5096978d3c3cd1fc8862af31404">nrf_drv_saadc_channel_init</a> asserts if this condition is not met.</dd></dl>
<p>Each channel is configured independently. Channels are configured and enabled by the function <a class="el" href="group__nrf__drv__saadc.html#gad032f5096978d3c3cd1fc8862af31404">nrf_drv_saadc_channel_init</a>. <a class="el" href="group__nrf__drv__saadc.html#gae884c3fa99758796096042d1405c1d8f">NRF_DRV_SAADC_DEFAULT_CHANNEL_CONFIG_SE</a> or <a class="el" href="group__nrf__drv__saadc.html#gace77828be7bbc7b1c350bc33c7a53a6e">NRF_DRV_SAADC_DEFAULT_CHANNEL_CONFIG_DIFFERENTIAL</a> can be used to build a default configuration for a channel.</p>
<p>Example: </p>
<div class="fragment"><div class="line"><a class="code" href="structnrf__saadc__channel__config__t.html" title="Analog-to-digital converter channel configuration structure.">nrf_saadc_channel_config_t</a> channel_config = <a class="code" href="group__nrf__drv__saadc.html#gae884c3fa99758796096042d1405c1d8f" title="Macro for forwarding the new implementation.">NRF_DRV_SAADC_DEFAULT_CHANNEL_CONFIG_SE</a>(<a class="code" href="group__nrf__saadc__hal.html#gga4adceebeae2b334a695d4aecb640fe35a22c85a1841e1ea0ad12bb4567c6b6b54" title="Analog input 6 (AIN6).">NRF_SAADC_INPUT_AIN6</a>);</div>
<div class="line">channel_config.<a class="code" href="structnrf__saadc__channel__config__t.html#ab18afcc483838dffbb0929d7b77a9d58" title="Gain control value.">gain</a> = <a class="code" href="group__nrf__saadc__hal.html#ggadda2525fbe5db392d1c1980c4a1286a0a1aafa7a93cf70c82f808db67c74f6e61" title="Gain factor 1/2.">NRF_SAADC_GAIN1_2</a>;</div>
<div class="line"><span class="comment">//Initialization and enabling of channel 0 to use analog input 6.</span></div>
<div class="line">err_code = <a class="code" href="group__nrf__drv__saadc.html#gad032f5096978d3c3cd1fc8862af31404" title="Macro for forwarding the new implementation.">nrf_drv_saadc_channel_init</a>(0, &amp;channel_config);</div>
</div><!-- fragment --><h1><a class="anchor" id="saadc_using"></a>
Using the SAADC driver</h1>
<p>The SAADC driver can be used in blocking mode or non-blocking mode.</p>
<h2><a class="anchor" id="saadc_blocking"></a>
Blocking mode</h2>
<p>The function <a class="el" href="group__nrf__drv__saadc.html#ga4f67c6dad745133956b9ffc9df68d145">nrf_drv_saadc_sample_convert</a> is blocking and returns when the requested channel is sampled. The channel must be initialized before it can be used. If the SAADC is busy, the function returns with an error. In blocking mode, the driver does not use the peripheral interrupt and there is no context switching inside the driver.</p>
<h2><a class="anchor" id="saadc_nonblocking"></a>
Non-blocking mode</h2>
<p>The function <a class="el" href="group__nrf__drv__saadc.html#ga6df4cb98bb337d1fcd6d8cf7ff0d3670">nrf_drv_saadc_buffer_convert</a> can be used to start conversion in non-blocking mode. The function returns immediately after the buffer is configured. If the driver is busy, it returns with an error. <a class="el" href="group__nrf__drv__saadc.html#ga6df4cb98bb337d1fcd6d8cf7ff0d3670">nrf_drv_saadc_buffer_convert</a> sets the SAADC up for conversion, but does not trigger sampling. To trigger sampling, call the function <a class="el" href="group__nrf__drv__saadc.html#gaf16a16c9de60276dd73cf1811c03ae73">nrf_drv_saadc_sample</a> or, through PPI, use the task SAMPLE from SAADC. <a class="el" href="group__nrf__drv__saadc.html#gaf762606bdb8f02559c003b179b088f9d">nrf_drv_saadc_sample_task_get</a> can be used to get the task address. Single sampling triggers conversion on all initialized channels. When the requested buffer is filled with samples, an event of type <a class="el" href="group__nrf__drv__saadc.html#gad82628a6672665db12638527013c7093">NRF_DRV_SAADC_EVT_DONE</a> is generated.</p>
<p>To enable the low power mode, you must specify this option when initializing the driver. You can do it by setting <a class="el" href="group__nrf__drv__saadc__config.html#ga7e7da65888f2c0169a53fbf379c1e79c">SAADC_CONFIG_LP_MODE</a> to true in the driver initialization configuration structure. When it is enabled, the driver uses less power, but more interrupts are generated. When using this mode, the parameter size of function <a class="el" href="group__nrf__drv__saadc.html#ga6df4cb98bb337d1fcd6d8cf7ff0d3670">nrf_drv_saadc_buffer_convert</a> must be a multiple of the number of enabled channels. Otherwise, undefined behavior may occur.</p>
<p>Example for sampling triggered by the CPU: </p>
<div class="fragment"><div class="line">err_code = <a class="code" href="group__nrf__drv__saadc.html#ga6df4cb98bb337d1fcd6d8cf7ff0d3670" title="Macro for forwarding the new implementation.">nrf_drv_saadc_buffer_convert</a>(buffer, 1);</div>
<div class="line"><span class="comment">//Check error.</span></div>
<div class="line">err_code = <a class="code" href="group__nrf__drv__saadc.html#gaf16a16c9de60276dd73cf1811c03ae73" title="Macro for forwarding the new implementation.">nrf_drv_saadc_sample</a>();</div>
<div class="line"><span class="comment">//Check error.</span></div>
<div class="line"><span class="comment">//Event handler is called immediately after conversion is finished.</span></div>
</div><!-- fragment --><p>Example for setting up sampling by PPI: </p>
<div class="fragment"><div class="line">err_code = <a class="code" href="group__nrf__drv__saadc.html#ga6df4cb98bb337d1fcd6d8cf7ff0d3670" title="Macro for forwarding the new implementation.">nrf_drv_saadc_buffer_convert</a>(buffer, length);</div>
<div class="line"><span class="comment">//Check error.</span></div>
<div class="line">uint32_t sample_task = <a class="code" href="group__nrf__drv__saadc.html#gaf762606bdb8f02559c003b179b088f9d" title="Macro for forwarding the new implementation.">nrf_drv_saadc_sample_task_get</a>();</div>
<div class="line"><span class="comment">//Set task end point in PPI using sample_task variable.</span></div>
</div><!-- fragment --><p>The driver supports double buffering, which means that <a class="el" href="group__nrf__drv__saadc.html#ga6df4cb98bb337d1fcd6d8cf7ff0d3670">nrf_drv_saadc_buffer_convert</a> can be called twice and the buffer that is provided in the second call will be used immediately after the first one is filled.</p>
<p>Continuous conversion can be achieved by setting up two buffers and calling <a class="el" href="group__nrf__drv__saadc.html#ga6df4cb98bb337d1fcd6d8cf7ff0d3670">nrf_drv_saadc_buffer_convert</a> again in the event handler to switch between them later.</p>
<p>Example for setting up two buffers: </p>
<div class="fragment"><div class="line">err_code = <a class="code" href="group__nrf__drv__saadc.html#ga6df4cb98bb337d1fcd6d8cf7ff0d3670" title="Macro for forwarding the new implementation.">nrf_drv_saadc_buffer_convert</a>(buffer1, length1);</div>
<div class="line"><span class="comment">//Check error.</span></div>
<div class="line">err_code = <a class="code" href="group__nrf__drv__saadc.html#ga6df4cb98bb337d1fcd6d8cf7ff0d3670" title="Macro for forwarding the new implementation.">nrf_drv_saadc_buffer_convert</a>(buffer2, length2);</div>
<div class="line"><span class="comment">//Check error.</span></div>
</div><!-- fragment --><p>Example for setting up a completed buffer again in the event handler: </p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> event_handler(<a class="code" href="group__nrf__drv__saadc.html#gaf48d37492f77bd4f7adbb7557afe82e6" title="Macro for forwarding the new implementation.">nrf_drv_saadc_evt_t</a> * p_event)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (p_event-&gt;type == <a class="code" href="group__nrf__drv__saadc.html#gad82628a6672665db12638527013c7093" title="Macro for forwarding the new implementation.">NRF_DRV_SAADC_EVT_DONE</a>)</div>
<div class="line">    {</div>
<div class="line">        err_code = <a class="code" href="group__nrf__drv__saadc.html#ga6df4cb98bb337d1fcd6d8cf7ff0d3670" title="Macro for forwarding the new implementation.">nrf_drv_saadc_buffer_convert</a>(p_event-&gt;data.done.p_buffer, SAMPLES_IN_BUFFER);</div>
<div class="line">        <span class="comment">//Check error.</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>To configure the SAADC to continue conversion to the second buffer, SAADC interrupts must be handled. However, if only one channel is used, EasyDMA could automatically start processing using the second buffer if PPI is used to bind SAADC END events with the SAADC START task. This is not done by the driver because it is only controlling the SAADC peripheral, but it can be done in the application code.</p>
<h2><a class="anchor" id="saadc_limits"></a>
Limits</h2>
<p>The driver can generate events of type <a class="el" href="group__nrf__drv__saadc.html#ga4493540f262051dd59626e7f638f6d43">NRF_DRV_SAADC_EVT_LIMIT</a> if the converted sample on a given channel is exceeding a limit. You can set two limits per channel: high and low. The function <a class="el" href="group__nrf__drv__saadc.html#ga6fee513225d5d3706da89ab3ed73364c">nrf_drv_saadc_limits_set</a> can be used to configure these limits. The function sets both limits; if only one limit should be enabled, the second can be disabled by using <a class="el" href="group__nrf__drv__saadc.html#gaad2ce56039dc27a87d2a6e3a2a45c358">NRF_DRV_SAADC_LIMITH_DISABLED</a> for the high limit or <a class="el" href="group__nrf__drv__saadc.html#gade05a1ebea427f219101d351ac8c2191">NRF_DRV_SAADC_LIMITL_DISABLED</a> for the low limit.</p>
<p>The limit event will be generated by every sample that exceeds the limit. If this is not desired, it can be disabled in the event handler. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
