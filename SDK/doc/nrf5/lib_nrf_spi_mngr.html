<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: SPI transaction manager</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_nrf_spi_mngr.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SPI transaction manager </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The SPI transaction manager library provides functions to create and execute transactions consisting of one or more data transfers via the serial peripheral interface (SPI).</p>
<p>Transactions can be run in the background or in blocking mode:</p>
<ul>
<li><b>Background</b>: When the application schedules a transaction in the background (<a class="el" href="group__nrf__spi__mngr.html#ga32d9a5eeba9138e2e481ff800441188a">nrf_spi_mngr_schedule</a>), it receives a callback from the library when the transaction has completed or when the transaction is interrupted due to an error.</li>
<li><b>Blocking mode</b>: When an application schedules a transaction in blocking mode (<a class="el" href="group__nrf__spi__mngr.html#ga461062625c3cd4f9649a7ccc32c0e599">nrf_spi_mngr_perform</a>), the function does not return until the transaction has finished (successfully or with an error).</li>
</ul>
<p>Transactions can be requested from different contexts, including interrupt handlers. The library takes care of proper synchronization.</p>
<p>The SPI transaction manager library supports setting transactions with different hardware configurations. For example, if you want to connect slave devices to different pins or with different frequency, you can set up a transaction with parameter <code>p_required_spi_cfg</code> that points to the required hardware configuration. The SPI driver will be reinitialized every time the required configuration will differ from the one from the previous transaction.</p>
<p>Code example:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="structnrf__drv__spi__config__t.html" title="SPI master driver instance configuration structure.">nrf_drv_spi_config_t</a> <span class="keyword">const</span> new_configuration =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="structnrf__drv__spi__config__t.html#abf3cf198b28cefa35a8cac4bebf490fc" title="SCK pin number.">sck_pin</a>        = ARDUINO_A0_PIN,</div>
<div class="line">    .mosi_pin       = ARDUINO_A1_PIN,</div>
<div class="line">    .miso_pin       = ARDUINO_A2_PIN,</div>
<div class="line">    .ss_pin         = ARDUINO_SDA_PIN,</div>
<div class="line">    .irq_priority   = <a class="code" href="group__app__util__platform.html#gga1a193131d1d5911b1ec53f9541841b1ba984bf731222fa242224a4bd5d0086801">APP_IRQ_PRIORITY_LOWEST</a>,</div>
<div class="line">    .orc            = 0xFF,</div>
<div class="line">    .frequency      = <a class="code" href="group__nrf__drv__spi.html#ggac1459c26ee8246b38ee5f78a848d1d11ad0b1447776d7367e3cfd1146dac344ae" title="1 Mbps.">NRF_DRV_SPI_FREQ_1M</a>,</div>
<div class="line">    .mode           = <a class="code" href="group__nrf__drv__spi.html#ggaffa6ae4610096303b0110c9d1e714251a9f5450d125b70ece0486cab6d7b84e98" title="SCK active high, sample on leading edge of clock.">NRF_DRV_SPI_MODE_0</a>,</div>
<div class="line">    .bit_order      = <a class="code" href="group__nrf__drv__spi.html#gga8933dec96c2369d6fcc624882f5d6e2fa17d202da2f37a420477a92561a4b8953" title="Most significant bit shifted out first.">NRF_DRV_SPI_BIT_ORDER_MSB_FIRST</a></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structnrf__spi__mngr__transfer__t.html" title="SPI transfer descriptor.">nrf_spi_mngr_transfer_t</a> <span class="keyword">const</span> transfers[] =</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__nrf__spi__mngr.html#ga409d1dba1e3bd48b912363d3d6b13a4c" title="Macro for creating a simple SPI transfer.">NRF_SPI_MNGR_TRANSFER</a>(m_master_data_0, <span class="keyword">sizeof</span>(m_master_data_0), m_master_buffer_rx, <span class="keyword">sizeof</span>(m_master_buffer_rx))</div>
<div class="line">    <a class="code" href="group__nrf__spi__mngr.html#ga409d1dba1e3bd48b912363d3d6b13a4c" title="Macro for creating a simple SPI transfer.">NRF_SPI_MNGR_TRANSFER</a>(m_master_data_1, sizeof(m_master_data_1), m_master_buffer_rx, sizeof(m_master_buffer_rx))</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">static <a class="code" href="structnrf__spi__mngr__transaction__t.html" title="SPI transaction descriptor.">nrf_spi_mngr_transaction_t</a> transaction_1 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="structnrf__spi__mngr__transaction__t.html#ad2fabe46fdb46b8ee22b9e22de16d6e0" title="User-specified function to be called before the transaction is started.">begin_callback</a>      = NULL,</div>
<div class="line">    .end_callback        = cb_transaction_done,</div>
<div class="line">    .p_user_data         = (<span class="keywordtype">void</span> *)0,</div>
<div class="line">    .p_transfers         = transfers,</div>
<div class="line">    .number_of_transfers = <span class="keyword">sizeof</span>(transfers) / <span class="keyword">sizeof</span>(transfers[0]),</div>
<div class="line">    .p_required_spi_cfg  = NULL</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structnrf__spi__mngr__transaction__t.html" title="SPI transaction descriptor.">nrf_spi_mngr_transaction_t</a> transaction_2 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="structnrf__spi__mngr__transaction__t.html#ad2fabe46fdb46b8ee22b9e22de16d6e0" title="User-specified function to be called before the transaction is started.">begin_callback</a>      = NULL,</div>
<div class="line">    .end_callback        = cb_transaction_done,</div>
<div class="line">    .p_user_data         = (<span class="keywordtype">void</span> *)0,</div>
<div class="line">    .p_transfers         = transfers,</div>
<div class="line">    .number_of_transfers = <span class="keyword">sizeof</span>(transfers) / <span class="keyword">sizeof</span>(transfers[0]),</div>
<div class="line">    .p_required_spi_cfg  = &amp;new_configuration</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structnrf__spi__mngr__transaction__t.html" title="SPI transaction descriptor.">nrf_spi_mngr_transaction_t</a> transaction_3 =</div>
<div class="line">{</div>
<div class="line">    .<a class="code" href="structnrf__spi__mngr__transaction__t.html#ad2fabe46fdb46b8ee22b9e22de16d6e0" title="User-specified function to be called before the transaction is started.">begin_callback</a>      = NULL,</div>
<div class="line">    .end_callback        = cb_transaction_done,</div>
<div class="line">    .p_user_data         = (<span class="keywordtype">void</span> *)0,</div>
<div class="line">    .p_transfers         = transfers,</div>
<div class="line">    .number_of_transfers = <span class="keyword">sizeof</span>(transfers) / <span class="keyword">sizeof</span>(transfers[0]),</div>
<div class="line">    .p_required_spi_cfg  = NULL</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(<a class="code" href="group__nrf__spi__mngr.html#ga32d9a5eeba9138e2e481ff800441188a" title="Function for scheduling an SPI transaction.">nrf_spi_mngr_schedule</a>(&amp;m_nrf_spi_mngr, &amp;transaction_1));</div>
<div class="line"><a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(<a class="code" href="group__nrf__spi__mngr.html#ga32d9a5eeba9138e2e481ff800441188a" title="Function for scheduling an SPI transaction.">nrf_spi_mngr_schedule</a>(&amp;m_nrf_spi_mngr, &amp;transaction_2));</div>
<div class="line"><a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(<a class="code" href="group__nrf__spi__mngr.html#ga32d9a5eeba9138e2e481ff800441188a" title="Function for scheduling an SPI transaction.">nrf_spi_mngr_schedule</a>(&amp;m_nrf_spi_mngr, &amp;transaction_3));</div>
</div><!-- fragment --><p>In the code example above, the <code>new_configuration</code> is different from the default configuration. In this case, SPI transaction manager will schedule and execute transaction_1 and then schedule the other two transactions. However, before executing transaction_2, it will reinitialize SPI hardware with the given configuration. Then, again, before executing transaction_3, SPI hardware will be reinitialized to the default configuration.</p>
<p>SPI transaction manager comes with two callbacks: begin_callback and end_callback. This approach allows you to execute some code before the SPI transaction is started. It might be useful when handling LCD displays (e.g. based on the ST7565 driver), which require changing the GPIO line to switch between frame types: command / data.</p>
<p>For API documentation of this library, refer to: <a class="el" href="group__nrf__spi__mngr.html">SPI transaction manager</a>.</p>
<p>See the <a class="el" href="nrf_spi_mngr_example.html">SPI Transaction Manager Example</a> for a usage example. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
