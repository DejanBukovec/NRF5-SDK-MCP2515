<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: Clock</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('hardware_driver_clock.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Clock </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The clock driver includes two layers: the hardware access layer (HAL) and the driver layer (DRV).</p>
<p>The hardware access layer provides basic APIs for accessing the registers of the clock. See the API documentation for the <a class="el" href="group__nrf__clock__hal.html">Clock HAL</a> for details.</p>
<p>The driver layer provides APIs on a higher level than the HAL. See the API documentation for the <a class="el" href="group__nrf__drv__clock.html">Clock driver - legacy layer</a> for details.</p>
<p>The clock driver is responsible for starting the high-accuracy, high-frequency clock source and the low-frequency clock (without a SoftDevice). It also performs calibration without a SoftDevice or internal RC as an LFCLK source.</p>
<h1><a class="anchor" id="hardware_driver_clock_configuration"></a>
Driver configuration</h1>
<p>Enable the driver in the configuration file <code>sdk_config.h</code> before using it in an application. The clock driver supports only the static, compile-time configuration due to the possibility of other modules attempting to initialize it. The configuration includes the high-frequency clock frequency, the low-frequency clock source, and the interrupt priority.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define NRF_CLOCK_ENABLED 1</span></div>
</div><!-- fragment --><p>Enabling the clock will initialize the <a class="el" href="group__nrf__drv__clock.html">Clock driver - legacy layer</a> to its default state:</p>
<ul>
<li>High-accuracy, high-frequency clock HFCLK is off</li>
<li>Low-frequency clock LFCLOCK is off (without a SoftDevice)</li>
<li>Calibration has not started (without a SoftDevice only)</li>
</ul>
<h1><a class="anchor" id="hardware_driver_clock_hfclk"></a>
Controlling the HFCLK</h1>
<p>If a module needs a high-precision clock, it can request the clock driver to start it. If a callback is provided, it will be called after the request is handled. If the requested clock was already started when <a class="el" href="group__nrf__drv__clock.html#ga425c8dc0508bb9c0777da123b7c66f3d">nrf_drv_clock_hfclk_request</a> is called, the callback will be called from the context of this function. Otherwise, it will be called from the context of the clock interrupt handler. To check if the HFCLK is on, call <a class="el" href="group__nrf__drv__clock.html#gae25988638664f2e4da8512b221adfdfd">nrf_drv_clock_hfclk_is_running</a>.</p>
<p>When the module is finished with the HFCLK, you should release it by calling <a class="el" href="group__nrf__drv__clock.html#ga5ca3bff3e9a29a62561329f71277800d">nrf_drv_clock_hfclk_release</a>. The clock is turned off if no other module is requesting it.</p>
<p>The SoftDevice API is used in the driver if a SoftDevice is present.</p>
<h1><a class="anchor" id="hardware_driver_clock_lfclk"></a>
Controlling the LFCLK (without a SoftDevice only)</h1>
<p>If a module needs a low-frequency clock, it can request the clock driver to start it. If a callback is provided, it will be called after the request is handled. If the requested clock was already started when <a class="el" href="group__nrf__drv__clock.html#gadde175e700480af88fe9c62d08213a7d">nrf_drv_clock_lfclk_request</a> is called, the callback will be called from the context of this function. Otherwise, it will be called from the context of the clock interrupt handler. To check if the LFCLK is on, call <a class="el" href="group__nrf__drv__clock.html#gaa9387d5ea7f15b7370a24f0f0ca32135">nrf_drv_clock_lfclk_is_running</a>.</p>
<p>When the module is finished with the LFCLK, you should release it by calling <a class="el" href="group__nrf__drv__clock.html#ga53782b568462caffface47e0e042833b">nrf_drv_clock_lfclk_release</a>. The clock is turned off if no other module is requesting it.</p>
<p>The SoftDevice API is used in the driver if a SoftDevice is present.</p>
<h1><a class="anchor" id="hardware_driver_clock_calibration"></a>
Controlling the calibration of the LFCLK (without a SoftDevice and using RC as source clock)</h1>
<p>The internal RC can be used as source for the LFCLK, but it is not as precise as a crystal. It must be periodically calibrated against a high-frequency crystal. The clock module supports autonomous calibration. It also has a built-in low-power timer dedicated to calibration.</p>
<p>The calibration process consists of three phases:</p>
<ul>
<li>Delay (using a clock calibration timer); delay can be set to 0 to start calibration immediately</li>
<li>Request the high-accuracy HFCLK</li>
<li>Perform calibration</li>
</ul>
<p>Call <a class="el" href="group__nrf__drv__clock.html#ga93b0001e58ed23a705c8cb25cb1fce92">nrf_drv_clock_calibration_start</a> to start the calibration process. Parameters specify the delay (given in 0.25 ms units) and an optional callback to be called once calibration is completed.</p>
<p>To check if there is an ongoing calibration, call <a class="el" href="group__nrf__drv__clock.html#ga527334cd657bd4ad4e1cc4fd7f9062f6">nrf_drv_clock_is_calibrating</a>.</p>
<p>At any time, <a class="el" href="group__nrf__drv__clock.html#ga7faf9c31c5dee87d3751d2d327076723">nrf_drv_clock_calibration_abort</a> can be called to stop calibration. If a callback was provided for <a class="el" href="group__nrf__drv__clock.html#ga93b0001e58ed23a705c8cb25cb1fce92">nrf_drv_clock_calibration_start</a>, the callback is executed when the process stops, with the event type set to <a class="el" href="group__nrf__drv__clock.html#gga864e990162053ed4c1ff711817ca6151ad35e8c1391de23bd09945a7188d0f4bb">NRF_DRV_CLOCK_EVT_CAL_ABORTED</a>.</p>
<p>Periodic calibration can be achieved by calling <a class="el" href="group__nrf__drv__clock.html#ga93b0001e58ed23a705c8cb25cb1fce92">nrf_drv_clock_calibration_start</a> from the calibration completion handler:</p>
<div class="fragment"><div class="line"> <span class="keywordtype">void</span> clock_handler(<a class="code" href="group__nrf__drv__clock.html#ga864e990162053ed4c1ff711817ca6151" title="Clock events.">nrf_drv_clock_evt_type_t</a> event)</div>
<div class="line"> {</div>
<div class="line"> <span class="keywordflow">if</span> (event == <a class="code" href="group__nrf__drv__clock.html#gga864e990162053ed4c1ff711817ca6151adcf442cfeeb5fe7b117a9cc22a96aefb" title="Calibration is done.">NRF_DRV_CLOCK_EVT_CAL_DONE</a>)</div>
<div class="line">{ ret = <a class="code" href="group__nrf__drv__clock.html#ga93b0001e58ed23a705c8cb25cb1fce92" title="Function for starting a single calibration process.">nrf_drv_clock_calibration_start</a>(10, clock_handler); } </div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
