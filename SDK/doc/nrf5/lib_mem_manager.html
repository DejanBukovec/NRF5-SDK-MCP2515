<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: Memory Manager</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_mem_manager.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Memory Manager </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Memory Manager provides dynamic access to RAM, which makes it possible to use memory as needed instead of having to reserve it statically at compile time. To avoid memory fragmentation and the resulting need to move data, the module implements fixed-size block allocation.</p>
<p>The fixed-size blocks are categorized into seven categories: xxsmall, xsmall, small, medium, large, xlarge, xxlarge. The application can configure how big each block should be and how many of these blocks should be allocated.</p>
<p>The following table shows which parameters must be set to define the number and size of memory blocks of a certain category:</p>
<table class="doxtable">
<tr>
<th>Category </th><th>Parameters </th></tr>
<tr>
<td>XXSmall </td><td>MEMORY_MANAGER_XXSMALL_BLOCK_SIZE <br/>
 MEMORY_MANAGER_XXSMALL_BLOCK_COUNT </td></tr>
<tr>
<td>XSmall </td><td>MEMORY_MANAGER_XSMALL_BLOCK_SIZE <br/>
 MEMORY_MANAGER_XSMALL_BLOCK_COUNT </td></tr>
<tr>
<td>Small </td><td>MEMORY_MANAGER_SMALL_BLOCK_SIZE <br/>
 MEMORY_MANAGER_SMALL_BLOCK_COUNT </td></tr>
<tr>
<td>Medium </td><td>MEMORY_MANAGER_MEDIUM_BLOCK_SIZE <br/>
 MEMORY_MANAGER_MEDIUM_BLOCK_COUNT </td></tr>
<tr>
<td>Large </td><td>MEMORY_MANAGER_LARGE_BLOCK_COUNT <br/>
 MEMORY_MANAGER_LARGE_BLOCK_SIZE </td></tr>
<tr>
<td>XLarge </td><td>MEMORY_MANAGER_XLARGE_BLOCK_COUNT <br/>
 MEMORY_MANAGER_XLARGE_BLOCK_SIZE </td></tr>
<tr>
<td>XXLarge </td><td>MEMORY_MANAGER_XXLARGE_BLOCK_COUNT<br/>
 MEMORY_MANAGER_XXLARGE_BLOCK_SIZE </td></tr>
</table>
<p>If you do not want to use all seven categories, define the block count of the categories that you do not want to use to be zero. Alternatively, only set the block count and size for the block categories that you want to use.</p>
<h1><a class="anchor" id="MEM_MANAGER"></a>
Memory allocation</h1>
<p>The application that requests the memory does not need to know how the memory allocation is handled internally. The Memory Manager hides the information which pool was used to allocate the requested memory from the application.</p>
<p>The requested memory can be of any size; the application does not need to request a buffer that is equal to the size of one of the block sizes. The application is not informed which block category was used for the allocation. In most cases, the smallest block that can hold the requested memory is used. However, in a situation where all blocks of best fitting are in use and another memory block is requested, the module will provide memory from the next free block category.</p>
<p>For example, assume that the module is configured to use three block sizes (small, medium, and large) of 128, 512, and 1024 bytes, respectively. If the application requests 80 bytes of memory, the best fitting category is the small block category. However, if all small blocks are in use, the module will promote the block category to medium and look for a free block. If no blocks are available in this category either, the module will promote the block category to large to find a buffer.</p>
<p>See the following flow chart for the buffer allocation algorithm that is used. The function that is used to allocate a buffer is called <a class="el" href="group__mem__manager.html#gaf0d9de2d7b668e75e1dec2e87b02bc9c">nrf_malloc</a>.</p>
<div class="image">
<img src="memory_manager_allocation_algorithm.svg" alt="memory_manager_allocation_algorithm.svg"/>
<div class="caption">
Memory Manager allocation algorithm</div></div>
<p> To determine the best configuration of blocks for the application, use the diagnostic function <a class="el" href="group__mem__manager.html#ga6de1549851e0341e1531fb5f6a2786c6">nrf_mem_diagnose</a>. This function is disabled by default, but it can be enabled by defining MEM_MANAGER_ENABLE_DIAGNOSTICS to 1. If this macro is defined, the module keeps track of the maximum and minimum memory sizes allocated in each category for each block until <a class="el" href="group__mem__manager.html#ga6de1549851e0341e1531fb5f6a2786c6">nrf_mem_diagnose</a> is called. It also provides information on the number of blocks that are in use when the function is called. The diagnostic information is displayed using app_trace. To enable only diagnostic trace and disable all other trace output, define MEM_MANAGER_DIAGNOSTICS_LOGS_ONLY to 1.</p>
<h1><a class="anchor" id="MEM_MANAGER_CONF"></a>
Configuration parameters</h1>
<p>The following configuration parameters should be defined in <code>sdk_config.h</code>.</p>
<h2><a class="anchor" id="mem_manager_params_logs"></a>
MEM_MANAGER_ENABLE_LOGS</h2>
<p>Enable debug tracing in the module. To enable tracing, this flag must be set to 1 and NRF_LOG_ENABLED must be set to 1. By default, debug tracing is disabled. </p>
<table class="doxtable">
<tr>
<th>Description </th><th>Value </th></tr>
<tr>
<td>Enable debug trace </td><td>1 </td></tr>
<tr>
<td>Disable debug trace </td><td>0 </td></tr>
<tr>
<td>Dependencies </td><td>NRF_LOG_ENABLED </td></tr>
</table>
<h2><a class="anchor" id="mem_manager_params_diagnostics"></a>
MEM_MANAGER_ENABLE_DIAGNOSTICS</h2>
<p>Enable diagnostic information on block usage in the module. To enable diagnostics, this flag must be defined. To display diagnostic information, at least one of MEM_MANAGER_ENABLE_LOGS or MEM_MANAGER_DIAGNOSTICS_LOGS_ONLY must be set to 1. By default, diagnostics is disabled. </p>
<table class="doxtable">
<tr>
<th>Description </th><th>Value </th></tr>
<tr>
<td>Dependencies </td><td>MEM_MANAGER_ENABLE_LOGS or MEM_MANAGER_DIAGNOSTICS_LOGS_ONLY </td></tr>
</table>
<h2><a class="anchor" id="mem_manager_params_diag_only"></a>
MEM_MANAGER_DIAGNOSTICS_LOGS_ONLY</h2>
<p>Disable display of trace information other than diagnostic information. To display only diagnostic information, this flag must be set to 1. By default, this macro is disabled. </p>
<table class="doxtable">
<tr>
<th>Description </th><th>Value </th></tr>
<tr>
<td>Enable debug trace </td><td>1 </td></tr>
<tr>
<td>Disable debug trace </td><td>0 </td></tr>
<tr>
<td>Dependencies </td><td>MEM_MANAGER_DIAGNOSTICS_LOGS_ONLY </td></tr>
</table>
<p>If diagnostics is not enabled, that is, if MEM_MANAGER_ENABLE_DIAGNOSTICS is not defined, this define is ignored.</p>
<h2><a class="anchor" id="mem_manager_params_api_check"></a>
MEM_MANAGER_DISABLE_API_PARAM_CHECK</h2>
<p>Disable API parameter checks in the module. Set this define to 1 to disable checks on API parameters in the module. API parameter checks are added to ensure that the correct parameters are passed to the module. These checks are useful during the development phase, but they might be redundant when the application is finalized. Disabling these checks might improve performance. By default, API parameter checks are enabled. </p>
<table class="doxtable">
<tr>
<th>Description </th><th>Value </th></tr>
<tr>
<td>Enable API parameters check </td><td>0 </td></tr>
<tr>
<td>Disable API parameters check </td><td>1 </td></tr>
<tr>
<td>Dependencies </td><td>None </td></tr>
</table>
<h2><a class="anchor" id="mem_manager_params_count"></a>
Block count</h2>
<p>The following defines configure the maximum number of memory blocks of the respective category:</p>
<ul>
<li>MEMORY_MANAGER_XXSMALL_BLOCK_COUNT</li>
<li>MEMORY_MANAGER_XSMALL_BLOCK_COUNT</li>
<li>MEMORY_MANAGER_SMALL_BLOCK_COUNT</li>
<li>MEMORY_MANAGER_MEDIUM_BLOCK_COUNT</li>
<li>MEMORY_MANAGER_LARGE_BLOCK_COUNT</li>
<li>MEMORY_MANAGER_XLARGE_BLOCK_COUNT</li>
<li>MEMORY_MANAGER_XXLARGE_BLOCK_COUNT</li>
</ul>
<p>If you do not want to use all categories, define the block count of the categories that you do not want to use to be zero or do not define it at all.</p>
<table class="doxtable">
<tr>
<th>Restriction </th><th>Value </th></tr>
<tr>
<td>Minimum value </td><td>0 </td></tr>
<tr>
<td>Maximum value </td><td>255 </td></tr>
<tr>
<td>Dependencies </td><td>None </td></tr>
</table>
<h2><a class="anchor" id="mem_manager_params_size"></a>
Block size</h2>
<p>The following defines configure the size of each memory block of the respective category:</p>
<ul>
<li>MEMORY_MANAGER_XXSMALL_BLOCK_SIZE</li>
<li>MEMORY_MANAGER_XSMALL_BLOCK_SIZE</li>
<li>MEMORY_MANAGER_SMALL_BLOCK_SIZE</li>
<li>MEMORY_MANAGER_MEDIUM_BLOCK_SIZE</li>
<li>MEMORY_MANAGER_LARGE_BLOCK_SIZE</li>
<li>MEMORY_MANAGER_XLARGE_BLOCK_SIZE</li>
<li>MEMORY_MANAGER_XXLARGE_BLOCK_SIZE</li>
</ul>
<p>The block size must be a multiple of the word size.</p>
<p>The block size of the smallest category that is used (thus that has a block count greater than zero) must be greater than zero. The block size of each following category that is used must be greater than the block size of the previous category.</p>
<p>Note that the module uses one bit per block to keep track of the status of the block (free or in use). The bits are maintained in an array of unsigned 32-bit integers.</p>
<table class="doxtable">
<tr>
<th>Restriction </th><th>Value </th></tr>
<tr>
<td>Minimum value </td><td>Block size of the previous category (0 if no previous category) + word size </td></tr>
<tr>
<td>Maximum value </td><td>Block size of the following category - word size (no restriction if there is no following category) </td></tr>
<tr>
<td>Dependencies </td><td>Block size of the previous and following used category (if any) </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
