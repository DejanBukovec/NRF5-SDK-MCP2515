<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: Ring buffer library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_ringbuf.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Ring buffer library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The library provides an implementation of a ring buffer. It allows for thread-safe operation on the data in the buffer. The library enables copying data in and out, and some more optimal direct operations of portions of the ring buffer to avoid memory copying.</p>
<h1><a class="anchor" id="lib_ringbuf_init"></a>
Initialization</h1>
<p>The <a class="el" href="group__nrf__ringbuf.html#gaa98060c94f8911a7c4929710ce538543">NRF_RINGBUF_DEF</a> macro creates an instance of the ring buffer. The size of the ring buffer must be a power of 2. It must be first initialized before it can be used.</p>
<div class="fragment"><div class="line"><a class="code" href="group__nrf__ringbuf.html#gaa98060c94f8911a7c4929710ce538543" title="Macro for defining a ring buffer instance.">NRF_RINGBUF_DEF</a>(m_ringbuf, 256);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__nrf__ringbuf.html#gab9640492575003c83eb56f947cc9ed9f" title="Function for initializing a ring buffer instance.">nrf_ringbuf_init</a>(&amp;m_ringbuf);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="lib_ringbuf_memcpy"></a>
Access through copying</h1>
<p>Data can be copied into the ring buffer using <a class="el" href="group__nrf__ringbuf.html#ga8e6a3154911c158fc03174a5203d6ee6">nrf_ringbuf_cpy_put</a>. If another 'put' operation on the instance was interrupted, the attempt returns <a class="elRef" doxygen="tag_s212_offline.tag:../s212/" href="../s212/group__nrf__error.html#ga5d2d8608f6d6a0329f58961a969e946e">NRF_ERROR_BUSY</a>. The <a class="el" href="group__nrf__ringbuf.html#ga8e6a3154911c158fc03174a5203d6ee6">nrf_ringbuf_cpy_put</a> function returns the amount of data written to the buffer. It can be smaller than requested if there is no space available to copy all data.</p>
<p>Data can be copied out from the ring buffer using <a class="el" href="group__nrf__ringbuf.html#ga736db47bd18c28e46e3b0cbff0856709">nrf_ringbuf_cpy_get</a>. If another 'get' operation on the instance was interrupted, the attempt returns <a class="elRef" doxygen="tag_s212_offline.tag:../s212/" href="../s212/group__nrf__error.html#ga5d2d8608f6d6a0329f58961a969e946e">NRF_ERROR_BUSY</a>. The <a class="el" href="group__nrf__ringbuf.html#ga736db47bd18c28e46e3b0cbff0856709">nrf_ringbuf_cpy_get</a> function returns the amount of data read from the buffer. It can be smaller than requested if there is less data available to copy.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> err_code;</div>
<div class="line">    uint8_t data_in[] = {1,2,3,4};</div>
<div class="line">    uint8_t data_out[5];</div>
<div class="line">    <span class="keywordtype">size_t</span>  len_in = <span class="keyword">sizeof</span>(data_in);</div>
<div class="line">    <span class="keywordtype">size_t</span>  len_out = <span class="keyword">sizeof</span>(data_out);</div>
<div class="line"></div>
<div class="line">    err_code = <a class="code" href="group__nrf__ringbuf.html#ga8e6a3154911c158fc03174a5203d6ee6" title="Function for copying data directly into the ring buffer.">nrf_ringbuf_cpy_put</a>(&amp;m_ringbuf, data_in, &amp;len_in);</div>
<div class="line"></div>
<div class="line">    err_code = <a class="code" href="group__nrf__ringbuf.html#ga736db47bd18c28e46e3b0cbff0856709" title="Function for copying data directly out of the ring buffer.">nrf_ringbuf_cpy_get</a>(&amp;m_ringbuf, data_out, &amp;len_out);</div>
<div class="line">    ASSERT(len_out == len_in);</div>
<div class="line">    ASSERT(memcmp(data_in, data_out, <span class="keyword">sizeof</span>(data_in)) == 0);</div>
<div class="line">} </div>
</div><!-- fragment --><h1><a class="anchor" id="lib_ringbuf_nocpy"></a>
Direct access to the memory</h1>
<p>The ring buffer library allows for working directly on the memory within the buffer. A portion of the buffer can be allocated for use. Once used, it can be put back (the put amount can be smaller than the allocated one). A similar approach can be used for getting data from the buffer. You can get it and then free it. The amount of freed data can be smaller than the one that was got.</p>
<p>Putting data to the ring buffer consists of the following steps.</p>
<ol type="1">
<li>Request allocation of N bytes (<a class="el" href="group__nrf__ringbuf.html#ga20fd9147a26fd332e405d6fa6ca7d067">nrf_ringbuf_alloc</a>) - get M (where M &lt;= N) bytes and the pointer to the buffer. M is smaller or equal to N.</li>
<li>Write P bytes to the buffer where P is smaller or equal to M.</li>
<li>Indicate to the ring buffer that P bytes are valid (<a class="el" href="group__nrf__ringbuf.html#ga89784c50c3e036ace416c0adcdb40071">nrf_ringbuf_put</a>).</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint8_t * p_buffer;</div>
<div class="line">    <span class="keywordtype">size_t</span>    len = 16;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Allocate buffer for uart RX</span></div>
<div class="line">    err_code = <a class="code" href="group__nrf__ringbuf.html#ga20fd9147a26fd332e405d6fa6ca7d067" title="Function for allocating memory from a ring buffer.">nrf_ringbuf_alloc</a>(&amp;m_ringbuf, &amp;p_buffer, &amp;len, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Start uart RX. Uart driver has inactivity timeout and returns on receiving requested amount of bytes or less.</span></div>
<div class="line">    <span class="keywordtype">size_t</span> rx_len = uart_rx(p_buffer, len);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Indicate number of valid bytes in the ring buffer</span></div>
<div class="line">    err_code = <a class="code" href="group__nrf__ringbuf.html#ga89784c50c3e036ace416c0adcdb40071" title="Function for commiting data to a ring buffer.">nrf_ringbuf_put</a>(&amp;m_ringbuf, rx_len);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Getting data from the ring buffer consists of the following steps:</p>
<ol type="1">
<li>Attempt to get N bytes of data from the ring buffer (<a class="el" href="group__nrf__ringbuf.html#ga2e5cd7d840850a80f552a1e831023e47">nrf_ringbuf_get</a>) - get M (where M &lt;= N) bytes and the pointer to the buffer.</li>
<li>Process P bytes of data where P is smaller or equal to M.</li>
<li>Indicate to the ring buffer that P bytes can be freed (<a class="el" href="group__nrf__ringbuf.html#ga7ee03ac011c64059a17cbbd1df021681">nrf_ringbuf_free</a>).</li>
</ol>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint8_t * p_buffer;</div>
<div class="line">    <span class="keywordtype">size_t</span>    len = 16;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Get available data from the buffer </span></div>
<div class="line">    err_code = <a class="code" href="group__nrf__ringbuf.html#ga2e5cd7d840850a80f552a1e831023e47">nrf_ringbuf_get</a>(&amp;m_ringbuf, &amp;p_buffer, &amp;len, <span class="keyword">true</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Process data</span></div>
<div class="line">    <span class="keywordtype">size_t</span> processed_len = packet_process(p_buffer, len);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Indicate number of bytes that can be freed</span></div>
<div class="line">    err_code = <a class="code" href="group__nrf__ringbuf.html#ga7ee03ac011c64059a17cbbd1df021681" title="Function for freeing a buffer back to the ring buffer.">nrf_ringbuf_free</a>(&amp;m_ringbuf, processed_len);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Access to the ring buffer can be exclusive. It means that an attempt to allocate another buffer between <a class="el" href="group__nrf__ringbuf.html#ga20fd9147a26fd332e405d6fa6ca7d067">nrf_ringbuf_alloc</a> and <a class="el" href="group__nrf__ringbuf.html#ga89784c50c3e036ace416c0adcdb40071">nrf_ringbuf_put</a> or an attempt to get data from the ring buffer between <a class="el" href="group__nrf__ringbuf.html#ga2e5cd7d840850a80f552a1e831023e47">nrf_ringbuf_get</a> and <a class="el" href="group__nrf__ringbuf.html#ga7ee03ac011c64059a17cbbd1df021681">nrf_ringbuf_free</a> can be detected. However, it is also possible to allocate or get more data with disabled exclusion check.</p>
<div class="fragment"><div class="line"><a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> foo2(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint8_t * p_buffer;</div>
<div class="line">    <span class="keywordtype">size_t</span>    len = 16;</div>
<div class="line"></div>
<div class="line">    err_code = <a class="code" href="group__nrf__ringbuf.html#ga20fd9147a26fd332e405d6fa6ca7d067" title="Function for allocating memory from a ring buffer.">nrf_ringbuf_alloc</a>(&amp;m_ringbuf, &amp;p_buffer, &amp;len, exclusive); </div>
<div class="line">    <span class="keywordflow">if</span> (err_code == <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//Write data</span></div>
<div class="line">        err_code = <a class="code" href="group__nrf__ringbuf.html#ga89784c50c3e036ace416c0adcdb40071" title="Function for commiting data to a ring buffer.">nrf_ringbuf_put</a>(&amp;m_ringbuf, len);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> err_code;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint8_t * p_buffer;</div>
<div class="line">    uint8_t * p_buffer2;</div>
<div class="line">    <span class="keywordtype">size_t</span>    len  = 16;</div>
<div class="line">    <span class="keywordtype">size_t</span>    len2 = 16;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Allocate buffer </span></div>
<div class="line">    <span class="keywordtype">bool</span> exclusive = <span class="keyword">true</span>;</div>
<div class="line">    err_code = <a class="code" href="group__nrf__ringbuf.html#ga20fd9147a26fd332e405d6fa6ca7d067" title="Function for allocating memory from a ring buffer.">nrf_ringbuf_alloc</a>(&amp;m_ringbuf, &amp;p_buffer, &amp;len, exclusive); </div>
<div class="line"></div>
<div class="line">    err_code = foo2(); <span class="comment">//NRF_ERROR_BUSY is returned</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Allocate more data without access control</span></div>
<div class="line">    err_code = <a class="code" href="group__nrf__ringbuf.html#ga20fd9147a26fd332e405d6fa6ca7d067" title="Function for allocating memory from a ring buffer.">nrf_ringbuf_alloc</a>(&amp;m_ringbuf, &amp;p_buffer2, &amp;len2, <span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Write data</span></div>
<div class="line"></div>
<div class="line">    err_code = <a class="code" href="group__nrf__ringbuf.html#ga89784c50c3e036ace416c0adcdb40071" title="Function for commiting data to a ring buffer.">nrf_ringbuf_put</a>(&amp;m_ringbuf, len + len2);</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
