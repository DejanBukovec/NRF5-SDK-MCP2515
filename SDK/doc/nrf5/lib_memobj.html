<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: Memory object library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_memobj.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Memory object library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The memory object library allows allocation of variable length memory objects from the pool. Memory objects are built from fixed size linked memory blocks (chunks). Since data is fragmented, it cannot be directly accessed. Such approach allows effective memory utilization since size of a memory chunk and the number of chunks can be adjusted to the use case. Memory objects are designed to be shared between multiple users.</p>
<p>For API documentation of this module, see <a class="el" href="group__nrf__memobj.html">Memory Object module</a>.</p>
<h1><a class="anchor" id="lib_memobj_implementation"></a>
Implementation details</h1>
<p>The memory object pool uses <a class="el" href="group__nrf__balloc.html">Block memory allocator</a> to manage memory chunks. A memory object is built from multiple chunks allocated from <a class="el" href="group__nrf__balloc.html">Block memory allocator</a>. A pointer to the first chunk in the memory object is used as a handle to that memory object.</p>
<h2><a class="anchor" id="lib_memobj_object_structure"></a>
Object</h2>
<p>Each chunk consists of a header and data. A standard header has 4 bytes and contains a pointer to the next chunk in the object, or a pointer to the pool instance in case of the last chunk. The first chunk header has an extended header which additionally contains object details, including a usage counter and information about the number of chunks in the object.</p>
<h2><a class="anchor" id="lib_memobj_multiple_users"></a>
Multiple users</h2>
<p>Each user can claim (<a class="el" href="group__nrf__memobj.html#ga7712aeae5acef5407a55700acf555846">nrf_memobj_get</a>) and release (<a class="el" href="group__nrf__memobj.html#ga694f0e9cedfbe41739412e9da79a0141">nrf_memobj_put</a>) an object. Claiming a buffer atomically increases the internal counter in the object (see <a class="el" href="lib_memobj.html#lib_memobj_object_structure">Object</a>). Releasing decrements the counter. The object is returned to the pool after the last release. Since the object has a pointer to the pool instance, it can be freed anywhere without access to the pool.</p>
<h1><a class="anchor" id="lib_memobj_usage"></a>
Working with objects</h1>
<p>Before a memory object can be used, a pool has to be created and initialized. A pool is created using the <a class="el" href="group__nrf__memobj.html#ga07eef66926f435f98894bb3ad790f343">NRF_MEMOBJ_POOL_DEF</a> macro. Chunk size and pool size must be specified. Chunk size is the amount of data that can be stored in the standard chunk. Chunk size can be adjusted based on the usage to reduce fragmentation. Note that capacity of an object consisting of one chunk is reduced by 4 bytes because of the extended header.</p>
<div class="fragment"><div class="line"><a class="code" href="group__nrf__memobj.html#ga07eef66926f435f98894bb3ad790f343" title="Macro for creating an nrf_memobj pool.">NRF_MEMOBJ_POOL_DEF</a>(m_pool, 16, 8); <span class="comment">//Create pool of 8 objects, standard chunk size is 16 bytes</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    err_code = <a class="code" href="group__nrf__memobj.html#gae330510f56c9dbd0ce0fbd3c6d2c32fe" title="Function for initializing the memobj pool instance.">nrf_memobj_pool_init</a>(&amp;m_pool);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Pool can be used</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>If a memory object is used by a single user, <a class="el" href="group__nrf__memobj.html#ga15b5f32f5b928c4070347903636a8ef5">nrf_memobj_alloc</a> and <a class="el" href="group__nrf__memobj.html#gafb4bdf89b6b07dc80842e01c599fe17b">nrf_memobj_free</a> is used to allocate and free the object. Data is accessed using <a class="el" href="group__nrf__memobj.html#ga36c70d67f8c24241130bd85441f31b5b">nrf_memobj_write</a> and <a class="el" href="group__nrf__memobj.html#ga1b0f7dc9ea70aec1fb4ec0d214ecdec2">nrf_memobj_read</a>. Reading and writing is done with an offset.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#ga63731efe7987c47d642200aa05d0f053" title="Memory object handle.">nrf_memobj_t</a> * p_obj = <a class="code" href="group__nrf__memobj.html#ga15b5f32f5b928c4070347903636a8ef5" title="Function for allocating a memobj with a requested size.">nrf_memobj_alloc</a>(&amp;m_pool, 33); <span class="comment">//Allocate an object which can store 33 bytes</span></div>
<div class="line">    </div>
<div class="line">    uint8_t buf1[] = {1,2};</div>
<div class="line">    uint8_t buf2[] = {3,4};</div>
<div class="line">    uint8_t outbuf[4];</div>
<div class="line">    <span class="keywordtype">size_t</span>  offset = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#ga36c70d67f8c24241130bd85441f31b5b" title="Function for writing data to the memory object.">nrf_memobj_write</a>(p_obj, buf1, <span class="keyword">sizeof</span>(buf1), offset); </div>
<div class="line">    offset += <span class="keyword">sizeof</span>(buf1);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#ga36c70d67f8c24241130bd85441f31b5b" title="Function for writing data to the memory object.">nrf_memobj_write</a>(p_obj, buf2, <span class="keyword">sizeof</span>(buf2), offset); </div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#ga1b0f7dc9ea70aec1fb4ec0d214ecdec2" title="Function for reading data from the memory object.">nrf_memobj_read</a>(p_obj, outbuf, <span class="keyword">sizeof</span>(buf1) + <span class="keyword">sizeof</span>(buf2), 0);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#gafb4bdf89b6b07dc80842e01c599fe17b" title="Function for forcing freeing of the memory object.">nrf_memobj_free</a>(p_obj);</div>
<div class="line">}</div>
</div><!-- fragment --><p>When multiple modules use the buffer, <a class="el" href="group__nrf__memobj.html#ga7712aeae5acef5407a55700acf555846">nrf_memobj_get</a> and <a class="el" href="group__nrf__memobj.html#ga694f0e9cedfbe41739412e9da79a0141">nrf_memobj_put</a> should be used. Do not use <a class="el" href="group__nrf__memobj.html#gafb4bdf89b6b07dc80842e01c599fe17b">nrf_memobj_free</a> in such case. The object is returned to the pool on the last <a class="el" href="group__nrf__memobj.html#ga694f0e9cedfbe41739412e9da79a0141">nrf_memobj_put</a> call.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#ga63731efe7987c47d642200aa05d0f053" title="Memory object handle.">nrf_memobj_t</a> * p_obj = <a class="code" href="group__nrf__memobj.html#ga15b5f32f5b928c4070347903636a8ef5" title="Function for allocating a memobj with a requested size.">nrf_memobj_alloc</a>(&amp;m_pool, 33); <span class="comment">//Allocate an object which can store 33 bytes</span></div>
<div class="line">    send_to_foo1(p_obj);</div>
<div class="line">    send_to_foo2(p_obj);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> foo1(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#ga63731efe7987c47d642200aa05d0f053" title="Memory object handle.">nrf_memobj_t</a> * p_obj = get_from_foo();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Claim the object</span></div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#ga7712aeae5acef5407a55700acf555846" title="Function for indicating that a memory object is used and cannot be freed.">nrf_memobj_get</a>(p_obj);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Process</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//Release the object</span></div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#ga694f0e9cedfbe41739412e9da79a0141" title="Function for indicated that memory object is no longer used by the module and can be freed if no othe...">nrf_memobj_put</a>(p_obj);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> foo2(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#ga63731efe7987c47d642200aa05d0f053" title="Memory object handle.">nrf_memobj_t</a> * p_obj = get_from_foo();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Claim the object</span></div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#ga7712aeae5acef5407a55700acf555846" title="Function for indicating that a memory object is used and cannot be freed.">nrf_memobj_get</a>(p_obj);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Process</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//Release the object</span></div>
<div class="line">    <a class="code" href="group__nrf__memobj.html#ga694f0e9cedfbe41739412e9da79a0141" title="Function for indicated that memory object is no longer used by the module and can be freed if no othe...">nrf_memobj_put</a>(p_obj);</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
