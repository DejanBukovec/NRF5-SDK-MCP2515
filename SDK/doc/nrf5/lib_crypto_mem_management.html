<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: Memory management in nrf_crypto</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_crypto_mem_management.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Memory management in nrf_crypto </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>It is necessary to allocate some memory for the nrf_crypto library and its backends for them to work properly. In some situations, the required memory buffers may be big, so putting it on the stack is not always a good solution.</p>
<p>Using the <a class="el" href="group__nrf__crypto__config.html#ga4dc0124a690561ff2a6c4c5cc48af674">NRF_CRYPTO_ALLOCATOR</a> configuration parameter, you can change how nrf_crypto allocates and deallocates memory. The following configuration values are possible:</p>
<ul>
<li>0 - <a class="el" href="lib_crypto_mem_management.html#lib_crypto_mem_management_default">Default configuration</a></li>
<li>1 - <a class="el" href="lib_crypto_mem_management.html#lib_crypto_mem_management_user">User macros</a></li>
<li>2 - <a class="el" href="lib_crypto_mem_management.html#lib_crypto_mem_management_alloca">Allocating memory on the stack (alloca)</a></li>
<li>3 - <a class="el" href="lib_crypto_mem_management.html#lib_crypto_mem_management_malloc">C dynamic memory (malloc)</a></li>
<li>4 - <a class="el" href="lib_crypto_mem_management.html#lib_crypto_mem_management_nrf_malloc">SDK Memory Manager (nrf_malloc)</a></li>
</ul>
<p>More details about memory consumption can be found in the description of the specific backend. See <a class="el" href="lib_crypto_backends.html">nrf_crypto backend modules</a>. There are two backends that needs some special attention:</p>
<ul>
<li><a class="el" href="lib_crypto_backend_nrf_cc310.html">nrf_cc310 backend</a>, because of its high memory consumption.</li>
<li><a class="el" href="lib_crypto_backend_mbedtls.html">mbed TLS backend</a>, because of its high memory consumption and extensive use of memory allocation and deallocation.</li>
</ul>
<p>Memory handling in nrf_crypto is done using two macros: <a class="el" href="group__nrf__crypto__mem.html#ga0bf00a1b98f41c84ecfb1c6f1e70ba12">NRF_CRYPTO_ALLOC</a> and <a class="el" href="group__nrf__crypto__mem.html#gad87a41c9b86b05bc0d49d8b298bf776e">NRF_CRYPTO_FREE</a>. Additionally, <a class="el" href="group__nrf__crypto__mem.html#ga1a5a4afa580132d70d55c8e9fe12154e">NRF_CRYPTO_ALLOC_ON_STACK</a> indicates whether memory is allocated on the stack or not.</p>
<h1><a class="anchor" id="lib_crypto_mem_management_default"></a>
Default configuration</h1>
<p>In the default configuration, memory is allocated on the stack, except in two situations:</p>
<ul>
<li>The toolchain does not support the <code>alloca()</code> function. Currently, this is the case with IAR Workbench 7.80.4.</li>
<li>Some of the enabled backends do not support memory allocation on the stack. Currently, this is the case with <a class="el" href="lib_crypto_backend_mbedtls.html">mbed TLS backend</a>.</li>
</ul>
<p>When allocation on the stack is not possible, then the default behavior is to use the nRF5 SDK <a class="el" href="lib_mem_manager.html">Memory Manager</a>.</p>
<p>See <a class="el" href="lib_crypto_mem_management.html#lib_crypto_mem_management_alloca">Allocating memory on the stack (alloca)</a> and <a class="el" href="lib_crypto_mem_management.html#lib_crypto_mem_management_nrf_malloc">SDK Memory Manager (nrf_malloc)</a>.</p>
<h1><a class="anchor" id="lib_crypto_mem_management_user"></a>
User macros</h1>
<p>You can create your own custom implementation of memory management used by nrf_crypto. The library must then include the <code>nrf_crypto_allocator.h</code> header file created by the user. The following defines must be located in the file:</p>
<ul>
<li><a class="el" href="group__nrf__crypto__mem.html#ga0bf00a1b98f41c84ecfb1c6f1e70ba12">NRF_CRYPTO_ALLOC</a> - memory allocating macro</li>
<li><a class="el" href="group__nrf__crypto__mem.html#gad87a41c9b86b05bc0d49d8b298bf776e">NRF_CRYPTO_FREE</a> - memory freeing macro</li>
<li><a class="el" href="group__nrf__crypto__mem.html#ga1a5a4afa580132d70d55c8e9fe12154e">NRF_CRYPTO_ALLOC_ON_STACK</a> - macro indicating whether memory is allocated on the stack</li>
</ul>
<h1><a class="anchor" id="lib_crypto_mem_management_alloca"></a>
Allocating memory on the stack (alloca)</h1>
<p>This configuration uses the standard <code>alloca()</code> function to allocate memory on the stack. It is not possible to use it with <a class="el" href="lib_crypto_backend_mbedtls.html">mbed TLS backend</a>, because mbed TLS relies on dynamic memory allocation.</p>
<dl class="section warning"><dt>Warning</dt><dd>Using <a class="el" href="lib_crypto_backend_nrf_cc310.html">nrf_cc310 backend</a> leads to extensive stack usage.</dd></dl>
<h1><a class="anchor" id="lib_crypto_mem_management_malloc"></a>
C dynamic memory (malloc)</h1>
<p>This is the simplest configuration option using the <code>malloc()</code> and <code>free()</code> functions from stdlib.</p>
<h1><a class="anchor" id="lib_crypto_mem_management_nrf_malloc"></a>
SDK Memory Manager (nrf_malloc)</h1>
<p>This configuration uses <a class="el" href="lib_mem_manager.html">Memory Manager</a> to allocate and free memory. Two versions of the manager can be used (2.0 and older). This module requires initialization and configuration before using it, so it must be done before initialization of nrf_crypto. How the module should be configured depends on the enabled backends. For details regarding memory consumption, see <a class="el" href="lib_crypto_backends.html">nrf_crypto backend modules</a>.</p>
<h1><a class="anchor" id="lib_crypto_mem_management_struct_sizes"></a>
Sizes of the types defined by nrf_crypto</h1>
<p>Size of each type defined by nrf_crypto may change significantly when configuration has changed. Following tables summarize each type size depending on selected backend and its configuration.</p>
<h2><a class="anchor" id="lib_crypto_mem_management_struct_RNG"></a>
RNG - Random Number Generation</h2>
<table class="doxtable">
<tr>
<th>Type </th><th>CC310</th><th>nRF HW</th><th>nRF HW with DRBG </th></tr>
<tr>
<td><a class="el" href="group__nrf__crypto__rng.html#gaa5f9901be99c060ebf27a6ddb8a54dd0">nrf_crypto_rng_context_t</a> </td><td>232 </td><td>4 </td><td>324  </td></tr>
<tr>
<td><a class="el" href="group__nrf__crypto__rng.html#ga20f4126cf2557e17ebef9a7cac8581ce">nrf_crypto_rng_temp_buffer_t</a></td><td>6112 </td><td>4 </td><td>4  </td></tr>
</table>
<h2><a class="anchor" id="lib_crypto_mem_management_struct_Hash"></a>
Hash - cryptographic hash algorithms</h2>
<table class="doxtable">
<tr>
<th rowspan="2">Type </th><th rowspan="2">CC310</th><th colspan="2">mbed TLS </th><th colspan="2">Oberon </th><th rowspan="2">CC310_BL </th></tr>
<tr>
<th>SHA-256</th><th>SHA-512</th><th>SHA-256</th><th>SHA-512  </th></tr>
<tr>
<td><a class="el" href="group__nrf__crypto__hash.html#gaab2e0280d3b59c296f5fc9e7c87a1f47">nrf_crypto_hash_context_t</a></td><td>248 </td><td>116 </td><td>224 </td><td>112 </td><td>208 </td><td>124  </td></tr>
<tr>
<td><a class="el" href="structnrf__crypto__hash__info__t.html">nrf_crypto_hash_info_t</a> </td><td colspan="6">24  </td></tr>
</table>
<h2><a class="anchor" id="lib_crypto_mem_management_struct_HMAC"></a>
HMAC - Hash-based Message Authentication Code</h2>
<table class="doxtable">
<tr>
<th rowspan="2">Type </th><th rowspan="2">CC310</th><th colspan="2">mbed TLS </th><th colspan="2">Oberon  </th></tr>
<tr>
<th>SHA-256</th><th>SHA-512</th><th>SHA-256</th><th>SHA-512 </th></tr>
<tr>
<td><a class="el" href="group__nrf__crypto__hmac.html#ga1f756de8f9e48807e84e58831159e9f4">nrf_crypto_hmac_context_t</a></td><td>384 </td><td>256 </td><td>492 </td><td>304 </td><td>592  </td></tr>
<tr>
<td><a class="el" href="structnrf__crypto__hmac__info__t.html">nrf_crypto_hmac_info_t</a> </td><td colspan="5">24  </td></tr>
</table>
<h2><a class="anchor" id="lib_crypto_mem_management_struct_AES"></a>
AES - Advanced Encryption Standard</h2>
<table class="doxtable">
<tr>
<th rowspan="2">Type </th><th rowspan="2">CC310</th><th colspan="3">mbed TLS  </th></tr>
<tr>
<th>CMAC</th><th>ECB</th><th>CBC, CBC-MAC,<br/>
CFB, CTR </th></tr>
<tr>
<td><a class="el" href="group__nrf__crypto__aes.html#ga648a786d394b06025f7301a9b0e83455">nrf_crypto_aes_context_t</a></td><td>88 </td><td>80 </td><td>292</td><td>308  </td></tr>
<tr>
<td><a class="el" href="structnrf__crypto__aes__info__t.html">nrf_crypto_aes_info_t</a> </td><td colspan="4">36  </td></tr>
</table>
<h2><a class="anchor" id="lib_crypto_mem_management_struct_AEAD"></a>
AEAD - Authenticated Encryption with Associated Data</h2>
<table class="doxtable">
<tr>
<th rowspan="2">Type</th><th colspan="2">CC310</th><th colspan="2">mbed TLS</th><th rowspan="2">Cifra</th><th rowspan="2">Oberon </th></tr>
<tr>
<th>CCM, CCM*</th><th>ChaCha-Poly</th><th>CCM</th><th>GCM </th></tr>
<tr>
<td><a class="el" href="group__nrf__crypto__aead.html#ga630884997d4d87ff695909ef0fb97ac2">nrf_crypto_aead_context_t</a></td><td>176</td><td>40</td><td>76</td><td>408</td><td>252</td><td>40 </td></tr>
<tr>
<td><a class="el" href="structnrf__crypto__aead__info__t.html">nrf_crypto_aead_info_t</a></td><td colspan="6">16 </td></tr>
</table>
<h2><a class="anchor" id="lib_crypto_mem_management_struct_ECC"></a>
ECC - Elliptic Curve Cryptography</h2>
<table class="doxtable">
<tr>
<th rowspan="2">Type</th><th rowspan="2">CC310</th><th rowspan="2">mbed<br/>
TLS</th><th colspan="3">ÂµECC</th><th colspan="3">Oberon</th><th colspan="2">CC310_BL </th></tr>
<tr>
<th>secp<br/>
192r1</th><th>secp<br/>
224r1</th><th>secp<br/>
256r1,<br/>
secp<br/>
256k1</th><th>secp<br/>
256r1</th><th>Curve<br/>
25519</th><th>Ed<br/>
25519</th><th>secp<br/>
224r1</th><th>secp<br/>
256r1 </th></tr>
<tr>
<td><a class="el" href="unionnrf__crypto__ecc__key__pair__generate__context__t.html">nrf_crypto_ecc_key_pair_generate_context_t</a></td><td>844</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>- </td></tr>
<tr>
<td><a class="el" href="unionnrf__crypto__ecc__public__key__calculate__context__t.html">nrf_crypto_ecc_public_key_calculate_context_t</a></td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>- </td></tr>
<tr>
<td><a class="el" href="unionnrf__crypto__ecc__private__key__t.html">nrf_crypto_ecc_private_key_t</a></td><td>824</td><td>20</td><td>32</td><td>36</td><td>40</td><td>40</td><td>40</td><td>72</td><td>-</td><td>- </td></tr>
<tr>
<td><a class="el" href="unionnrf__crypto__ecc__public__key__t.html">nrf_crypto_ecc_public_key_t</a></td><td>896</td><td>44</td><td>56</td><td>64</td><td>72</td><td>72</td><td>40</td><td>40</td><td>64</td><td>72 </td></tr>
<tr>
<td><a class="el" href="unionnrf__crypto__ecdh__context__t.html">nrf_crypto_ecdh_context_t</a></td><td>908</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>- </td></tr>
<tr>
<td><a class="el" href="unionnrf__crypto__ecdsa__sign__context__t.html">nrf_crypto_ecdsa_sign_context_t</a></td><td>2256</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>- </td></tr>
<tr>
<td><a class="el" href="unionnrf__crypto__ecdsa__verify__context__t.html">nrf_crypto_ecdsa_verify_context_t</a></td><td>1416</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>144</td><td>164 </td></tr>
<tr>
<td><a class="el" href="group__nrf__crypto__ecc.html#ga055d695ace6d387a7c81420c281b87a0">nrf_crypto_ecc_curve_info_t</a></td><td colspan="10">12 </td></tr>
</table>
<p>Empty cells show types that are not used by specific backend. Such types are defined, but they have some small default content up to 4 bytes. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
