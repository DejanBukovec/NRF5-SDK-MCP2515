<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: COMP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('hardware_driver_comp.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">COMP </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Comparator (COMP) driver includes two layers: the hardware access layer (HAL) and the driver layer (DRV).</p>
<p>The hardware access layer provides basic APIs for accessing the registers of the COMP peripheral. All functions in this layer are implemented as inline functions. See the API documentation for the <a class="el" href="group__nrf__comp__hal.html">COMP HAL</a> for details.</p>
<p>The driver layer provides APIs on a higher level than the HAL. See the API documentation for the <a class="el" href="group__nrf__drv__comp.html">COMP driver - legacy layer</a> for details.</p>
<p>Key features include:</p>
<ul>
<li>Triggering compare operations and returning comparison results</li>
<li>Using the comparator as relaxation oscillator that supports capacitive sensing</li>
</ul>
<h1><a class="anchor" id="hardware_driver_comp_config"></a>
Driver configuration</h1>
<p>The COMP driver default configuration is located in <code>sdk_config.h</code>. The COMP peripheral must be explicitly enabled in <code>sdk_config.h</code> before the driver can be used. If <a class="el" href="group__nrf__drv__comp.html#ga6205598a97aef6cf4f02bae151f46bc4">nrf_drv_comp_init</a> is called with a NULL pointer to the configuration structure, the default configuration from <code>sdk_config.h</code> is used. You must provide an event handler function during initialization.</p>
<p>The configurable parameters include:</p>
<ul>
<li>Reference selection: VDD, external reference from AIN0 or AIN1 (between 0 V and VDD), or internal references 1.2 V, 1.8 V, or 2.4 V.</li>
<li>Main operation mode: Single-ended or differential (see <a class="el" href="hardware_driver_comp.html#hardware_driver_comp_use">Using the COMP driver</a>).</li>
<li>Threshold voltages: The difference between the up threshold and the down threshold determines hysteresis. Used in single-ended mode.</li>
<li>Comparator hysteresis: 50 mV. Can be used in differential mode.</li>
<li>Speed and power mode: Low power, normal, or high-speed.</li>
<li>Current source: Can be used to form a relaxation oscillator (see <a class="el" href="hardware_driver_comp.html#hardware_driver_comp_csense">Capacitive sensing</a>).</li>
<li>Interrupt priority level: Any available interrupt priority level.</li>
</ul>
<p>If you want to initialize the peripheral with the default configuration, but with a different input pin, use the macro <a class="el" href="group__nrf__drv__comp.html#ga94fbd0f8f2272a0dfa681eaad0ff16bf">NRF_DRV_COMP_DEFAULT_CONFIG</a> with the pin number as parameter to create the configuration structure. Alternatively, you can initialize the peripheral with a NULL pointer as first parameter to use the default configuration and then call <a class="el" href="group__nrf__drv__comp.html#gabcc50eb7f0be5b8538eca50630a3323e">nrf_drv_comp_pin_select</a> to change the selected comparator input.</p>
<p>The following code example shows how to initialize the driver to use NRF_COMP_INPUT_0. Note that you must provide a valid event handler (comp_event_handler in the example).</p>
<div class="fragment"><div class="line"><a class="code" href="structnrfx__comp__config__t.html" title="COMP configuration.">nrf_drv_comp_config_t</a> comp_config = <a class="code" href="group__nrf__drv__comp.html#ga94fbd0f8f2272a0dfa681eaad0ff16bf" title="Macro for forwarding the new implementation.">NRF_DRV_COMP_DEFAULT_CONFIG</a>(<a class="code" href="group__nrf__comp__hal.html#gga7c4df5e4b28fd3485ad96f00588cdc8ca319f0e4cc2bae5ee049100e38d2d9aac">NRF_COMP_INPUT_0</a>);</div>
<div class="line"><span class="comment">// Configure threshold voltages.</span></div>
<div class="line">comp_config.<a class="code" href="structnrfx__comp__config__t.html#a498d2740e91acd9fcfb10d5dddfa773f">threshold</a>.<a class="code" href="structnrf__comp__th__t.html#aa1935eefda3fb23664bdc597880b62aa">th_down</a> = <a class="code" href="group__nrf__drv__comp.html#ga326a01d8991669c1e425c6e452917073" title="Macro for forwarding the new implementation.">VOLTAGE_THRESHOLD_TO_INT</a>(0.9, 1.8);</div>
<div class="line">comp_config.<a class="code" href="structnrfx__comp__config__t.html#a498d2740e91acd9fcfb10d5dddfa773f">threshold</a>.<a class="code" href="structnrf__comp__th__t.html#ab0a4626c8889883eb1bb50b1d1031f96">th_up</a> = <a class="code" href="group__nrf__drv__comp.html#ga326a01d8991669c1e425c6e452917073" title="Macro for forwarding the new implementation.">VOLTAGE_THRESHOLD_TO_INT</a>(1.5, 1.8);</div>
<div class="line">err_code = <a class="code" href="group__nrf__drv__comp.html#ga6205598a97aef6cf4f02bae151f46bc4" title="Function for initializing the COMP driver.">nrf_drv_comp_init</a>(&amp;comp_config, comp_event_handler);</div>
</div><!-- fragment --><h1><a class="anchor" id="hardware_driver_comp_use"></a>
Using the COMP driver</h1>
<p>The COMP driver can be initialized in one of two main operation modes:</p>
<ul>
<li><b>Single-ended mode</b> uses one channel as input voltage and the other channel as reference voltage. In this mode, you can fully configure hysteresis through the TH register using a 64-level reference ladder. The threshold voltages VUP and VDOWN are calculated based on the THUP and THDOWN values that you specify during initialization. The comparator will change from ABOVE to BELOW when VIN+ becomes smaller than VDOWN and from BELOW to ABOVE when it becomes bigger than VUP. If an external analog reference is used, it must be AIN0 or AIN1.</li>
<li><b>Differential mode</b> uses one channel as input voltage and the other channel as threshold voltage. The threshold voltage must be provided on AIN0 or AIN1. In this mode, you can enable or disable a fixed hysteresis (50 mV). If hysteresis is enabled, the output of the comparator will change from ABOVE to BELOW when VIN+ becomes 25 mV (50 mV / 2) smaller than the threshold voltage VIN-. Similarly, it changes from BELOW to ABOVE when VIN+ becomes 25 mV larger than VIN-.</li>
</ul>
<h2><a class="anchor" id="hardware_driver_comp_csense"></a>
Capacitive sensing</h2>
<dl class="section note"><dt>Note</dt><dd>Using the comparator as a relaxation oscilator, as described in this section, is not supported on nRF52810 due to hardware limitations.</dd></dl>
<p>The COMP peripheral supports capacitive sensing. To use the comparator as relaxation oscillator, configure the driver to enable a current source on the analog input (<a class="el" href="structnrfx__comp__config__t.html#a422c698ae0a1273a621de84a16fd40ad">nrf_drv_comp_config_t::isource</a>). The frequency of this oscillator is f_OSC = I_SOURCE / (2C*(VUP-VDOWN)), where VUP = (THUP+1)/64*VREF and VDOWN = (THDOWN+1)/64*VREF. Use timers to measure the period of the oscillator and calculate capacity changes based on this equation. When the pad that is connected to the analog input is touched, the capacity increases.</p>
<p>The following code example shows how to start the COMP as relaxation oscillator: </p>
<div class="fragment"><div class="line"><span class="comment">// Use the default configuration, but set isource to 5uA source.</span></div>
<div class="line"><a class="code" href="structnrfx__comp__config__t.html" title="COMP configuration.">nrf_drv_comp_config_t</a> comp_config = <a class="code" href="group__nrf__drv__comp.html#ga94fbd0f8f2272a0dfa681eaad0ff16bf" title="Macro for forwarding the new implementation.">NRF_DRV_COMP_DEFAULT_CONFIG</a>(<a class="code" href="group__nrf__comp__hal.html#gga7c4df5e4b28fd3485ad96f00588cdc8cae078850535f2e1e1343eeae96c83ed72">NRF_COMP_INPUT_2</a>);</div>
<div class="line">comp_config.<a class="code" href="structnrfx__comp__config__t.html#a422c698ae0a1273a621de84a16fd40ad">isource</a> = <a class="code" href="group__nrf__comp__hal.html#ggaee0ea1e7c432520ed0ff1fb8ed3e9586af97e2bf9957600820812dcc8a5f50004">NRF_COMP_ISOURCE_Ien5uA</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Initialize the driver.</span></div>
<div class="line">err_code = <a class="code" href="group__nrf__drv__comp.html#ga6205598a97aef6cf4f02bae151f46bc4" title="Function for initializing the COMP driver.">nrf_drv_comp_init</a>(&amp;comp_config,comp_event_handler);</div>
<div class="line"><span class="keywordflow">if</span> (err_code != <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Initialization failed. Take recovery action.</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Start the COMP peripheral without enabling any interrupts or shorts.</span></div>
<div class="line"><a class="code" href="group__nrf__drv__comp.html#ga0585e1010a29d975a54d6556fd57e08f" title="Macro for forwarding the new implementation.">nrf_drv_comp_start</a>(0,0);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>When using the comparator as relaxation oscillator, you should not set any interrupts from the comparator. The frequency of this oscillator is usually very high (around 500 kHz). Therefore, the processor might not be able to complete all instructions in the interrupt handler before the next interrupt. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
