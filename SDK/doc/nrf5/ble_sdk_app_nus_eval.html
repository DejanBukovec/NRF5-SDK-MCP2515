<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: UART/Serial Port Emulation over BLE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ble_sdk_app_nus_eval.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">UART/Serial Port Emulation over BLE </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="whichSDs"><span>This example requires one of the following SoftDevices: <b>S112, S113, S132, S140</b></span></div><p><b>Important:</b> Before you run this example, make sure to <a class="el" href="getting_started_softdevice.html#getting_started_sd">program the SoftDevice</a>.</p>
<p><b>Note</b>: You can run this example on nRF52833 with the S140 SoftDevice.</p>
<p>The Nordic UART Service (NUS) Application is an example that emulates a serial port over BLE. In the example, Nordic Semiconductor's development board serves as a peer to the phone application "nRF UART", which is available for iOS from App Store and for Android from Google Play. In addition, the example demonstrates how to use a proprietary (vendor-specific) service and characteristics with the SoftDevice.</p>
<p>The application includes one service: the Nordic UART Service. The 128-bit vendor-specific UUID of the Nordic UART Service is 6E400001-B5A3-F393-E0A9-E50E24DCCA9E (16-bit offset: 0x0001).</p>
<p>This service exposes two characteristics: one for transmitting and one for receiving (as seen from the peer).</p>
<ul>
<li><b>RX Characteristic (UUID: 6E400002-B5A3-F393-E0A9-E50E24DCCA9E)</b><br/>
 The peer can send data to the device by writing to the RX Characteristic of the service. ATT Write Request or ATT Write Command can be used. The received data is sent on the UART interface.</li>
<li><b>TX Characteristic (UUID: 6E400003-B5A3-F393-E0A9-E50E24DCCA9E)</b><br/>
 If the peer has enabled notifications for the TX Characteristic, the application can send data to the peer as notifications. The application will transmit all data received over UART as notifications.</li>
</ul>
<h1><a class="anchor" id="code_snippets_nus_eval"></a>
Important code lines</h1>
<p>The following sections describe some important parts of the example code.</p>
<h2><a class="anchor" id="adding_prop_ser_and_char"></a>
Adding proprietary service and characteristics</h2>
<p>The initialization of the proprietary service and its characteristics is done in <code>ble_nus.c</code>.</p>
<p>The Nordic UART Service is added to the SoftDevice as follows:</p>
<div class="fragment"><div class="line">    <span class="comment">// Add a custom base UUID.</span></div>
<div class="line">    err_code = <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group___b_l_e___c_o_m_m_o_n___f_u_n_c_t_i_o_n_s.html#ga265b4251110a15120d0aa97e5152163b">sd_ble_uuid_vs_add</a>(&amp;nus_base_uuid, &amp;p_nus-&gt;uuid_type);</div>
<div class="line">    <a class="code" href="group__sdk__common__macros.html#ga8675429b925e97e721ec3b133cc36fa5" title="Macro for verifying that a function returned NRF_SUCCESS. It will cause the exterior function to retu...">VERIFY_SUCCESS</a>(err_code);</div>
<div class="line"></div>
<div class="line">    ble_uuid.type = p_nus-&gt;uuid_type;</div>
<div class="line">    ble_uuid.uuid = <a class="code" href="group__ble__nus.html#gacc9be63ac54721bee2146217e17d9587">BLE_UUID_NUS_SERVICE</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Add the service.</span></div>
<div class="line">    err_code = <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group___b_l_e___g_a_t_t_s___f_u_n_c_t_i_o_n_s.html#ga39fea660228e4b2e788af7018a83927a">sd_ble_gatts_service_add</a>(<a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group___b_l_e___g_a_t_t_s___s_r_v_c___t_y_p_e_s.html#ga881b91f3ac789bf6fcefee7f815dcf7e">BLE_GATTS_SRVC_TYPE_PRIMARY</a>,</div>
<div class="line">                                        &amp;ble_uuid,</div>
<div class="line">                                        &amp;p_nus-&gt;service_handle);</div>
</div><!-- fragment --><p> The TX characteristic is added to the SoftDevice as shown in the code below. The read and write permissions of the characteristic and its CCCD are set as open, which means that there are no security restrictions on this characteristic. The type of the UUID (<code>add_char_params.uuid_type</code>) is the value that was returned in the call to <a class="elRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group___b_l_e___c_o_m_m_o_n___f_u_n_c_t_i_o_n_s.html#ga265b4251110a15120d0aa97e5152163b">sd_ble_uuid_vs_add()</a>. The RX characteristic is added in a similar way.</p>
<div class="fragment"><div class="line">    memset(&amp;add_char_params, 0, <span class="keyword">sizeof</span>(add_char_params));</div>
<div class="line">    add_char_params.uuid              = <a class="code" href="group__ble__nus__c.html#ga49bd37ddd3772d577028f8f6f7aaf19d">BLE_UUID_NUS_TX_CHARACTERISTIC</a>;</div>
<div class="line">    add_char_params.uuid_type         = p_nus-&gt;uuid_type;</div>
<div class="line">    add_char_params.max_len           = BLE_NUS_MAX_TX_CHAR_LEN;</div>
<div class="line">    add_char_params.init_len          = <span class="keyword">sizeof</span>(uint8_t);</div>
<div class="line">    add_char_params.is_var_len        = <span class="keyword">true</span>;</div>
<div class="line">    add_char_params.char_props.notify = 1;</div>
<div class="line"></div>
<div class="line">    add_char_params.read_access       = <a class="code" href="group__ble__sdk__srv__common.html#gga11f3aa457dcac873849598c52f4cf638a81fed0e1dadfd18235db87706e398402">SEC_OPEN</a>;</div>
<div class="line">    add_char_params.write_access      = <a class="code" href="group__ble__sdk__srv__common.html#gga11f3aa457dcac873849598c52f4cf638a81fed0e1dadfd18235db87706e398402">SEC_OPEN</a>;</div>
<div class="line">    add_char_params.cccd_write_access = <a class="code" href="group__ble__sdk__srv__common.html#gga11f3aa457dcac873849598c52f4cf638a81fed0e1dadfd18235db87706e398402">SEC_OPEN</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__ble__sdk__srv__common.html#gaef711e380480c973f7ace40a05b03540" title="Function for adding a characteristic to a given service.">characteristic_add</a>(p_nus-&gt;service_handle, &amp;add_char_params, &amp;p_nus-&gt;tx_handles);</div>
</div><!-- fragment --> <h2><a class="anchor" id="uart_init"></a>
Initializing UART</h2>
<p>The initialization of the application and the handling of data sent and received through BLE and UART are done in <code>main.c</code>.</p>
<p>The UART initialization is done as shown in the code below. The code segment uses the <a class="el" href="hardware_driver_uart.html">UART</a> module that is provided in the SDK to perform the UART configuration. Note that <a class="el" href="structapp__uart__comm__params__t.html" title="UART communication structure holding configuration settings for the peripheral.">app_uart_comm_params_t</a> configures the application to use hardware flow control. Therefore, RTS_PIN_NUMBER and CTS_PIN_NUMBER are used as Ready-to-Send and Clear-to-Send pins, respectively.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> uart_init(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint32_t                     err_code;</div>
<div class="line">    <a class="code" href="structapp__uart__comm__params__t.html" title="UART communication structure holding configuration settings for the peripheral.">app_uart_comm_params_t</a> <span class="keyword">const</span> comm_params =</div>
<div class="line">    {</div>
<div class="line">        .<a class="code" href="structapp__uart__comm__params__t.html#afcb0ac3264ee5473b4ec3b4048b35a67">rx_pin_no</a>    = RX_PIN_NUMBER,</div>
<div class="line">        .tx_pin_no    = TX_PIN_NUMBER,</div>
<div class="line">        .rts_pin_no   = RTS_PIN_NUMBER,</div>
<div class="line">        .cts_pin_no   = CTS_PIN_NUMBER,</div>
<div class="line">        .flow_control = <a class="code" href="group__app__uart.html#ggad0b0f33b12902ce08681e06f304f0cbaae7fd58fef6c10140a659be29f0b81b8b">APP_UART_FLOW_CONTROL_DISABLED</a>,</div>
<div class="line">        .use_parity   = <span class="keyword">false</span>,</div>
<div class="line"><span class="preprocessor">#if defined (UART_PRESENT)</span></div>
<div class="line"><span class="preprocessor"></span>        .baud_rate    = <a class="code" href="group__nrf__uart__hal.html#gga8f8c852e9d2eca9a20348c0640d7db5ea899519ef5bc33b854b4ffe9b2fd743db">NRF_UART_BAUDRATE_115200</a></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>        .baud_rate    = <a class="code" href="group__nrf__uarte__hal.html#gga42eca93d0e7d6354bcc75d6e2cdb462ea7b89b684f80db1d68e98d93321426e05" title="115200 baud.">NRF_UARTE_BAUDRATE_115200</a></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    };</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__app__uart.html#ga25b7b23e541732b945b5992b5519a10f" title="Macro for safe initialization of the UART module in a single user instance when using a FIFO together...">APP_UART_FIFO_INIT</a>(&amp;comm_params,</div>
<div class="line">                       UART_RX_BUF_SIZE,</div>
<div class="line">                       UART_TX_BUF_SIZE,</div>
<div class="line">                       uart_event_handle,</div>
<div class="line">                       <a class="code" href="group__app__util__platform.html#gga1a193131d1d5911b1ec53f9541841b1ba984bf731222fa242224a4bd5d0086801">APP_IRQ_PRIORITY_LOWEST</a>,</div>
<div class="line">                       err_code);</div>
<div class="line">    <a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line">}</div>
</div><!-- fragment --> <h2><a class="anchor" id="ble_data_handling"></a>
Handling data received over BLE</h2>
<p>When initializing the service in the services_init() function, the application passes the function nus_data_handler, which is used for handling the received data. When the Nordic UART Service indicates that data has been received over BLE from the peer, the same data is relayed to the UART. The nus_data_handler function is implemented as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> nus_data_handler(<a class="code" href="structble__nus__evt__t.html" title="Nordic UART Service event structure.">ble_nus_evt_t</a> * p_evt)</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p_evt-&gt;<a class="code" href="structble__nus__evt__t.html#aff725ebb2e4a7f8472be58176688349e">type</a> == <a class="code" href="group__ble__nus.html#ggac7cfe4eec478d82c981571bf1d33a450ab88bd812ffd1605b22633d00b4b2088c">BLE_NUS_EVT_RX_DATA</a>)</div>
<div class="line">    {</div>
<div class="line">        uint32_t err_code;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="group__nrf__log.html#ga543e51f0b87babd154870c494c0165f9" title="Macro for logging error messages. It takes a printf-like, formatted string with up to seven arguments...">NRF_LOG_DEBUG</a>(<span class="stringliteral">&quot;Received data from BLE NUS. Writing data on UART.&quot;</span>);</div>
<div class="line">        <a class="code" href="group__nrf__log.html#ga7000f8bd1f36238a99470c004cac84ea" title="Macro for logging raw bytes.">NRF_LOG_HEXDUMP_DEBUG</a>(p_evt-&gt;params.<a class="code" href="structble__nus__evt__t.html#aa5a4ad55de2291932bbb85b0278ddb10">rx_data</a>.<a class="code" href="structble__nus__evt__rx__data__t.html#a794dbed4125baa4fe6023e7100c5ab4a">p_data</a>, p_evt-&gt;params.<a class="code" href="structble__nus__evt__t.html#aa5a4ad55de2291932bbb85b0278ddb10">rx_data</a>.<a class="code" href="structble__nus__evt__rx__data__t.html#a43c2b7d30baa4ea90bf50b33bb95a23c">length</a>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; p_evt-&gt;params.<a class="code" href="structble__nus__evt__t.html#aa5a4ad55de2291932bbb85b0278ddb10">rx_data</a>.<a class="code" href="structble__nus__evt__rx__data__t.html#a43c2b7d30baa4ea90bf50b33bb95a23c">length</a>; i++)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">do</span></div>
<div class="line">            {</div>
<div class="line">                err_code = <a class="code" href="group__app__uart.html#ga2e4c8407274a151e72ed5a226529dc36" title="Function for putting a byte on the UART.">app_uart_put</a>(p_evt-&gt;params.<a class="code" href="structble__nus__evt__t.html#aa5a4ad55de2291932bbb85b0278ddb10">rx_data</a>.<a class="code" href="structble__nus__evt__rx__data__t.html#a794dbed4125baa4fe6023e7100c5ab4a">p_data</a>[i]);</div>
<div class="line">                <span class="keywordflow">if</span> ((err_code != <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a>) &amp;&amp; (err_code != <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga5d2d8608f6d6a0329f58961a969e946e">NRF_ERROR_BUSY</a>))</div>
<div class="line">                {</div>
<div class="line">                    <a class="code" href="group__nrf__log.html#gaaea89bb5c09b6033729e059826711bb0" title="Macro for logging error messages. It takes a printf-like, formatted string with up to seven arguments...">NRF_LOG_ERROR</a>(<span class="stringliteral">&quot;Failed receiving NUS message. Error 0x%x. &quot;</span>, err_code);</div>
<div class="line">                    <a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">while</span> (err_code == <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga5d2d8608f6d6a0329f58961a969e946e">NRF_ERROR_BUSY</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (p_evt-&gt;params.<a class="code" href="structble__nus__evt__t.html#aa5a4ad55de2291932bbb85b0278ddb10">rx_data</a>.<a class="code" href="structble__nus__evt__rx__data__t.html#a794dbed4125baa4fe6023e7100c5ab4a">p_data</a>[p_evt-&gt;params.<a class="code" href="structble__nus__evt__t.html#aa5a4ad55de2291932bbb85b0278ddb10">rx_data</a>.<a class="code" href="structble__nus__evt__rx__data__t.html#a43c2b7d30baa4ea90bf50b33bb95a23c">length</a> - 1] == <span class="charliteral">&#39;\r&#39;</span>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">while</span> (<a class="code" href="group__app__uart.html#ga2e4c8407274a151e72ed5a226529dc36" title="Function for putting a byte on the UART.">app_uart_put</a>(<span class="charliteral">&#39;\n&#39;</span>) == <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga5d2d8608f6d6a0329f58961a969e946e">NRF_ERROR_BUSY</a>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --> <h2><a class="anchor" id="uart_data_handling"></a>
Handling data received over UART</h2>
<p>Data that is received from the UART undergoes certain checks before it is relayed to the BLE peer using the Nordic UART Service. The code shown below is part of the app_uart event handler, which is called every time a character is received over the UART. Received characters are buffered into a string until a newline character is received or the size of the string matches the current MTU size. When one of these two conditions is met, the string is sent over BLE using the <a class="el" href="group__ble__nus.html#ga4189d97e88b018e48847c3ea26c4b05d">ble_nus_data_send</a> function.</p>
<p>The implementation of the example requires the newline character to be '\n'. Some terminals use different characters to trigger a newline, for example '\r'. Therefore, you might need to configure your terminal to interpret only '\n' as a newline.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> uart_event_handle(<a class="code" href="structapp__uart__evt__t.html" title="Struct containing events from the UART module.">app_uart_evt_t</a> * p_event)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> uint8_t data_array[<a class="code" href="group__ble__nus.html#ga70ca7af22270eab5a6a67f386b8258ea" title="Maximum length of data (in bytes) that can be transmitted to the peer by the Nordic UART service modu...">BLE_NUS_MAX_DATA_LEN</a>];</div>
<div class="line">    <span class="keyword">static</span> uint8_t index = 0;</div>
<div class="line">    uint32_t       err_code;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (p_event-&gt;<a class="code" href="structapp__uart__evt__t.html#ae89e1d236d49d18fa5be6fa32ba3c0d8">evt_type</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__app__uart.html#gga9346b21b144fd9499e24853bbf781e17ad0c6e0d9cef6b81de23e2f2583013ef1">APP_UART_DATA_READY</a>:</div>
<div class="line">            UNUSED_VARIABLE(<a class="code" href="group__app__uart.html#gacddb5b7b711ef104f9eb181a13bc4503" title="Function for getting a byte from the UART.">app_uart_get</a>(&amp;data_array[index]));</div>
<div class="line">            index++;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ((data_array[index - 1] == <span class="charliteral">&#39;\n&#39;</span>) ||</div>
<div class="line">                (data_array[index - 1] == <span class="charliteral">&#39;\r&#39;</span>) ||</div>
<div class="line">                (index &gt;= m_ble_nus_max_data_len))</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (index &gt; 1)</div>
<div class="line">                {</div>
<div class="line">                    <a class="code" href="group__nrf__log.html#ga543e51f0b87babd154870c494c0165f9" title="Macro for logging error messages. It takes a printf-like, formatted string with up to seven arguments...">NRF_LOG_DEBUG</a>(<span class="stringliteral">&quot;Ready to send data over BLE NUS&quot;</span>);</div>
<div class="line">                    <a class="code" href="group__nrf__log.html#ga7000f8bd1f36238a99470c004cac84ea" title="Macro for logging raw bytes.">NRF_LOG_HEXDUMP_DEBUG</a>(data_array, index);</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">do</span></div>
<div class="line">                    {</div>
<div class="line">                        uint16_t length = (uint16_t)index;</div>
<div class="line">                        err_code = <a class="code" href="group__ble__nus.html#ga4189d97e88b018e48847c3ea26c4b05d" title="Function for sending a data to the peer.">ble_nus_data_send</a>(&amp;m_nus, data_array, &amp;length, m_conn_handle);</div>
<div class="line">                        <span class="keywordflow">if</span> ((err_code != <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e">NRF_ERROR_INVALID_STATE</a>) &amp;&amp;</div>
<div class="line">                            (err_code != <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#gac94383171545e604e8347a044e8be13f">NRF_ERROR_RESOURCES</a>) &amp;&amp;</div>
<div class="line">                            (err_code != <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#ga349d25ada15be023e0d507f45ada682c">NRF_ERROR_NOT_FOUND</a>))</div>
<div class="line">                        {</div>
<div class="line">                            <a class="code" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c" title="Macro for calling error handler function if supplied error code any other than NRF_SUCCESS.">APP_ERROR_CHECK</a>(err_code);</div>
<div class="line">                        }</div>
<div class="line">                    } <span class="keywordflow">while</span> (err_code == <a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/group__nrf__error.html#gac94383171545e604e8347a044e8be13f">NRF_ERROR_RESOURCES</a>);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                index = 0;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__app__uart.html#gga9346b21b144fd9499e24853bbf781e17a6ee822a8a07d1be09ac336495a5238d8">APP_UART_COMMUNICATION_ERROR</a>:</div>
<div class="line">            <a class="code" href="group__app__error.html#gace6d059863761677dae5a6b1456a34ba" title="Macro for calling error handler function.">APP_ERROR_HANDLER</a>(p_event-&gt;data.<a class="code" href="structapp__uart__evt__t.html#ae2f48256edd4052e8273d098bb8249c4">error_communication</a>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__app__uart.html#gga9346b21b144fd9499e24853bbf781e17ac4e8a2753ab64a36a3bd0e723a3f26ea">APP_UART_FIFO_ERROR</a>:</div>
<div class="line">            <a class="code" href="group__app__error.html#gace6d059863761677dae5a6b1456a34ba" title="Macro for calling error handler function.">APP_ERROR_HANDLER</a>(p_event-&gt;data.<a class="code" href="structapp__uart__evt__t.html#ab2aeea864de0050ec22790a186a4e9b1">error_code</a>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> <h1><a class="anchor" id="project_nus_eval_setup"></a>
Setup</h1>
<p>You can find the source code and the project file of the example in the following folder: <code>&lt;InstallFolder&gt;\examples\ble_peripheral\ble_app_uart</code> </p>
<p><b>LED assignments:</b></p>
<ul>
<li>Advertising mode: LED 1 is blinking (period 2 seconds, duty cycle 10%).</li>
<li>Connected mode: LED 1 is on.</li>
</ul>
<p><b>Button assignments:</b> <a class="el" href="examples_bsp.html#examples_ble_button_functionality">BSP BLE Button Assignments</a></p>
<h1><a class="anchor" id="project_uart_nus_eval_test"></a>
Testing</h1>
<p>Test the UART Application with the nRF UART app, which is available for iOS (App Store) and Android (Google Play).</p>
<p>You can also test the application with <a href="https://www.nordicsemi.com/Software-and-Tools/Development-Tools/nRF-Connect-for-desktop">nRF Connect for Desktop</a> by performing the following steps:</p>
<ol type="1">
<li>Connect the board to the computer using a USB cable. The board is assigned a COM port, which is visible in the Device Manager.</li>
<li>Start a terminal emulator like PuTTY and connect to the used COM port with the following UART settings:<ul>
<li>
Baud rate: 115.200</li>
<li>
8 data bits</li>
<li>
1 stop bit</li>
<li>
No parity</li>
<li>
HW flow control: None</li>
</ul>
</li>
<li>Compile and program the application. Observe that the <a class="el" href="examples_bsp.html#BSP_INDICATE_ADVERTISING">BSP_INDICATE_ADVERTISING</a> state is indicated, and that the device is advertising with the device name "Nordic_UART".</li>
<li>Observe that the text "UART Start!" is printed on the COM listener running on the computer.</li>
<li>Connect to the device from nRF Connect. Observe that the <a class="el" href="examples_bsp.html#BSP_INDICATE_CONNECTED">BSP_INDICATE_CONNECTED</a> state is indicated.</li>
<li>Observe that the services are shown in the connected device.</li>
<li>Select the UART RX characteristic value in nRF Connect. You can write hexadecimal ASCII values to the UART RX and get the text displayed on the COM listener.</li>
<li>Write '30 31 32 33 34 35 36 37 38 39' (the hexadecimal value for the string "0123456789") and click 'write'. Verify that the text "0123456789" is displayed on the COM listener.</li>
<li>For sending data from the device to nRF Connect, enter any text, for example, "Hello", on the COM listener. Observe that a notification with the corresponding ASCII values is sent to the peer on handle 0x12. For the string "Hello", the notification is '48 65 6C 6C 6F'.</li>
<li>Disconnect the device in nRF Connect. Observe that the <a class="el" href="examples_bsp.html#BSP_INDICATE_ADVERTISING">BSP_INDICATE_ADVERTISING</a> state is indicated.</li>
<li>If no peer connects to the application within 180 seconds (APP_ADV_TIMEOUT_IN_SECONDS), the application will put the chip into system-off mode. </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
