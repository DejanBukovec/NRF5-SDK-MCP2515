<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v17.0.2: Migration guide for nrfx drivers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v17.0.2</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s112"><a href="../s112/index.html">S112 SoftDevice API</a></td>
<td class="doclinks" id="s113"><a href="../s113/index.html">S113 SoftDevice API</a></td>
<td class="doclinks" id="s122"><a href="../s122/index.html">S122 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s312"><a href="../s312/index.html">S312 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
<td class="doclinks" id="s340"><a href="../s340/index.html">S340 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s112","s113","s122","s132","s140","s212","s312","s332","s340"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('nrfx_migration_user_guide.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Migration guide for nrfx drivers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>With the transition of peripheral drivers from the SDK to a separate nrfx package, it was necessary to create a new namespace for the drivers and the related configuration settings.</p>
<p>When the nrfx was later integrated as an SDK module, a legacy layer was introduced to perform all the required name translations and cover differences in APIs and functionalities between the old and the new drivers, with the goal to allow the existing applications to use the drivers as before.</p>
<p>Because of these changes, you can either:</p>
<ul>
<li><a class="el" href="nrfx_migration_user_guide.html#getting_started_replace_nrf_drv_options_keep">Continue using nrf_drv drivers</a> with the legacy layer,</li>
<li><a class="el" href="nrfx_migration_user_guide.html#getting_started_replace_nrf_drv_options_migrate">Migrate nrf_drv to nrfx drivers</a> to use the new functionalities.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The migration process is not required and often results in exactly the same functionality. Consider migration only if you want to take advantage of the new features offered by nrfx.</dd></dl>
<h1><a class="anchor" id="getting_started_replace_nrf_drv_options_keep"></a>
Continue using nrf_drv drivers</h1>
<p>If you want to continue using the nrf_drv drivers, no changes are required. You can use the drivers as before, but without taking advantage of any new functionalities introduced to the nrfx drivers.</p>
<p>The old configuration entries are translated to the new NRFX_* format in the <code>apply_old_config.h</code> file located in <code>integration/nrfx/legacy</code>. In case you continue using the nrf_drv drivers, if you use any of the new NRFX_* entries in your configuration file that also contains old entries, the old entry settings take precedence.</p>
<h1><a class="anchor" id="getting_started_replace_nrf_drv_options_migrate"></a>
Migrate nrf_drv to nrfx drivers</h1>
<p>If you want to start using a new nrfx driver with the SDK to take advantage of its new functionality, you must migrate the driver usage in all occurrences within the source code (application, libraries, etc.) to ensure it works correctly.</p>
<p>The migration process depends on your application and the SDK version:</p>
<ul>
<li>For new applications, consider to use the new nrfx API.</li>
<li>For existing applications, make sure you do the following, in any order:<ul>
<li>rename used functions and types from nrf_drv_* to nrfx_*,</li>
<li>rename used macros from NRF_DRV_* to NRFX_*,</li>
<li>[SDK v15.0.0] remove the old configuration entries related to the nrf_drv_* drivers from your <code>sdk_config.h</code> file,</li>
<li>[SDK v14.2.0 and older] replace the old configuration options contained in your <code>sdk_config.h</code> with their new versions by adding the <code>NRFX_</code> prefix to their names.</li>
</ul>
</li>
</ul>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>Do not set the old *_ENABLED entry for a particular driver to 0. Doing so is not enough to make the NRFX_* entries work, as the <code>apply_old_config.h</code> file also translates the *_ENABLED macros.</li>
<li>When migrating the drivers, make sure you migrate the libraries too. An incomplete migration may cause unspecified behavior of the particular library.<br/>
See <a class="el" href="nrfx_migration_user_guide.html#getting_started_replace_nrf_drv_lib_dep_table">Libraries and dependencies</a> for the overview of what must be migrated.</li>
<li>An important change between nrf_drv and nrfx drivers is that passing NULL instead of pointing the driver configuration at initialization is no longer supported.<br/>
You must always create a configuration structure and pass the pointer to it to the initialization function.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="getting_started_replace_nrf_drv_scenarios"></a>
Migration scenarios</h2>
<p>During the migration, three scenarios can occur:</p>
<ul>
<li><a class="el" href="nrfx_migration_user_guide.html#getting_started_possible_simple">Simple replacement</a></li>
<li><a class="el" href="nrfx_migration_user_guide.html#getting_started_possible_complex">Complex replacement</a></li>
<li><a class="el" href="nrfx_migration_user_guide.html#getting_started_not_possible">Migration not possible</a></li>
</ul>
<h3><a class="anchor" id="getting_started_possible_simple"></a>
Simple replacement</h3>
<p>For most of the drivers, the legacy layer simply translates the nrfx_* names to nrf_drv_*. The following table lists drivers that can be replaced with the nrfx ones.</p>
<table class="doxtable">
<tr>
<th>nrf_drv driver </th><th>nrfx driver </th><th>Notes </th></tr>
<tr>
<td>nrf_drv_comp </td><td>nrfx_comp </td><td></td></tr>
<tr>
<td>nrf_drv_gpiote </td><td>nrfx_gpiote </td><td></td></tr>
<tr>
<td>nrf_drv_i2s </td><td>nrfx_i2s </td><td></td></tr>
<tr>
<td>nrf_drv_lpcomp </td><td>nrfx_lpcomp </td><td></td></tr>
<tr>
<td>nrf_drv_pdm </td><td>nrfx_pdm </td><td></td></tr>
<tr>
<td>nrf_drv_ppi </td><td>nrfx_ppi </td><td>No init function. Changed to allocator. </td></tr>
<tr>
<td>nrf_drv_pwm </td><td>nrfx_pwm </td><td></td></tr>
<tr>
<td>nrf_drv_qdec </td><td>nrfx_qdec </td><td></td></tr>
<tr>
<td>nrf_drv_qspi </td><td>nrfx_qspi </td><td></td></tr>
<tr>
<td>nrf_drv_rtc </td><td>nrfx_rtc </td><td></td></tr>
<tr>
<td>nrf_drv_saadc </td><td>nrfx_saadc </td><td></td></tr>
<tr>
<td>nrf_drv_swi </td><td>nrfx_swi </td><td>No init function. Changed to allocator. </td></tr>
<tr>
<td>nrf_drv_timer </td><td>nrfx_timer </td><td></td></tr>
<tr>
<td>nrf_drv_wdt </td><td>nrfx_wdt </td><td></td></tr>
</table>
<h3><a class="anchor" id="getting_started_possible_complex"></a>
Complex replacement</h3>
<p>The SDK included combined drivers for the peripherals with EasyDMA and without. The nrfx uses two separate drivers for these two types of peripherals, respectively:</p>
<table class="doxtable">
<tr>
<th>nrf_drv_ driver</th><th>nrfx driver (EasyDMA) </th><th>nrfx driver (no EasyDMA) </th></tr>
<tr>
<td>nrf_drv_spi </td><td>nrfx_spim </td><td>nrfx_spi </td></tr>
<tr>
<td>nrf_drv_twi </td><td>nrfx_twim </td><td>nrfx_twi </td></tr>
<tr>
<td>nrf_drv_uart </td><td>nrfx_uarte </td><td>nrfx_uart </td></tr>
</table>
<p>Replace the nrf_drv driver with the nrfx one based on the type of peripheral in use (with EasyDMA or without).</p>
<h3><a class="anchor" id="getting_started_not_possible"></a>
Migration not possible</h3>
<p>The following drivers cannot be replaced in SDK by the nrfx ones because of their complex dependencies:</p>
<ul>
<li>nrf_drv_clock</li>
<li>nrf_drv_power</li>
<li>nrf_drv_rng</li>
</ul>
<h1><a class="anchor" id="getting_started_replace_nrf_drv_lib_dep_table"></a>
Libraries and dependencies</h1>
<p>Only some libraries use the nrf_drv drivers. These libraries are all located in the nrf_drv_* namespace.</p>
<p>The following table shows all the libraries with the dependencies that must be resolved during migration.</p>
<table class="doxtable">
<tr>
<th>Library </th><th>nrf_drv direct dependencies and notes </th></tr>
<tr>
<td>atomic </td><td>- </td></tr>
<tr>
<td>atomic_fifo </td><td>- </td></tr>
<tr>
<td>atomic_flags </td><td>- </td></tr>
<tr>
<td>balloc </td><td>- </td></tr>
<tr>
<td>block_dev </td><td>nrf_drv_qspi </td></tr>
<tr>
<td>bootloader </td><td>nrf_drv_uart, nrf_drv_clock, nrf_drv_usbd </td></tr>
<tr>
<td>bsp </td><td>- </td></tr>
<tr>
<td>button </td><td>nrf_drv_gpiote </td></tr>
<tr>
<td>cli </td><td>nrf_drv_usbd, nrf_drv_uart </td></tr>
<tr>
<td>crc16 </td><td>- </td></tr>
<tr>
<td>crc32 </td><td>- </td></tr>
<tr>
<td>crypto </td><td>nrf_drv_rng </td></tr>
<tr>
<td>csense </td><td>Indirect dependencies from csense_drv </td></tr>
<tr>
<td>csense_drv </td><td>nrf_drv_comp, nrf_drv_ppi, nrf_drv_timer, nrf_drv_saadc </td></tr>
<tr>
<td>delay </td><td>- </td></tr>
<tr>
<td>ecc </td><td>nrf_drv_rng </td></tr>
<tr>
<td>libuarte </td><td>Based on nrfx </td></tr>
<tr>
<td>experimental_log </td><td>nrf_drv_uart </td></tr>
<tr>
<td>experimental_section_vars </td><td>- </td></tr>
<tr>
<td>experimental_stack_guard </td><td>- </td></tr>
<tr>
<td>experimental_task_manager </td><td>- </td></tr>
<tr>
<td>fds </td><td>- </td></tr>
<tr>
<td>fifo </td><td>- </td></tr>
<tr>
<td>fstorage </td><td>- </td></tr>
<tr>
<td>gfx </td><td>- </td></tr>
<tr>
<td>gpiote </td><td>nrf_drv_gpiote </td></tr>
<tr>
<td>hardfault </td><td>- </td></tr>
<tr>
<td>hci </td><td>- </td></tr>
<tr>
<td>led_softblink </td><td>- </td></tr>
<tr>
<td>low_power_pwm </td><td>- </td></tr>
<tr>
<td>mem_manager </td><td>- </td></tr>
<tr>
<td>memobj </td><td>- </td></tr>
<tr>
<td>mpu </td><td>- </td></tr>
<tr>
<td>mutex </td><td>- </td></tr>
<tr>
<td>pwm </td><td>nrf_drv_timer, nrf_drv_ppi, nrf_drv_gpiote </td></tr>
<tr>
<td>pwr_mgmt </td><td>- </td></tr>
<tr>
<td>queue </td><td>- </td></tr>
<tr>
<td>ringbuf </td><td>- </td></tr>
<tr>
<td>scheduler </td><td>- </td></tr>
<tr>
<td>sdcard </td><td>nrf_drv_spi </td></tr>
<tr>
<td>sensorsim </td><td>- </td></tr>
<tr>
<td>serial </td><td>nrf_drv_uart </td></tr>
<tr>
<td>sha256 </td><td>- </td></tr>
<tr>
<td>simple_timer </td><td>nrf_drv_timer </td></tr>
<tr>
<td>slip </td><td>- </td></tr>
<tr>
<td>sortlist </td><td>- </td></tr>
<tr>
<td>spi_mngr </td><td>nrf_drv_spi </td></tr>
<tr>
<td>stack_guard </td><td>- </td></tr>
<tr>
<td>stack_info </td><td>- </td></tr>
<tr>
<td>strerror </td><td>- </td></tr>
<tr>
<td>svc </td><td>- </td></tr>
<tr>
<td>timer </td><td>app_timer uses its own RTC driver implementation </td></tr>
<tr>
<td>twi_mngr </td><td>nrf_drv_twi </td></tr>
<tr>
<td>twi_sensor </td><td>Indirect dependencies from twi_mngr </td></tr>
<tr>
<td>uart </td><td>nrf_drv_uart </td></tr>
<tr>
<td>usbd </td><td>nrf_drv_usbd, nrf_drv_clock, nrf_drv_power </td></tr>
<tr>
<td>util </td><td>- </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon Sep 14 2020" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
